"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[140],{50140:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(4942),r=n(87462),l=n(42982),c=n(15671),o=n(43144),s=n(79340),i=n(82963),u=n(61120),d=n(13855),p=n(11930),m=n(92950),f=n(62012),g=n(95517),h=n(48706),y=n(42807),v=n(61542),_=n(61647),E=n(93902),C=n(43819);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){(0,s.Z)(v,e);var t,n,a=(t=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,u.Z)(t);if(n){var r=(0,u.Z)(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return(0,i.Z)(this,e)});function v(e){var t;(0,c.Z)(this,v),t=a.call(this,e);var n=C.q.parseParamString(e.location.search,["page","page_size"]);return n.page_size||(n.page_size=y.g.CARD_DEFAULT_PAGE_SIZE),n.view_type||(n.view_type=localStorage.getItem(y.g.SEARCH_VIEW_TYPE_LOCAL_KEY)),t.state={collections:[],params:n,numberOfResults:0,loading:!0,synclist:void 0,alerts:[],updateCollection:null,showImportModal:!1,redirect:null,noDependencies:!1,deleteCollection:null,confirmDelete:!1,isDeletionPending:!1},t}return(0,o.Z)(v,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.queryCollections(),"insights"===y.g.INSIGHTS_DEPLOYMENT_MODE&&this.getSynclist()}},{key:"addAlert",value:function(e){this.setState({alerts:[].concat((0,l.Z)(this.state.alerts),[e])})}},{key:"closeAlert",get:function(){return(0,h.NQ)("alerts")}},{key:"render",value:function(){var e=this;if(this.state.redirect)return m.createElement(f.Navigate,{to:this.state.redirect});var t=this.state,n=t.loading,a=t.collections,r=t.params,l=t.numberOfResults,c=t.showImportModal,o=t.updateCollection,s=t.deleteCollection,i=t.confirmDelete,u=t.isDeletionPending,p=0===a.length&&!(0,E.vS)(r,["keywords","tags","sign_state"]),g=function(t){return e.updateParams(t,(function(){return e.queryCollections()}))};return m.createElement("div",{className:"search-page"},m.createElement(h.UW,{alerts:this.state.alerts,closeAlert:function(t){return e.closeAlert(t)}}),m.createElement(h.gQ,{deleteCollection:s,isDeletionPending:u,confirmDelete:i,setConfirmDelete:function(t){return e.setState({confirmDelete:t})},cancelAction:function(){return e.setState({deleteCollection:null})},deleteAction:function(){return e.setState({isDeletionPending:!0},(function(){return E.K1.deleteCollection({collection:s,setState:function(t){return e.setState(t)},load:function(){return e.load()},redirect:!1,selectedRepo:e.context.selectedRepo,addAlert:function(t){return e.addAlert(t)}})}))}}),c&&m.createElement(h.ZO,{isOpen:c,onUploadSuccess:function(){return e.setState({redirect:(0,_.dI)(_.nB.myImports,{},{namespace:o.namespace.name})})},setOpen:function(t,n){return e.toggleImportModal(t,n)},collection:o,namespace:o.namespace.name}),m.createElement(h.UP,{className:"header",title:d.ag._("Collections"),contextSelector:m.createElement(h.e4,{path:_.nB.searchByRepo,selectedRepo:this.context.selectedRepo})},!p&&m.createElement("div",{className:"hub-toolbar-wrapper"},m.createElement("div",{className:"toolbar"},m.createElement(h.Ls,{ignoredParams:["page","page_size","sort","view_type"],params:r,updateParams:g}),m.createElement("div",{className:"hub-pagination-container"},m.createElement("div",{className:"card-list-switcher"},m.createElement(h.nH,{size:"sm",params:r,updateParams:function(t){return e.updateParams(t,(function(){return localStorage.setItem(y.g.SEARCH_VIEW_TYPE_LOCAL_KEY,e.state.params.view_type)}))}})),m.createElement(h.tl,{params:r,updateParams:g,count:l,perPageOptions:y.g.CARD_DEFAULT_PAGINATION_OPTIONS,isTop:!0}))))),n?m.createElement(h.AW,null):p?m.createElement(h.vv,{title:d.ag._("No collections yet"),description:d.ag._("Collections will appear once uploaded")}):m.createElement(m.Fragment,null,m.createElement("section",{className:"collection-container"},this.renderCollections(a,r,g)),m.createElement("section",{className:"footer"},m.createElement(h.tl,{params:r,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections()}))},perPageOptions:y.g.CARD_DEFAULT_PAGINATION_OPTIONS,count:l}))))}},{key:"toggleImportModal",value:function(e,t){t&&this.setState({alerts:[].concat((0,l.Z)(this.state.alerts),[{title:t,variant:"warning"}])}),this.setState({showImportModal:e})}},{key:"renderCollections",value:function(e,t,n){return 0===e.length?m.createElement(h.ei,{clearAllFilters:function(){C.q.clearAllFilters({params:t,ignoredParams:["page","page_size","sort","view_type"],updateParams:n})}}):"list"===t.view_type?this.renderList(e):this.renderCards(e)}},{key:"renderCards",value:function(e){var t=this;return m.createElement("div",{className:"hub-cards"},e.map((function(e){return m.createElement(h.zt,(0,r.Z)({className:"card",key:e.id},e,{footer:t.renderSyncToogle(e.name,e.namespace.name),repo:t.context.selectedRepo,menu:t.renderMenu(!1,e),displaySignatures:t.context.featureFlags.display_signatures}))})))}},{key:"handleControlClick",value:function(e){var t=this;g.gu.setDeprecation(e,!e.deprecated,this.context.selectedRepo).then((function(n){var a=(0,E.LL)(n.data.task);return(0,E.BA)(a).then((function(){var n=e.deprecated?d.ag._('The collection "{0}" has been successfully undeprecated.',{0:e.name}):d.ag._('The collection "{0}" has been successfully deprecated.',{0:e.name});t.setState({alerts:[].concat((0,l.Z)(t.state.alerts),[{title:n,variant:"success"}])}),t.load()}))})).catch((function(n){var a=n.response,r=a.status,c=a.statusText;t.setState({alerts:[].concat((0,l.Z)(t.state.alerts),[{variant:"danger",title:e.deprecated?d.ag._('Collection "{0}" could not be undeprecated.',{0:e.name}):d.ag._('Collection "{0}" could not be deprecated.',{0:e.name}),description:(0,E.N3)(r,c)}])})}))}},{key:"renderMenu",value:function(e,t){var n=this,a=this.context.hasPermission,r=[E.K1.deleteMenuOption({canDeleteCollection:a("ansible.delete_collection"),noDependencies:null,onClick:function(){return E.K1.tryOpenDeleteModalWithConfirm({addAlert:function(e){return n.addAlert(e)},setState:function(e){return n.setState(e)},collection:t})}}),m.createElement(p.DropdownItem,{onClick:function(){return n.handleControlClick(t)},key:"deprecate"},t.deprecated?d.ag._("Undeprecate"):d.ag._("Deprecate"))];return e||r.push(m.createElement(p.DropdownItem,{onClick:function(){return n.checkUploadPrivilleges(t)},key:"upload new version"},d.ag._("Upload new version"))),m.createElement(m.Fragment,null,e&&m.createElement(p.Button,{onClick:function(){return n.checkUploadPrivilleges(t)},variant:"secondary"},d.ag._("Upload new version")),m.createElement(h.hu,{items:r.filter(Boolean),ariaLabel:"collection-kebab"}))}},{key:"renderSyncToogle",value:function(e,t){var n=this;return this.state.synclist?m.createElement(p.Switch,{id:t+"."+e,className:"sync-toggle",label:d.ag._("Sync"),isChecked:this.isCollectionSynced(e,t),onChange:function(){return n.toggleCollectionSync(e,t)}}):null}},{key:"checkUploadPrivilleges",value:function(e){var t=this,n=function(){t.setState({alerts:[].concat((0,l.Z)(t.state.alerts),[{title:d.ag._("You don't have rights to do this operation."),variant:"warning"}])})};g.V$.get(e.namespace.name,{include_related:"my_permissions"}).then((function(a){a.data.related_fields.my_permissions.includes("galaxy.upload_to_namespace")?t.setState({updateCollection:e,showImportModal:!0}):n()})).catch((function(){n()}))}},{key:"toggleCollectionSync",value:function(e,t){var n=this,a=P({},this.state.synclist),r=a.collections.findIndex((function(n){return n.name===e&&n.namespace===t}));r<0?a.collections.push({name:e,namespace:t}):a.collections.splice(r,1),g.vy.update(a.id,a).then((function(e){n.setState({synclist:e.data}),g.vy.curate(a.id).then((function(){return null}))}))}},{key:"isCollectionSynced",value:function(e,t){var n=this.state.synclist,a=n.collections.find((function(n){return n.name===e&&n.namespace===t}));return"include"===n.policy?!(void 0===a):void 0===a}},{key:"renderList",value:function(e){var t=this;return m.createElement("div",{className:"list-container"},m.createElement("div",{className:"hub-list"},m.createElement(p.DataList,{className:"data-list","aria-label":d.ag._("List of Collections")},e.map((function(e){return m.createElement(h.Op,(0,r.Z)({showNamespace:!0,key:e.id},e,{controls:m.createElement(m.Fragment,null,t.renderSyncToogle(e.name,e.namespace.name),t.renderMenu(!0,e)),repo:t.context.selectedRepo,displaySignatures:t.context.featureFlags.display_signatures}))})))))}},{key:"getSynclist",value:function(){var e=this;g.vy.list().then((function(t){1===t.data.meta.count?e.setState({synclist:t.data.data[0]}):console.error("my-synclist returned ".concat(t.data.meta.count," synclists"))}))}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){g.gu.list(P(P({},C.q.getReduced(e.state.params,["view_type"])),{},{deprecated:!1}),e.context.selectedRepo).then((function(t){e.setState({collections:t.data.data,numberOfResults:t.data.meta.count,loading:!1})}))}))}},{key:"updateParams",get:function(){return C.q.updateParamsMixin()}}]),v}(m.Component);const b=(0,E.EN)(k);k.contextType=v.I}}]);
//# sourceMappingURL=../sourcemaps/140.e7f4ef2f808e7ac8542461b8133f8ddb.js.map