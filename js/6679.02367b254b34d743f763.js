"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[6679],{66679:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(64467),a=n(53986),i=n(10467),o=n(45458),s=n(80296),u=n(23029),l=n(92901),c=n(56822),p=n(53954),d=n(15361),f=n(54756),m=n.n(f),v=n(47712),h=n(85889),y=n(32995),g=n.n(y),_=n(88756),b=n(62017),R=n(97899),C=n(18712),A=["sort"];function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e,t,n){return t=(0,p.A)(t),(0,c.A)(e,j()?Reflect.construct(t,n||[],(0,p.A)(e).constructor):t.apply(e,n))}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(j=function(){return!!e})()}var P=function(e){function t(e){var n;(0,u.A)(this,t),n=E(this,t,[e]);var r=C.mb.parseParamString(e.location.search,["page","page_size"]);return r.page_size||(r.page_size=10),r.sort||(r.sort="-pulp_created"),r.repository_label||(r.repository_label="pipeline=staging"),n.state={versions:void 0,itemCount:0,params:r,loading:!0,updatingVersions:[],alerts:[],unauthorized:!1,inputText:"",uploadCertificateModalOpen:!1,versionToUploadCertificate:null,approveModalInfo:null,repositories:{approved:null,rejected:null}},n}var n,c,p;return(0,d.A)(t,e),(0,l.A)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.context,n=t.user,r=t.hasPermission;n&&!n.is_anonymous&&r("ansible.modify_ansible_repo_content")?(this.setState({loading:!0}),Promise.all([this.queryCollections(!1),this.queryRepositories()]).then((function(){e.setState({loading:!1}),e.setState({updatingVersions:[]})}))):this.setState({unauthorized:!0})}},{key:"queryRepositories",value:function(){var e=this,t=function(t){return _.Xj.list({page:1,page_size:1,pulp_label_select:"pipeline=".concat(t)}).then((function(e){var t=e.data,n=t.count,r=t.results;return 1===n?r[0]:null})).catch((function(n){return e.addAlert(v.Ru._({id:"clie21",values:{pipeline:t}}),"danger",null==n?void 0:n.message),null}))};return Promise.all([t("approved"),t("rejected")]).then((function(t){var n=(0,s.A)(t,2),r=n[0],a=n[1];return e.setState({repositories:{approved:r,rejected:a}})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.versions,r=t.params,a=t.itemCount,i=t.loading,o=t.unauthorized;return n||o?g().createElement(g().Fragment,null,g().createElement(b.T$,{title:v.Ru._({id:"WSRF7q"})}),g().createElement(b.NS,{alerts:this.state.alerts,closeAlert:function(t){return e.closeAlert(t)}}),o?g().createElement(b.Pd,null):g().createElement(b.gZ,{className:"hub-certification-dashboard"},g().createElement("section",{className:"body","data-cy":"body"},g().createElement("div",{className:"hub-toolbar"},g().createElement(h.Toolbar,null,g().createElement(h.ToolbarContent,null,g().createElement(h.ToolbarGroup,null,g().createElement(h.ToolbarItem,null,g().createElement(b.Mw,{inputText:this.state.inputText,onChange:function(t){e.setState({inputText:t})},updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},params:r,filterConfig:[{id:"namespace",title:v.Ru._({id:"wMe2Qp"})},{id:"name",title:v.Ru._({id:"Bcyiqj"})},{id:"repository_label",title:v.Ru._({id:"uAQUqI"}),inputType:"select",options:[{id:"pipeline=rejected",title:v.Ru._({id:"ekCRTP"})},{id:"pipeline=staging",title:v.Ru._({id:"K7lqZC"})},{id:"pipeline=approved",title:v.Ru._({id:"7kb4LU"})}]}]}))))),g().createElement(b.dK,{params:r,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:a,isTop:!0})),g().createElement("div",null,g().createElement(b.lU,{updateParams:function(t){e.updateParams(t,(function(){return e.queryCollections(!0)})),e.setState({inputText:""})},params:r,ignoredParams:["page_size","page","sort"],niceValues:{repository_label:{"pipeline=approved":v.Ru._({id:"7kb4LU"}),"pipeline=rejected":v.Ru._({id:"ekCRTP"}),"pipeline=staging":v.Ru._({id:"K7lqZC"})}},niceNames:{name:v.Ru._({id:"Bcyiqj"}),namespace:v.Ru._({id:"wMe2Qp"}),repository_label:v.Ru._({id:"uAQUqI"})}})),i?g().createElement(b.hQ,null):this.renderTable(n,r),g().createElement("div",{className:"footer"},g().createElement(b.dK,{params:r,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:a}))),g().createElement(b.Pm,{isOpen:this.state.uploadCertificateModalOpen,onCancel:function(){return e.closeUploadCertificateModal()},onSubmit:function(t){return e.submitCertificate(t)}}),this.state.approveModalInfo&&g().createElement(b.Nl,{closeAction:function(){e.setState({approveModalInfo:null})},finishAction:function(){e.setState({approveModalInfo:null}),e.queryCollections(!0)},collectionVersion:this.state.approveModalInfo,addAlert:function(t){return e.addAlertObj(t)}}))):g().createElement(b.tG,null)}},{key:"renderTable",value:function(e,t){var n=this;if(0===e.length)return(0,C.l)(t,["namespace","name","repository_label"])?g().createElement(b.br,null):g().createElement(b.a4,{title:v.Ru._({id:"f1gH0D"}),description:v.Ru._({id:"6STYN5"})});var r={headers:[{title:v.Ru._({id:"wMe2Qp"}),type:"alpha",id:"namespace"},{title:v.Ru._({id:"q+hNag"}),type:"alpha",id:"name"},{title:v.Ru._({id:"eE0JZ4"}),type:"number",id:"version"},{title:v.Ru._({id:"u46WEi"}),type:"number",id:"pulp_created"},{title:v.Ru._({id:"IreQBq"}),type:"none",id:""},{title:v.Ru._({id:"uAQUqI"}),type:"none",id:"repository_label"},{title:"",type:"none",id:"certify"}]};return g().createElement("table",{"aria-label":v.Ru._({id:"QGV1gp"}),className:"hub-c-table-content pf-c-table"},g().createElement(b.HW,{options:r,params:t,updateParams:function(e){return n.updateParams(e,(function(){return n.queryCollections(!0)}))}}),g().createElement("tbody",null,e.map((function(e,t){return g().createElement(b.K3,{approve:function(e){return n.approve(e)},collectionVersion:e,context:n.context,isVersionUpdating:function(e){return n.isVersionUpdating(e)},key:t,openUploadCertificateModal:function(e){return n.openUploadCertificateModal(e)},reject:function(e){return n.reject(e)}})}))))}},{key:"isVersionUpdating",value:function(e){return!!this.state.updatingVersions.find((function(t){return t==e}))}},{key:"openUploadCertificateModal",value:function(e){this.setState({uploadCertificateModalOpen:!0,versionToUploadCertificate:e})}},{key:"closeUploadCertificateModal",value:function(){this.setState({uploadCertificateModalOpen:!1,versionToUploadCertificate:null})}},{key:"submitCertificate",value:function(e){var t=this,n=this.state.versionToUploadCertificate,r=n.collection_version,a=n.repository,i=r.pulp_href,o=r.name,s=r.namespace,u=r.version;_.l5.upload({file:e,repository:a.pulp_href,signed_collection:i}).then((function(e){var t=e.data.task;return(0,C.aZ)(t)})).then((function(){return t.addAlert(v.Ru._({id:"EeVTY1",values:{namespace:s,name:o,version:u}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var n=e.response?(0,C.gJ)(e.response.status,e.response.statusText):e;t.addAlert(v.Ru._({id:"CAcrUo",values:{namespace:s,name:o,version:u}}),"danger",n)})).finally((function(){return t.closeUploadCertificateModal()}))}},{key:"setUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:[].concat((0,o.A)(t),[e])})}},{key:"unsetUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:t.filter((function(t){return t!==e}))})}},{key:"approve",value:(p=(0,i.A)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.state.repositories).approved?this.move(t,n.approved):this.setState({approveModalInfo:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"reject",value:(c=(0,i.A)(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.state.repositories).rejected){e.next=5;break}return r=t.collection_version,this.addAlert(v.Ru._({id:"vwJz0n",values:{0:r.namespace,1:r.name,2:r.version}}),"danger",v.Ru._({id:"F020md"})),e.abrupt("return");case 5:return e.next=7,this.isRejected(t);case 7:if(!e.sent){e.next=11;break}this.remove(t),e.next=12;break;case 11:this.move(t,n.rejected);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"move",value:function(e,t){var n=this,r=e.collection_version,a=e.repository;return this.setUpdatingVersion(e),Promise.all([(0,C.Jh)(a.name,a.pulp_href),(0,C.Jh)(t.name,t.pulp_href)]).then((function(e){var t=(0,s.A)(e,2),n=t[0],a=t[1];return _.R4.move(r.namespace,r.name,r.version,n,a)})).then((function(e){return(0,C.aZ)(e.data.remove_task_id,{waitMs:500})})).then((function(){return n.addAlert(v.Ru._({id:"f0S6WW",values:{0:r.namespace,1:r.name,2:r.version}}),"success")})).then((function(){return n.queryCollections(!0)})).catch((function(e){var t=e.response?(0,C.gJ)(e.response.status,e.response.statusText):e;n.addAlert(v.Ru._({id:"vwJz0n",values:{0:r.namespace,1:r.name,2:r.version}}),"danger",t)})).finally((function(){return n.unsetUpdatingVersion(e)}))}},{key:"remove",value:function(e){var t=this,n=e.collection_version,r=e.repository;return this.setUpdatingVersion(e),_.Xj.removeContent((0,C.dx)(r.pulp_href),n.pulp_href).then((function(e){var t=e.data.task;return(0,C.RN)(t)})).then((function(){return t.addAlert(v.Ru._({id:"f0S6WW",values:{0:n.namespace,1:n.name,2:n.version}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var r=e.response?(0,C.gJ)(e.response.status,e.response.statusText):e;t.addAlert(v.Ru._({id:"vwJz0n",values:{0:n.namespace,1:n.name,2:n.version}}),"danger",r)})).finally((function(){return t.unsetUpdatingVersion(e)}))}},{key:"isRejected",value:(n=(0,i.A)(m().mark((function e(t){var n,r,a,i,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state.repositories,r=t.collection_version,a=r.name,i=r.namespace,o=r.version,e.abrupt("return",_.R4.list({name:a,namespace:i,page:1,page_size:1,repository:(0,C.dx)(n.rejected.pulp_href),version:o}).then((function(e){return!!e.data.meta.count})).catch((function(){return!1})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"queryCollections",value:function(e){var t=this;e&&this.setState({loading:!0});var n=this.state.params,i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({order_by:n.sort},(0,a.A)(n,A));return _.R4.list(i).then((function(n){t.setState({versions:n.data.data,itemCount:n.data.meta.count}),e&&t.setState({loading:!1,updatingVersions:[]})})).catch((function(e){t.addAlert(v.Ru._({id:"A5KmrN"}),"danger",null==e?void 0:e.message),t.setState({loading:!1,updatingVersions:[]})}))}},{key:"updateParams",get:function(){return C.mb.updateParamsMixin()}},{key:"closeAlert",get:function(){return(0,b.Ap)("alerts")}},{key:"addAlert",value:function(e,t,n){this.setState({alerts:[].concat((0,o.A)(this.state.alerts),[{description:n,title:e,variant:t}])})}},{key:"addAlertObj",value:function(e){this.addAlert(e.title,e.variant,e.description)}}]),t}(g().Component);const S=(0,C.y)(P);P.contextType=R.B}}]);
//# sourceMappingURL=../sourcemaps/6679.74a70ca6fe322c2fde116afab3e41bc6.js.map