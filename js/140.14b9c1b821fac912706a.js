"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[140],{50140:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var a=n(4942),l=n(87462),r=n(42982),i=n(15671),o=n(43144),c=n(79340),s=n(82963),u=n(61120),d=n(89555),p=n(39752),m=n(94184),f=n.n(m),g=n(92950),y=n.n(g),h=n(62012),v=n(31286),_=n(90094),E=n(42807),S=n(61542),C=n(61647),P=n(44139);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=function(e){(0,c.Z)(m,e);var t,n,a=(t=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,u.Z)(t);if(n){var l=(0,u.Z)(this).constructor;e=Reflect.construct(a,arguments,l)}else e=a.apply(this,arguments);return(0,s.Z)(this,e)});function m(e){var t;(0,i.Z)(this,m),t=a.call(this,e);var n=P.q6.parseParamString(e.location.search,["page","page_size"]);return n.page_size||(n.page_size=E.g.CARD_DEFAULT_PAGE_SIZE),n.view_type||(n.view_type=localStorage.getItem(E.g.SEARCH_VIEW_TYPE_LOCAL_KEY)),t.state={collections:[],params:n,numberOfResults:0,loading:!0,synclist:void 0,alerts:[],updateCollection:null,showImportModal:!1,redirect:null,noDependencies:!1,deleteCollection:null,confirmDelete:!1,isDeletionPending:!1,deleteAll:!0},t}return(0,o.Z)(m,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.queryCollections(),"insights"===E.g.INSIGHTS_DEPLOYMENT_MODE&&this.getSynclist()}},{key:"addAlert",value:function(e){this.setState({alerts:[].concat((0,r.Z)(this.state.alerts),[e])})}},{key:"closeAlert",get:function(){return(0,_.NQ)("alerts")}},{key:"render",value:function(){var e,t=this;if(this.state.redirect)return y().createElement(h.Navigate,{to:this.state.redirect});var n=this.state,a=n.loading,l=n.collections,r=n.params,i=n.numberOfResults,o=n.showImportModal,c=n.updateCollection,s=n.deleteCollection,u=n.confirmDelete,p=n.isDeletionPending,m=0===l.length&&!(0,P.vS)(r,["keywords","tags","is_signed","repository_name","namespace"]),f=function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},g=this.state.deleteAll?null:null==s||null===(e=s.repository)||void 0===e?void 0:e.name;return y().createElement("div",{className:"search-page"},y().createElement(_.UW,{alerts:this.state.alerts,closeAlert:function(e){return t.closeAlert(e)}}),y().createElement(_.gQ,{deleteCollection:s,collections:l,isDeletionPending:p,confirmDelete:u,setConfirmDelete:function(e){return t.setState({confirmDelete:e})},cancelAction:function(){return t.setState({deleteCollection:null})},deleteAction:function(){return t.setState({isDeletionPending:!0},(function(){return P.K1.deleteCollection({collection:s,setState:function(e){return t.setState(e)},load:function(){return t.load()},redirect:!1,addAlert:function(e){return t.addAlert(e)},deleteFromRepo:g})}))},deleteFromRepo:g}),o&&y().createElement(_.ZO,{isOpen:o,onUploadSuccess:function(){return t.setState({redirect:(0,C.dI)(C.nB.myImports,{},{namespace:c.collection_version.namespace})})},setOpen:function(e,n){return t.toggleImportModal(e,n)},collection:c.collection_version,namespace:c.collection_version.namespace}),y().createElement(_.UP,{className:"hub-header-bordered",title:d.ag._({id:"DoJzLz"})},!m&&y().createElement("div",null,y().createElement("div",{className:"hub-toolbar hub-toolbar-left"},y().createElement(_.Ls,{ignoredParams:["page","page_size","sort","view_type"],params:r,updateParams:f}),y().createElement("div",{className:"hub-pagination-container"},y().createElement("div",{className:"card-list-switcher"},y().createElement(_.nH,{size:"sm",params:r,updateParams:function(e){return t.updateParams(e,(function(){return localStorage.setItem(E.g.SEARCH_VIEW_TYPE_LOCAL_KEY,t.state.params.view_type)}))}})),y().createElement(_.tl,{params:r,updateParams:f,count:i,perPageOptions:E.g.CARD_DEFAULT_PAGINATION_OPTIONS,isTop:!0}))))),a?y().createElement(_.AW,null):m?y().createElement(_.vv,{title:d.ag._({id:"V1hs4Y"}),description:d.ag._({id:"6STYN5"})}):y().createElement(y().Fragment,null,y().createElement("section",{className:"collection-container"},this.renderCollections(l,r,f)),y().createElement("section",{className:"footer"},y().createElement(_.tl,{params:r,updateParams:function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},perPageOptions:E.g.CARD_DEFAULT_PAGINATION_OPTIONS,count:i}))))}},{key:"toggleImportModal",value:function(e,t){t&&this.setState({alerts:[].concat((0,r.Z)(this.state.alerts),[{title:t,variant:"warning"}])}),this.setState({showImportModal:e})}},{key:"renderCollections",value:function(e,t,n){return 0===e.length?y().createElement(_.ei,{clearAllFilters:function(){P.q6.clearAllFilters({params:t,ignoredParams:["page","page_size","sort","view_type"],updateParams:n})}}):"list"===t.view_type?this.renderList(e):this.renderCards(e)}},{key:"renderCards",value:function(e){var t=this;return y().createElement("div",{className:"hub-cards"},e.map((function(e,n){return y().createElement(_.zt,(0,l.Z)({className:"card",key:n},e,{footer:t.renderSyncToogle(e.collection_version.name,e.collection_version.namespace),menu:t.renderMenu(!1,e),displaySignatures:t.context.featureFlags.display_signatures}))})))}},{key:"handleControlClick",value:function(e){var t=this,n=e.collection_version.name;v.gu.setDeprecation(e).then((function(a){var l=(0,P.LL)(a.data.task);return(0,P.BA)(l).then((function(){var a=e.deprecated?d.ag._({id:"QKaTiY",values:{name:n}}):d.ag._({id:"BlYFt4",values:{name:n}});t.setState({alerts:[].concat((0,r.Z)(t.state.alerts),[{title:a,variant:"success"}])}),t.load()}))})).catch((function(a){var l=a.response,i=l.status,o=l.statusText;t.setState({alerts:[].concat((0,r.Z)(t.state.alerts),[{variant:"danger",title:e.deprecated?d.ag._({id:"5dhPcd",values:{name:n}}):d.ag._({id:"hEP0ZC",values:{name:n}}),description:(0,P.N3)(i,o)}])})}))}},{key:"renderMenu",value:function(e,t){var n,a,l,r=this,i=this.context.hasPermission,o=this.context.featureFlags,c=o.display_repositories,s=o.ai_deny_index&&("galaxy.change_namespace",null==(n=t.collection_version.namespace)||null===(a=n.related_fields)||void 0===a||null===(a=a.my_permissions)||void 0===a||null===(l=a.includes)||void 0===l?void 0:l.call(a,"galaxy.change_namespace")),u=[P.K1.deleteMenuOption({canDeleteCollection:i("ansible.delete_collection")||s,noDependencies:null,onClick:function(){return P.K1.tryOpenDeleteModalWithConfirm({addAlert:function(e){return r.addAlert(e)},setState:function(e){return r.setState(e)},collection:t,deleteAll:!0})},deleteAll:!0,display_repositories:c}),P.K1.deleteMenuOption({canDeleteCollection:i("ansible.delete_collection")||s,noDependencies:null,onClick:function(){return P.K1.tryOpenDeleteModalWithConfirm({addAlert:function(e){return r.addAlert(e)},setState:function(e){return r.setState(e)},collection:t,deleteAll:!1})},deleteAll:!1,display_repositories:c}),i("galaxy.upload_to_namespace")&&y().createElement(p.DropdownItem,{onClick:function(){return r.handleControlClick(t)},key:"deprecate"},t.is_deprecated?d.ag._({id:"IBLyJk"}):d.ag._({id:"eRDK7P"})),!e&&i("galaxy.upload_to_namespace")&&y().createElement(p.DropdownItem,{onClick:function(){return r.checkUploadPrivilleges(t)},key:"upload new version"},d.ag._({id:"PHsJXN"}))].filter(Boolean),m=u.length>0;return e?{uploadButton:i("galaxy.upload_to_namespace")?y().createElement(p.Button,{onClick:function(){return r.checkUploadPrivilleges(t)},variant:"secondary"},d.ag._({id:"PHsJXN"})):null,dropdownMenu:m?y().createElement(_.hu,{items:u,ariaLabel:"collection-kebab"}):null}:y().createElement("span",{className:f()(!m&&"hidden-menu-space")},m&&y().createElement(_.hu,{items:u,ariaLabel:"collection-kebab"}))}},{key:"renderSyncToogle",value:function(e,t){var n=this;return this.state.synclist?y().createElement(p.Switch,{id:t+"."+e,className:"sync-toggle",label:d.ag._({id:"Nu4DdT"}),isChecked:this.isCollectionSynced(e,t),onChange:function(){return n.toggleCollectionSync(e,t)}}):null}},{key:"checkUploadPrivilleges",value:function(e){var t=this,n=function(){t.setState({alerts:[].concat((0,r.Z)(t.state.alerts),[{title:d.ag._({id:"XoMS0d"}),variant:"warning"}])})};v.V$.get(e.collection_version.namespace,{include_related:"my_permissions"}).then((function(a){a.data.related_fields.my_permissions.includes("galaxy.upload_to_namespace")?t.setState({updateCollection:e,showImportModal:!0}):n()})).catch((function(){n()}))}},{key:"toggleCollectionSync",value:function(e,t){var n=this,a=b({},this.state.synclist),l=a.collections.findIndex((function(n){return n.name===e&&n.namespace===t}));l<0?a.collections.push({name:e,namespace:t}):a.collections.splice(l,1),v.vy.update(a.id,a).then((function(e){n.setState({synclist:e.data}),v.vy.curate(a.id).then((function(){return null}))}))}},{key:"isCollectionSynced",value:function(e,t){var n=this.state.synclist,a=n.collections.find((function(n){return n.name===e&&n.namespace===t}));return"include"===n.policy?!!a:!a}},{key:"renderList",value:function(e){var t=this;return y().createElement("div",{className:"list-container"},y().createElement("div",{className:"hub-list"},y().createElement(p.DataList,{className:"data-list","aria-label":d.ag._({id:"74Eard"})},e.map((function(e,n){return y().createElement(_.Op,(0,l.Z)({key:n,collection:e,displaySignatures:t.context.featureFlags.display_signatures,showNamespace:!0,synclistSwitch:t.renderSyncToogle(e.collection_version.name,e.collection_version.namespace)},t.renderMenu(!0,e)))})))))}},{key:"getSynclist",value:function(){var e=this;v.vy.list().then((function(t){1===t.data.meta.count?e.setState({synclist:t.data.data[0]}):console.error("my-synclist returned ".concat(t.data.meta.count," synclists"))}))}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){v.eq.list(b(b({},P.q6.getReduced(e.state.params,["view_type"])),{},{is_deprecated:!1,repository_label:"!hide_from_search",is_highest:!0})).then((function(t){e.setState({collections:t.data.data,numberOfResults:t.data.meta.count,loading:!1})}))}))}},{key:"updateParams",get:function(){return P.q6.updateParamsMixin()}}]),m}(y().Component);const A=(0,P.EN)(O);O.contextType=S.I}}]);
//# sourceMappingURL=../sourcemaps/140.a51ad099b80d730c7f56213f852cf61d.js.map