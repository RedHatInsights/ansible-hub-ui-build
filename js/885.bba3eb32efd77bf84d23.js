"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[885],{50885:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var a=n(58168),r=n(45458),l=n(23029),o=n(92901),i=n(56822),c=n(53954),s=n(15361),u=n(64467),d=n(47712),p=n(72583),m=n(95872),f=n(41259),h=n(44914),v=n.n(h),y=n(47767),g=n(88696),_=n(35894),S=n(97899),k=n(60165),C=n(39799);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,u.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return t=(0,c.A)(t),(0,i.A)(e,A()?Reflect.construct(t,n||[],(0,c.A)(e).constructor):t.apply(e,n))}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(A=function(){return!!e})()}var E=function(e){function t(e){var n;(0,l.A)(this,t),n=w(this,t,[e]);var a=C.mb.parseParamString(e.location.search,["page","page_size"]);return a.page_size||(a.page_size=10),a.view_type||(a.view_type=localStorage.getItem("search_view_type")),a.sort||(a.sort="name"),n.state={collections:[],params:a,count:0,loading:!0,synclist:void 0,alerts:[],updateCollection:null,showImportModal:!1,redirect:null,noDependencies:!1,deleteCollection:null,confirmDelete:!1,isDeletionPending:!1,deleteAll:!0},n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.queryCollections(),this.getSynclist()}},{key:"addAlert",value:function(e){this.setState({alerts:[].concat((0,r.A)(this.state.alerts),[e])})}},{key:"render",value:function(){var e,t=this;if(this.state.redirect)return v().createElement(y.C5,{to:this.state.redirect});var n=this.state,r=n.alerts,l=n.collections,o=n.confirmDelete,i=n.count,c=n.deleteCollection,s=n.isDeletionPending,u=n.loading,p=n.params,m=n.showImportModal,f=n.updateCollection,h=0===l.length&&!(0,C.l)(p,["keywords","tags","is_signed","repository_name","namespace"]),g=function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},S=this.state.deleteAll?null:null==c||null===(e=c.repository)||void 0===e?void 0:e.name,b=["page","page_size","sort","view_type"];return v().createElement("div",{className:"search-page"},v().createElement(_.NS,{alerts:r,closeAlert:function(e){return(0,_.R$)(e,{alerts:r,setAlerts:function(e){return t.setState({alerts:e})}})}}),v().createElement(_.rm,{deleteCollection:c,collections:l,isDeletionPending:s,confirmDelete:o,setConfirmDelete:function(e){return t.setState({confirmDelete:e})},cancelAction:function(){return t.setState({deleteCollection:null})},deleteAction:function(){return t.setState({isDeletionPending:!0},(function(){return C.fG.deleteCollection({collection:c,setState:function(e){return t.setState(e)},load:function(){return t.load()},redirect:!1,addAlert:function(e){return t.addAlert(e)},deleteFromRepo:S})}))},deleteFromRepo:S}),m&&v().createElement(_.zb,{isOpen:m,onUploadSuccess:function(){return t.setState({redirect:(0,k.jV)(k.Jh.myImports,{},{namespace:f.collection_version.namespace})})},setOpen:function(e,n){return t.toggleImportModal(e,n)},collection:f.collection_version,namespace:f.collection_version.namespace}),v().createElement(_.T$,{className:"hub-header-bordered",title:d.Ru._({id:"DoJzLz"})}),!h&&v().createElement(_.Rx,(0,a.A)({count:i,ignoredParams:b,params:p,switcher:"search_view_type",updateParams:g},(0,_.L2)({featureFlags:this.context.featureFlags,ignoredParams:b}))),u?v().createElement(_.kt,null):h?v().createElement(_.a4,{title:d.Ru._({id:"V1hs4Y"}),description:d.Ru._({id:"6STYN5"})}):v().createElement(v().Fragment,null,v().createElement("section",{className:"collection-container"},this.renderCollections(l,{count:i,params:p,updateParams:g})),v().createElement("section",{className:"footer"},v().createElement(_.w1,{params:p,updateParams:g,count:i}))))}},{key:"toggleImportModal",value:function(e,t){t&&this.setState({alerts:[].concat((0,r.A)(this.state.alerts),[{title:t,variant:"warning"}])}),this.setState({showImportModal:e})}},{key:"renderCollections",value:function(e,t){var n=t.count,a=t.params,r=t.updateParams;return 0===e.length?v().createElement(_.br,{clearAllFilters:function(){C.mb.clearAllFilters({params:a,ignoredParams:["page","page_size","sort","view_type"],updateParams:r})}}):"list"===a.view_type?this.renderList(e):this.renderCards(e,{count:n,params:a,updateParams:r})}},{key:"renderCards",value:function(e,t){var n,r=this,l=t.count,o=t.params,i=t.updateParams;return v().createElement("div",{className:"hub-cards"},e.map((function(e,t){return v().createElement(_.DQ,(0,a.A)({key:t},e,{footer:r.renderSyncToogle(e.collection_version.name,e.collection_version.namespace),menu:r.renderMenu(!1,e),displaySignatures:r.context.featureFlags.display_signatures}))})),l>o.page_size*(null!==(n=o.page)&&void 0!==n?n:1)?v().createElement(_.vT,{onClick:function(){var e;return i(P(P({},o),{},{page:(null!==(e=o.page)&&void 0!==e?e:1)+1}))}}):null)}},{key:"handleControlClick",value:function(e){var t=this,n=e.collection_version.name;g.Xy.setDeprecation(e).then((function(a){var l=(0,C.dx)(a.data.task);return(0,C.aZ)(l).then((function(){var a=e.deprecated?d.Ru._({id:"QKaTiY",values:{name:n}}):d.Ru._({id:"BlYFt4",values:{name:n}});t.setState({alerts:[].concat((0,r.A)(t.state.alerts),[{title:a,variant:"success"}])}),t.load()}))})).catch((function(a){var l=a.response,o=l.status,i=l.statusText;t.setState({alerts:[].concat((0,r.A)(t.state.alerts),[{variant:"danger",title:e.deprecated?d.Ru._({id:"5dhPcd",values:{name:n}}):d.Ru._({id:"hEP0ZC",values:{name:n}}),description:(0,C.gJ)(o,i)}])})}))}},{key:"renderMenu",value:function(e,t){var n=this,a=(0,this.context.hasPermission)("galaxy.upload_to_namespace"),r=function(e){return{addAlert:function(e){return n.addAlert(e)},collection:t,openModal:function(){return n.setState({deleteCollection:t,confirmDelete:!1,deleteAll:e})}}},l=v().createElement(_.wj,{collection:t,"data-cy":"collection-kebab",onDelete:r(!0),onDeprecate:function(){return n.handleControlClick(t)},onRemove:r(!1),onUploadVersion:e?null:function(){return n.checkUploadPrivilleges(t)},wrapper:e?null:function(e){var t=e.any,n=e.children;return t?v().createElement("span",null,n):v().createElement("span",{className:"hidden-menu-space"})}});return e?{uploadButton:a?v().createElement(p.$n,{onClick:function(){return n.checkUploadPrivilleges(t)},variant:"secondary"},d.Ru._({id:"PHsJXN"})):null,dropdownMenu:l}:l}},{key:"renderSyncToogle",value:function(e,t){var n=this;return this.state.synclist?v().createElement(m.d,{id:t+"."+e,className:"sync-toggle",label:d.Ru._({id:"Nu4DdT"}),isChecked:this.isCollectionSynced(e,t),onChange:function(){return n.toggleCollectionSync(e,t)}}):null}},{key:"checkUploadPrivilleges",value:function(e){var t=this,n=function(){t.setState({alerts:[].concat((0,r.A)(t.state.alerts),[{title:d.Ru._({id:"XoMS0d"}),variant:"warning"}])})};g.U.get(e.collection_version.namespace,{include_related:"my_permissions"}).then((function(a){a.data.related_fields.my_permissions.includes("galaxy.upload_to_namespace")?t.setState({updateCollection:e,showImportModal:!0}):n()})).catch((function(){n()}))}},{key:"toggleCollectionSync",value:function(e,t){var n=this,a=P({},this.state.synclist),r=a.collections.findIndex((function(n){return n.name===e&&n.namespace===t}));r<0?a.collections.push({name:e,namespace:t}):a.collections.splice(r,1),g.qI.update(a.id,a).then((function(e){n.setState({synclist:e.data}),g.qI.curate(a.id).then((function(){return null}))}))}},{key:"isCollectionSynced",value:function(e,t){var n=this.state.synclist,a=n.collections.find((function(n){return n.name===e&&n.namespace===t}));return"include"===n.policy?!!a:!a}},{key:"renderList",value:function(e){var t=this;return v().createElement("div",{className:"list-container"},v().createElement("div",{className:"hub-list"},v().createElement(f.Tr,{className:"data-list","aria-label":d.Ru._({id:"74Eard"})},e.map((function(e,n){return v().createElement(_.wU,(0,a.A)({key:n,collection:e,displaySignatures:t.context.featureFlags.display_signatures,showNamespace:!0,synclistSwitch:t.renderSyncToogle(e.collection_version.name,e.collection_version.namespace)},t.renderMenu(!0,e)))})))))}},{key:"getSynclist",value:function(){var e=this;g.qI.list().then((function(t){1===t.data.meta.count?e.setState({synclist:t.data.data[0]}):console.error("my-synclist returned ".concat(t.data.meta.count," synclists"))}))}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){g.R4.list(P(P({},C.mb.getReduced(e.state.params,["view_type"])),{},{is_deprecated:!1,repository_label:"!hide_from_search",is_highest:!0})).then((function(t){e.setState({collections:t.data.data,count:t.data.meta.count,loading:!1})}))}))}},{key:"updateParams",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;C.mb.updateParams({params:e,navigate:function(e){return t.props.navigate(e)},setState:function(e){return t.setState(e,n)}})}}]),t}(h.Component);(0,u.A)(E,"contextType",S.B);const D=(0,C.y)(E)}}]);
//# sourceMappingURL=../sourcemaps/885.bed218df89285de40780ad5490a821eb.js.map