"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[5868],{15868:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var a=n(4942),r=n(44925),i=n(15861),o=n(42982),s=n(70885),l=n(15671),u=n(43144),c=n(79340),p=n(82963),d=n(61120),f=n(64687),m=n.n(f),v=n(89555),h=n(15021),g=n(92950),y=n.n(g),_=n(31286),b=n(65723),C=n(61542),k=n(15751),E=["sort"];function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var q=function(e){(0,c.Z)(U,e);var t,n,f,g,C,q=(g=U,C=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(g);if(C){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,p.Z)(this,e)});function U(e){var t;(0,l.Z)(this,U),t=q.call(this,e);var n=k.q6.parseParamString(e.location.search,["page","page_size"]);return n.page_size||(n.page_size=10),n.sort||(n.sort="-pulp_created"),n.repository_label||(n.repository_label="pipeline=staging"),t.state={versions:void 0,itemCount:0,params:n,loading:!0,updatingVersions:[],alerts:[],unauthorized:!1,inputText:"",uploadCertificateModalOpen:!1,versionToUploadCertificate:null,approveModalInfo:null,repositories:{approved:null,rejected:null}},t}return(0,u.Z)(U,[{key:"componentDidMount",value:function(){var e=this,t=this.context,n=t.user,a=t.hasPermission;n&&!n.is_anonymous&&a("ansible.modify_ansible_repo_content")?(this.setState({loading:!0}),Promise.all([this.queryCollections(!1),this.queryRepositories()]).then((function(){e.setState({loading:!1}),e.setState({updatingVersions:[]})}))):this.setState({unauthorized:!0})}},{key:"queryRepositories",value:function(){var e=this,t=function(t){return _.UX.list({page:1,page_size:1,pulp_label_select:"pipeline=".concat(t)}).then((function(e){var t=e.data,n=t.count,a=t.results;return 1===n?a[0]:null})).catch((function(n){return e.addAlert(v.ag._({id:"clie21",values:{pipeline:t}}),"danger",null==n?void 0:n.message),null}))};return Promise.all([t("approved"),t("rejected")]).then((function(t){var n=(0,s.Z)(t,2),a=n[0],r=n[1];return e.setState({repositories:{approved:a,rejected:r}})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.versions,a=t.params,r=t.itemCount,i=t.loading,o=t.unauthorized;return n||o?y().createElement(y().Fragment,null,y().createElement(b.UP,{title:v.ag._({id:"WSRF7q"})}),y().createElement(b.UW,{alerts:this.state.alerts,closeAlert:function(t){return e.closeAlert(t)}}),o?y().createElement(b.iA,null):y().createElement(b.or,{className:"hub-certification-dashboard"},y().createElement("section",{className:"body","data-cy":"body"},y().createElement("div",{className:"hub-toolbar"},y().createElement(h.Toolbar,null,y().createElement(h.ToolbarContent,null,y().createElement(h.ToolbarGroup,null,y().createElement(h.ToolbarItem,null,y().createElement(b.Kv,{inputText:this.state.inputText,onChange:function(t){e.setState({inputText:t})},updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},params:a,filterConfig:[{id:"namespace",title:v.ag._({id:"wMe2Qp"})},{id:"name",title:v.ag._({id:"Bcyiqj"})},{id:"repository_label",title:v.ag._({id:"uAQUqI"}),inputType:"select",options:[{id:"pipeline=rejected",title:v.ag._({id:"ekCRTP"})},{id:"pipeline=staging",title:v.ag._({id:"K7lqZC"})},{id:"pipeline=approved",title:v.ag._({id:"7kb4LU"})}]}]}))))),y().createElement(b.tl,{params:a,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:r,isTop:!0})),y().createElement("div",null,y().createElement(b.M$,{updateParams:function(t){e.updateParams(t,(function(){return e.queryCollections(!0)})),e.setState({inputText:""})},params:a,ignoredParams:["page_size","page","sort"],niceValues:{repository_label:{"pipeline=approved":v.ag._({id:"7kb4LU"}),"pipeline=rejected":v.ag._({id:"ekCRTP"}),"pipeline=staging":v.ag._({id:"K7lqZC"})}},niceNames:{name:v.ag._({id:"Bcyiqj"}),namespace:v.ag._({id:"wMe2Qp"}),repository_label:v.ag._({id:"uAQUqI"})}})),i?y().createElement(b.AW,null):this.renderTable(n,a),y().createElement("div",{className:"footer"},y().createElement(b.tl,{params:a,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:r}))),y().createElement(b.zk,{isOpen:this.state.uploadCertificateModalOpen,onCancel:function(){return e.closeUploadCertificateModal()},onSubmit:function(t){return e.submitCertificate(t)}}),this.state.approveModalInfo&&y().createElement(b.pE,{closeAction:function(){e.setState({approveModalInfo:null})},finishAction:function(){e.setState({approveModalInfo:null}),e.queryCollections(!0)},collectionVersion:this.state.approveModalInfo,addAlert:function(t){return e.addAlertObj(t)}}))):y().createElement(b.gO,null)}},{key:"renderTable",value:function(e,t){var n=this;if(0===e.length)return(0,k.vS)(t,["namespace","name","repository_label"])?y().createElement(b.ei,null):y().createElement(b.vv,{title:v.ag._({id:"f1gH0D"}),description:v.ag._({id:"6STYN5"})});var a={headers:[{title:v.ag._({id:"wMe2Qp"}),type:"alpha",id:"namespace"},{title:v.ag._({id:"q+hNag"}),type:"alpha",id:"name"},{title:v.ag._({id:"eE0JZ4"}),type:"number",id:"version"},{title:v.ag._({id:"u46WEi"}),type:"number",id:"pulp_created"},{title:v.ag._({id:"IreQBq"}),type:"none",id:""},{title:v.ag._({id:"uAQUqI"}),type:"none",id:"repository_label"},{title:"",type:"none",id:"certify"}]};return y().createElement("table",{"aria-label":v.ag._({id:"QGV1gp"}),className:"hub-c-table-content pf-c-table"},y().createElement(b.h2,{options:a,params:t,updateParams:function(e){return n.updateParams(e,(function(){return n.queryCollections(!0)}))}}),y().createElement("tbody",null,e.map((function(e,t){return y().createElement(b.q8,{approve:function(e){return n.approve(e)},collectionVersion:e,context:n.context,isVersionUpdating:function(e){return n.isVersionUpdating(e)},key:t,openUploadCertificateModal:function(e){return n.openUploadCertificateModal(e)},reject:function(e){return n.reject(e)}})}))))}},{key:"isVersionUpdating",value:function(e){return!!this.state.updatingVersions.find((function(t){return t==e}))}},{key:"openUploadCertificateModal",value:function(e){this.setState({uploadCertificateModalOpen:!0,versionToUploadCertificate:e})}},{key:"closeUploadCertificateModal",value:function(){this.setState({uploadCertificateModalOpen:!1,versionToUploadCertificate:null})}},{key:"submitCertificate",value:function(e){var t=this,n=this.state.versionToUploadCertificate,a=n.collection_version,r=n.repository,i=a.pulp_href,o=a.name,s=a.namespace,l=a.version;_.Xp.upload({file:e,repository:r.pulp_href,signed_collection:i}).then((function(e){var t=e.data.task;return(0,k.BA)(t)})).then((function(){return t.addAlert(v.ag._({id:"EeVTY1",values:{namespace:s,name:o,version:l}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var n=e.response?(0,k.N3)(e.response.status,e.response.statusText):e;t.addAlert(v.ag._({id:"CAcrUo",values:{namespace:s,name:o,version:l}}),"danger",n)})).finally((function(){return t.closeUploadCertificateModal()}))}},{key:"setUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:[].concat((0,o.Z)(t),[e])})}},{key:"unsetUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:t.filter((function(t){return t!==e}))})}},{key:"approve",value:(f=(0,i.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.state.repositories).approved?this.move(t,n.approved):this.setState({approveModalInfo:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"reject",value:(n=(0,i.Z)(m().mark((function e(t){var n,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.state.repositories).rejected){e.next=5;break}return a=t.collection_version,this.addAlert(v.ag._({id:"vwJz0n",values:{0:a.namespace,1:a.name,2:a.version}}),"danger",v.ag._({id:"F020md"})),e.abrupt("return");case 5:return e.next=7,this.isRejected(t);case 7:if(!e.sent){e.next=11;break}this.remove(t),e.next=12;break;case 11:this.move(t,n.rejected);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"move",value:function(e,t){var n=this,a=e.collection_version,r=e.repository;return this.setUpdatingVersion(e),Promise.all([(0,k.YH)(r.name,r.pulp_href),(0,k.YH)(t.name,t.pulp_href)]).then((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return _.eq.move(a.namespace,a.name,a.version,n,r)})).then((function(e){return(0,k.BA)(e.data.remove_task_id,{waitMs:500})})).then((function(){return n.addAlert(v.ag._({id:"f0S6WW",values:{0:a.namespace,1:a.name,2:a.version}}),"success")})).then((function(){return n.queryCollections(!0)})).catch((function(e){var t=e.response?(0,k.N3)(e.response.status,e.response.statusText):e;n.addAlert(v.ag._({id:"vwJz0n",values:{0:a.namespace,1:a.name,2:a.version}}),"danger",t)})).finally((function(){return n.unsetUpdatingVersion(e)}))}},{key:"remove",value:function(e){var t=this,n=e.collection_version,a=e.repository;return this.setUpdatingVersion(e),_.UX.removeContent((0,k.LL)(a.pulp_href),n.pulp_href).then((function(e){var t=e.data.task;return(0,k.bt)(t)})).then((function(){return t.addAlert(v.ag._({id:"f0S6WW",values:{0:n.namespace,1:n.name,2:n.version}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var a=e.response?(0,k.N3)(e.response.status,e.response.statusText):e;t.addAlert(v.ag._({id:"vwJz0n",values:{0:n.namespace,1:n.name,2:n.version}}),"danger",a)})).finally((function(){return t.unsetUpdatingVersion(e)}))}},{key:"isRejected",value:(t=(0,i.Z)(m().mark((function e(t){var n,a,r,i,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state.repositories,a=t.collection_version,r=a.name,i=a.namespace,o=a.version,e.abrupt("return",_.eq.list({name:r,namespace:i,page:1,page_size:1,repository:(0,k.LL)(n.rejected.pulp_href),version:o}).then((function(e){return!!e.data.meta.count})).catch((function(){return!1})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"queryCollections",value:function(e){var t=this;e&&this.setState({loading:!0});var n=this.state.params,i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({order_by:n.sort},(0,r.Z)(n,E));return _.eq.list(i).then((function(n){t.setState({versions:n.data.data,itemCount:n.data.meta.count}),e&&t.setState({loading:!1,updatingVersions:[]})})).catch((function(e){t.addAlert(v.ag._({id:"A5KmrN"}),"danger",null==e?void 0:e.message),t.setState({loading:!1,updatingVersions:[]})}))}},{key:"updateParams",get:function(){return k.q6.updateParamsMixin()}},{key:"closeAlert",get:function(){return(0,b.NQ)("alerts")}},{key:"addAlert",value:function(e,t,n){this.setState({alerts:[].concat((0,o.Z)(this.state.alerts),[{description:n,title:e,variant:t}])})}},{key:"addAlertObj",value:function(e){this.addAlert(e.title,e.variant,e.description)}}]),U}(y().Component);const U=(0,k.EN)(q);q.contextType=C.I}}]);
//# sourceMappingURL=../sourcemaps/5868.420d895a141b6621d408b7df7640ba30.js.map