"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[960],{60960:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var r=n(52536),a=n(52822),i=n(1528),s=n(60888),o=n(98920),l=n(87088),c=n(92920),u=n(42232),p=n(76184),d=n(36884),f=n(33248),m=n.n(f),v=n(72956),h=n(77104),_=n(18232),y=n.n(_),g=n(59072),b=n(49368),C=n(76708),k=n(58860),E=["sort"];function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e,t,n){return t=(0,p.c)(t),(0,u.c)(e,j()?Reflect.construct(t,n||[],(0,p.c)(e).constructor):t.apply(e,n))}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(j=function(){return!!e})()}var A=function(e){function t(e){var n;(0,l.c)(this,t),n=S(this,t,[e]);var r=k.us.parseParamString(e.location.search,["page","page_size"]);return r.page_size||(r.page_size=10),r.sort||(r.sort="-pulp_created"),r.repository_label||(r.repository_label="pipeline=staging"),n.state={versions:void 0,itemCount:0,params:r,loading:!0,updatingVersions:[],alerts:[],unauthorized:!1,inputText:"",uploadCertificateModalOpen:!1,versionToUploadCertificate:null,approveModalInfo:null,repositories:{approved:null,rejected:null}},n}var n,u,p;return(0,d.c)(t,e),(0,c.c)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.context,n=t.user,r=t.hasPermission;n&&!n.is_anonymous&&r("ansible.modify_ansible_repo_content")?(this.setState({loading:!0}),Promise.all([this.queryCollections(!1),this.queryRepositories()]).then((function(){e.setState({loading:!1}),e.setState({updatingVersions:[]})}))):this.setState({unauthorized:!0})}},{key:"queryRepositories",value:function(){var e=this,t=function(t){return g.CG.list({page:1,page_size:1,pulp_label_select:"pipeline=".concat(t)}).then((function(e){var t=e.data,n=t.count,r=t.results;return 1===n?r[0]:null})).catch((function(n){return e.addAlert(v._s._({id:"clie21",values:{pipeline:t}}),"danger",null==n?void 0:n.message),null}))};return Promise.all([t("approved"),t("rejected")]).then((function(t){var n=(0,o.c)(t,2),r=n[0],a=n[1];return e.setState({repositories:{approved:r,rejected:a}})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.versions,r=t.params,a=t.itemCount,i=t.loading,s=t.unauthorized;return n||s?y().createElement(y().Fragment,null,y().createElement(b.wy,{title:v._s._({id:"WSRF7q"})}),y().createElement(b.WW,{alerts:this.state.alerts,closeAlert:function(t){return e.closeAlert(t)}}),s?y().createElement(b.a8,null):y().createElement(b.GK,{className:"hub-certification-dashboard"},y().createElement("section",{className:"body","data-cy":"body"},y().createElement("div",{className:"hub-toolbar"},y().createElement(h.Toolbar,null,y().createElement(h.ToolbarContent,null,y().createElement(h.ToolbarGroup,null,y().createElement(h.ToolbarItem,null,y().createElement(b.oh,{inputText:this.state.inputText,onChange:function(t){e.setState({inputText:t})},updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},params:r,filterConfig:[{id:"namespace",title:v._s._({id:"wMe2Qp"})},{id:"name",title:v._s._({id:"Bcyiqj"})},{id:"repository_label",title:v._s._({id:"uAQUqI"}),inputType:"select",options:[{id:"pipeline=rejected",title:v._s._({id:"ekCRTP"})},{id:"pipeline=staging",title:v._s._({id:"K7lqZC"})},{id:"pipeline=approved",title:v._s._({id:"7kb4LU"})}]}]}))))),y().createElement(b.eM,{params:r,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:a,isTop:!0})),y().createElement("div",null,y().createElement(b.IP,{updateParams:function(t){e.updateParams(t,(function(){return e.queryCollections(!0)})),e.setState({inputText:""})},params:r,ignoredParams:["page_size","page","sort"],niceValues:{repository_label:{"pipeline=approved":v._s._({id:"7kb4LU"}),"pipeline=rejected":v._s._({id:"ekCRTP"}),"pipeline=staging":v._s._({id:"K7lqZC"})}},niceNames:{name:v._s._({id:"Bcyiqj"}),namespace:v._s._({id:"wMe2Qp"}),repository_label:v._s._({id:"uAQUqI"})}})),i?y().createElement(b.cI,null):this.renderTable(n,r),y().createElement("div",{className:"footer"},y().createElement(b.eM,{params:r,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:a}))),y().createElement(b.cv,{isOpen:this.state.uploadCertificateModalOpen,onCancel:function(){return e.closeUploadCertificateModal()},onSubmit:function(t){return e.submitCertificate(t)}}),this.state.approveModalInfo&&y().createElement(b.YF,{closeAction:function(){e.setState({approveModalInfo:null})},finishAction:function(){e.setState({approveModalInfo:null}),e.queryCollections(!0)},collectionVersion:this.state.approveModalInfo,addAlert:function(t){return e.addAlertObj(t)}}))):y().createElement(b.Qz,null)}},{key:"renderTable",value:function(e,t){var n=this;if(0===e.length)return(0,k.o5)(t,["namespace","name","repository_label"])?y().createElement(b.YX,null):y().createElement(b.BL,{title:v._s._({id:"f1gH0D"}),description:v._s._({id:"6STYN5"})});var r={headers:[{title:v._s._({id:"wMe2Qp"}),type:"alpha",id:"namespace"},{title:v._s._({id:"q+hNag"}),type:"alpha",id:"name"},{title:v._s._({id:"eE0JZ4"}),type:"number",id:"version"},{title:v._s._({id:"u46WEi"}),type:"number",id:"pulp_created"},{title:v._s._({id:"IreQBq"}),type:"none",id:""},{title:v._s._({id:"uAQUqI"}),type:"none",id:"repository_label"},{title:"",type:"none",id:"certify"}]};return y().createElement("table",{"aria-label":v._s._({id:"QGV1gp"}),className:"hub-c-table-content pf-c-table"},y().createElement(b.K_,{options:r,params:t,updateParams:function(e){return n.updateParams(e,(function(){return n.queryCollections(!0)}))}}),y().createElement("tbody",null,e.map((function(e,t){return y().createElement(b.Yz,{approve:function(e){return n.approve(e)},collectionVersion:e,context:n.context,isVersionUpdating:function(e){return n.isVersionUpdating(e)},key:t,openUploadCertificateModal:function(e){return n.openUploadCertificateModal(e)},reject:function(e){return n.reject(e)}})}))))}},{key:"isVersionUpdating",value:function(e){return!!this.state.updatingVersions.find((function(t){return t==e}))}},{key:"openUploadCertificateModal",value:function(e){this.setState({uploadCertificateModalOpen:!0,versionToUploadCertificate:e})}},{key:"closeUploadCertificateModal",value:function(){this.setState({uploadCertificateModalOpen:!1,versionToUploadCertificate:null})}},{key:"submitCertificate",value:function(e){var t=this,n=this.state.versionToUploadCertificate,r=n.collection_version,a=n.repository,i=r.pulp_href,s=r.name,o=r.namespace,l=r.version;g.Pc.upload({file:e,repository:a.pulp_href,signed_collection:i}).then((function(e){var t=e.data.task;return(0,k.iS)(t)})).then((function(){return t.addAlert(v._s._({id:"EeVTY1",values:{namespace:o,name:s,version:l}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var n=e.response?(0,k._A)(e.response.status,e.response.statusText):e;t.addAlert(v._s._({id:"CAcrUo",values:{namespace:o,name:s,version:l}}),"danger",n)})).finally((function(){return t.closeUploadCertificateModal()}))}},{key:"setUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:[].concat((0,s.c)(t),[e])})}},{key:"unsetUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:t.filter((function(t){return t!==e}))})}},{key:"approve",value:(p=(0,i.c)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.state.repositories).approved?this.move(t,n.approved):this.setState({approveModalInfo:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"reject",value:(u=(0,i.c)(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.state.repositories).rejected){e.next=5;break}return r=t.collection_version,this.addAlert(v._s._({id:"vwJz0n",values:{0:r.namespace,1:r.name,2:r.version}}),"danger",v._s._({id:"F020md"})),e.abrupt("return");case 5:return e.next=7,this.isRejected(t);case 7:if(!e.sent){e.next=11;break}this.remove(t),e.next=12;break;case 11:this.move(t,n.rejected);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"move",value:function(e,t){var n=this,r=e.collection_version,a=e.repository;return this.setUpdatingVersion(e),Promise.all([(0,k.cV)(a.name,a.pulp_href),(0,k.cV)(t.name,t.pulp_href)]).then((function(e){var t=(0,o.c)(e,2),n=t[0],a=t[1];return g.Rz.move(r.namespace,r.name,r.version,n,a)})).then((function(e){return(0,k.iS)(e.data.remove_task_id,{waitMs:500})})).then((function(){return n.addAlert(v._s._({id:"f0S6WW",values:{0:r.namespace,1:r.name,2:r.version}}),"success")})).then((function(){return n.queryCollections(!0)})).catch((function(e){var t=e.response?(0,k._A)(e.response.status,e.response.statusText):e;n.addAlert(v._s._({id:"vwJz0n",values:{0:r.namespace,1:r.name,2:r.version}}),"danger",t)})).finally((function(){return n.unsetUpdatingVersion(e)}))}},{key:"remove",value:function(e){var t=this,n=e.collection_version,r=e.repository;return this.setUpdatingVersion(e),g.CG.removeContent((0,k.oL)(r.pulp_href),n.pulp_href).then((function(e){var t=e.data.task;return(0,k.i8)(t)})).then((function(){return t.addAlert(v._s._({id:"f0S6WW",values:{0:n.namespace,1:n.name,2:n.version}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var r=e.response?(0,k._A)(e.response.status,e.response.statusText):e;t.addAlert(v._s._({id:"vwJz0n",values:{0:n.namespace,1:n.name,2:n.version}}),"danger",r)})).finally((function(){return t.unsetUpdatingVersion(e)}))}},{key:"isRejected",value:(n=(0,i.c)(m().mark((function e(t){var n,r,a,i,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state.repositories,r=t.collection_version,a=r.name,i=r.namespace,s=r.version,e.abrupt("return",g.Rz.list({name:a,namespace:i,page:1,page_size:1,repository:(0,k.oL)(n.rejected.pulp_href),version:s}).then((function(e){return!!e.data.meta.count})).catch((function(){return!1})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"queryCollections",value:function(e){var t=this;e&&this.setState({loading:!0});var n=this.state.params,i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,r.c)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({order_by:n.sort},(0,a.c)(n,E));return g.Rz.list(i).then((function(n){t.setState({versions:n.data.data,itemCount:n.data.meta.count}),e&&t.setState({loading:!1,updatingVersions:[]})})).catch((function(e){t.addAlert(v._s._({id:"A5KmrN"}),"danger",null==e?void 0:e.message),t.setState({loading:!1,updatingVersions:[]})}))}},{key:"updateParams",get:function(){return k.us.updateParamsMixin()}},{key:"closeAlert",get:function(){return(0,b.Yi)("alerts")}},{key:"addAlert",value:function(e,t,n){this.setState({alerts:[].concat((0,s.c)(this.state.alerts),[{description:n,title:e,variant:t}])})}},{key:"addAlertObj",value:function(e){this.addAlert(e.title,e.variant,e.description)}}]),t}(y().Component);const O=(0,k.Ak)(A);A.contextType=C.c}}]);
//# sourceMappingURL=../sourcemaps/960.59b6cfdb544ae4d61afab5d109c8c245.js.map