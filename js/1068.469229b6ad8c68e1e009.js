"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[1068],{11068:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var a=n(52536),r=n(45072),l=n(60888),o=n(87088),c=n(92920),i=n(42232),s=n(76184),u=n(36884),d=n(72956),p=n(77104),m=n(18232),f=n.n(m),h=n(50708),y=n(59072),v=n(49368),g=n(47580),_=n(76708),S=n(32004),E=n(58860);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,a.c)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t,n){return t=(0,s.c)(t),(0,i.c)(e,w()?Reflect.construct(t,n||[],(0,s.c)(e).constructor):t.apply(e,n))}function w(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(w=function(){return!!e})()}var b=function(e){function t(e){var n;(0,o.c)(this,t),n=P(this,t,[e]);var a=E.us.parseParamString(e.location.search,["page","page_size"]);return a.page_size||(a.page_size=g.M.DEFAULT_PAGE_SIZE),a.view_type||(a.view_type=localStorage.getItem(g.M.SEARCH_VIEW_TYPE_LOCAL_KEY)),a.sort||(a.sort="name"),n.state={collections:[],params:a,count:0,loading:!0,synclist:void 0,alerts:[],updateCollection:null,showImportModal:!1,redirect:null,noDependencies:!1,deleteCollection:null,confirmDelete:!1,isDeletionPending:!1,deleteAll:!0},n}return(0,u.c)(t,e),(0,c.c)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.queryCollections(),this.getSynclist()}},{key:"addAlert",value:function(e){this.setState({alerts:[].concat((0,l.c)(this.state.alerts),[e])})}},{key:"closeAlert",get:function(){return(0,v.Yi)("alerts")}},{key:"render",value:function(){var e,t=this;if(this.state.redirect)return f().createElement(h.Navigate,{to:this.state.redirect});var n=this.state,a=n.loading,l=n.collections,o=n.params,c=n.count,i=n.showImportModal,s=n.updateCollection,u=n.deleteCollection,p=n.confirmDelete,m=n.isDeletionPending,y=0===l.length&&!(0,E.o5)(o,["keywords","tags","is_signed","repository_name","namespace"]),_=function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},k=this.state.deleteAll?null:null==u||null===(e=u.repository)||void 0===e?void 0:e.name,C=["page","page_size","sort","view_type"];return f().createElement("div",{className:"search-page"},f().createElement(v.WW,{alerts:this.state.alerts,closeAlert:function(e){return t.closeAlert(e)}}),f().createElement(v.iy,{deleteCollection:u,collections:l,isDeletionPending:m,confirmDelete:p,setConfirmDelete:function(e){return t.setState({confirmDelete:e})},cancelAction:function(){return t.setState({deleteCollection:null})},deleteAction:function(){return t.setState({isDeletionPending:!0},(function(){return E.em.deleteCollection({collection:u,setState:function(e){return t.setState(e)},load:function(){return t.load()},redirect:!1,addAlert:function(e){return t.addAlert(e)},deleteFromRepo:k})}))},deleteFromRepo:k}),i&&f().createElement(v.uS,{isOpen:i,onUploadSuccess:function(){return t.setState({redirect:(0,S.oD)(S.uk.myImports,{},{namespace:s.collection_version.namespace})})},setOpen:function(e,n){return t.toggleImportModal(e,n)},collection:s.collection_version,namespace:s.collection_version.namespace}),f().createElement(v.wy,{className:"hub-header-bordered",title:d._s._({id:"DoJzLz"})}),!y&&f().createElement(v.ah,(0,r.c)({count:c,ignoredParams:C,params:o,switcher:g.M.SEARCH_VIEW_TYPE_LOCAL_KEY,updateParams:_},(0,v.MJ)({featureFlags:this.context.featureFlags,ignoredParams:C}))),a?f().createElement(v.cI,null):y?f().createElement(v.BL,{title:d._s._({id:"V1hs4Y"}),description:d._s._({id:"6STYN5"})}):f().createElement(f().Fragment,null,f().createElement("section",{className:"collection-container"},this.renderCollections(l,{count:c,params:o,updateParams:_})),f().createElement("section",{className:"footer"},f().createElement(v.eM,{params:o,updateParams:_,count:c}))))}},{key:"toggleImportModal",value:function(e,t){t&&this.setState({alerts:[].concat((0,l.c)(this.state.alerts),[{title:t,variant:"warning"}])}),this.setState({showImportModal:e})}},{key:"renderCollections",value:function(e,t){var n=t.count,a=t.params,r=t.updateParams;return 0===e.length?f().createElement(v.YX,{clearAllFilters:function(){E.us.clearAllFilters({params:a,ignoredParams:["page","page_size","sort","view_type"],updateParams:r})}}):"list"===a.view_type?this.renderList(e):this.renderCards(e,{count:n,params:a,updateParams:r})}},{key:"renderCards",value:function(e,t){var n,a=this,l=t.count,o=t.params,c=t.updateParams;return f().createElement("div",{className:"hub-cards"},e.map((function(e,t){return f().createElement(v.At,(0,r.c)({key:t},e,{footer:a.renderSyncToogle(e.collection_version.name,e.collection_version.namespace),menu:a.renderMenu(!1,e),displaySignatures:a.context.featureFlags.display_signatures}))})),l>o.page_size*(null!==(n=o.page)&&void 0!==n?n:1)?f().createElement(v.uy,{onClick:function(){var e;return c(C(C({},o),{},{page:(null!==(e=o.page)&&void 0!==e?e:1)+1}))}}):null)}},{key:"handleControlClick",value:function(e){var t=this,n=e.collection_version.name;y.a4.setDeprecation(e).then((function(a){var r=(0,E.oL)(a.data.task);return(0,E.iS)(r).then((function(){var a=e.deprecated?d._s._({id:"QKaTiY",values:{name:n}}):d._s._({id:"BlYFt4",values:{name:n}});t.setState({alerts:[].concat((0,l.c)(t.state.alerts),[{title:a,variant:"success"}])}),t.load()}))})).catch((function(a){var r=a.response,o=r.status,c=r.statusText;t.setState({alerts:[].concat((0,l.c)(t.state.alerts),[{variant:"danger",title:e.deprecated?d._s._({id:"5dhPcd",values:{name:n}}):d._s._({id:"hEP0ZC",values:{name:n}}),description:(0,E._A)(o,c)}])})}))}},{key:"renderMenu",value:function(e,t){var n=this,a=(0,this.context.hasPermission)("galaxy.upload_to_namespace"),r=function(e){return{addAlert:function(e){return n.addAlert(e)},collection:t,openModal:function(){return n.setState({deleteCollection:t,confirmDelete:!1,deleteAll:e})}}},l=f().createElement(v._g,{collection:t,"data-cy":"collection-kebab",onDelete:r(!0),onDeprecate:function(){return n.handleControlClick(t)},onRemove:r(!1),onUploadVersion:e?null:function(){return n.checkUploadPrivilleges(t)},wrapper:e?null:function(e){var t=e.any,n=e.children;return t?f().createElement("span",null,n):f().createElement("span",{className:"hidden-menu-space"})}});return e?{uploadButton:a?f().createElement(p.Button,{onClick:function(){return n.checkUploadPrivilleges(t)},variant:"secondary"},d._s._({id:"PHsJXN"})):null,dropdownMenu:l}:l}},{key:"renderSyncToogle",value:function(e,t){var n=this;return this.state.synclist?f().createElement(p.Switch,{id:t+"."+e,className:"sync-toggle",label:d._s._({id:"Nu4DdT"}),isChecked:this.isCollectionSynced(e,t),onChange:function(){return n.toggleCollectionSync(e,t)}}):null}},{key:"checkUploadPrivilleges",value:function(e){var t=this,n=function(){t.setState({alerts:[].concat((0,l.c)(t.state.alerts),[{title:d._s._({id:"XoMS0d"}),variant:"warning"}])})};y.JD.get(e.collection_version.namespace,{include_related:"my_permissions"}).then((function(a){a.data.related_fields.my_permissions.includes("galaxy.upload_to_namespace")?t.setState({updateCollection:e,showImportModal:!0}):n()})).catch((function(){n()}))}},{key:"toggleCollectionSync",value:function(e,t){var n=this,a=C({},this.state.synclist),r=a.collections.findIndex((function(n){return n.name===e&&n.namespace===t}));r<0?a.collections.push({name:e,namespace:t}):a.collections.splice(r,1),y.If.update(a.id,a).then((function(e){n.setState({synclist:e.data}),y.If.curate(a.id).then((function(){return null}))}))}},{key:"isCollectionSynced",value:function(e,t){var n=this.state.synclist,a=n.collections.find((function(n){return n.name===e&&n.namespace===t}));return"include"===n.policy?!!a:!a}},{key:"renderList",value:function(e){var t=this;return f().createElement("div",{className:"list-container"},f().createElement("div",{className:"hub-list"},f().createElement(p.DataList,{className:"data-list","aria-label":d._s._({id:"74Eard"})},e.map((function(e,n){return f().createElement(v.Cq,(0,r.c)({key:n,collection:e,displaySignatures:t.context.featureFlags.display_signatures,showNamespace:!0,synclistSwitch:t.renderSyncToogle(e.collection_version.name,e.collection_version.namespace)},t.renderMenu(!0,e)))})))))}},{key:"getSynclist",value:function(){var e=this;y.If.list().then((function(t){1===t.data.meta.count?e.setState({synclist:t.data.data[0]}):console.error("my-synclist returned ".concat(t.data.meta.count," synclists"))}))}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){y.Rz.list(C(C({},E.us.getReduced(e.state.params,["view_type"])),{},{is_deprecated:!1,repository_label:"!hide_from_search",is_highest:!0})).then((function(t){e.setState({collections:t.data.data,count:t.data.meta.count,loading:!1})}))}))}},{key:"updateParams",get:function(){return E.us.updateParamsMixin()}}]),t}(f().Component);const D=(0,E.Ak)(b);b.contextType=_.c}}]);
//# sourceMappingURL=1068.469229b6ad8c68e1e009.js.map