{"version":3,"sources":["webpack:///./src/containers/my-imports/my-imports.scss","webpack:///./src/containers/my-imports/my-imports.scss?3a0d","webpack:///./src/containers/my-imports/my-imports.tsx"],"names":["module","exports","push","i","content","options","transform","undefined","update","locals","hot","accept","newContent","a","b","key","idx","Error","dispose","props","params","parseParamString","location","search","topOfPage","state","selectedImport","importList","namespaces","selectedImportDetails","resultsCount","importDetailError","followLogs","loadingImports","loadingImportDetails","selectedCollectionVersion","componentDidMount","this","loadNamespaces","loadImportList","loadTaskDetails","polling","setInterval","running","waiting","poll","componentWillUnmount","clearInterval","render","ref","title","className","loading","numberOfResults","selectImport","sImport","updateParams","setState","task","followMessages","setFollowMessages","isFollowing","apiError","collectionVersion","updateParamsMixin","current","scrollIntoView","behavior","importIndex","findIndex","x","id","imports","newSelectedImport","finished_at","callback","list","page_size","then","result","selectedNS","data","namespace","find","name","catch","console","log","sort","meta","count","get","importDeets","version","finally","MyImports","myimports","displayName","__docgenInfo","STORYBOOK_REACT_CLASSES","docgenInfo","path","__react_docgen_typescript_loader_error"],"mappings":"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","file":"js/my_imports.js","sourcesContent":["exports = module.exports = require(\"../../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".page-container{display:flex}.page-container .import-list{width:400px}.page-container .import-console{flex-grow:1;margin-left:10px}\", \"\"]);\n\n","\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/sass-loader/dist/cjs.js!./my-imports.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/sass-loader/dist/cjs.js!./my-imports.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/sass-loader/dist/cjs.js!./my-imports.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","import * as React from 'react';\nimport './my-imports.scss';\n\nimport { withRouter, RouteComponentProps } from 'react-router-dom';\nimport { Section } from '@redhat-cloud-services/frontend-components';\nimport { cloneDeep } from 'lodash';\n\nimport { BaseHeader, ImportConsole, ImportList, Main } from 'src/components';\n\nimport {\n  ImportAPI,\n  ImportDetailType,\n  ImportListType,\n  NamespaceType,\n  PulpStatus,\n  MyNamespaceAPI,\n  CollectionVersion,\n  CollectionVersionAPI,\n} from 'src/api';\n\nimport { ParamHelper } from 'src/utilities/param-helper';\n\ninterface IState {\n  selectedImport: ImportListType;\n  importList: ImportListType[];\n  selectedImportDetails: ImportDetailType;\n  selectedCollectionVersion: CollectionVersion;\n  params: {\n    page_size?: number;\n    page?: number;\n    keyword?: string;\n    namespace?: string;\n  };\n  namespaces: NamespaceType[];\n  resultsCount: number;\n  importDetailError: string;\n  followLogs: boolean;\n  loadingImports: boolean;\n  loadingImportDetails: boolean;\n}\n\nclass MyImports extends React.Component<RouteComponentProps, IState> {\n  polling: any;\n  topOfPage: any;\n\n  constructor(props) {\n    super(props);\n\n    const params = ParamHelper.parseParamString(props.location.search, [\n      'page',\n      'page_size',\n    ]);\n\n    this.topOfPage = React.createRef();\n\n    this.state = {\n      selectedImport: undefined,\n      importList: [],\n      params: params,\n      namespaces: [],\n      selectedImportDetails: undefined,\n      resultsCount: 0,\n      importDetailError: '',\n      followLogs: false,\n      loadingImports: true,\n      loadingImportDetails: true,\n      selectedCollectionVersion: undefined,\n    };\n  }\n\n  componentDidMount() {\n    // Load namespaces, use the namespaces to query the import list,\n    // use the import list to load the task details\n    this.loadNamespaces(() =>\n      this.loadImportList(() => this.loadTaskDetails()),\n    );\n\n    this.polling = setInterval(() => {\n      if (\n        this.state.selectedImportDetails &&\n        (this.state.selectedImportDetails.state === PulpStatus.running ||\n          this.state.selectedImportDetails.state === PulpStatus.waiting)\n      ) {\n        this.poll();\n      }\n    }, 10000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.polling);\n  }\n\n  render() {\n    const {\n      selectedImport,\n      importList,\n      params,\n      namespaces,\n      selectedImportDetails,\n      resultsCount,\n      loadingImports,\n      loadingImportDetails,\n      importDetailError,\n      followLogs,\n      selectedCollectionVersion,\n    } = this.state;\n\n    if (!importList) {\n      return null;\n    }\n\n    return (\n      <React.Fragment>\n        <div ref={this.topOfPage}></div>\n        <BaseHeader title='My imports' />\n        <Main>\n          <Section className='body'>\n            <div className='page-container'>\n              <div className='import-list'>\n                <ImportList\n                  importList={importList}\n                  selectedImport={selectedImport}\n                  loading={loadingImports}\n                  numberOfResults={resultsCount}\n                  params={params}\n                  namespaces={namespaces}\n                  selectImport={sImport => this.selectImport(sImport)}\n                  updateParams={params => {\n                    this.updateParams(params, () =>\n                      this.setState(\n                        {\n                          loadingImports: true,\n                          loadingImportDetails: true,\n                        },\n                        () => this.loadImportList(() => this.loadTaskDetails()),\n                      ),\n                    );\n                  }}\n                />\n              </div>\n\n              <div className='import-console'>\n                <ImportConsole\n                  loading={loadingImportDetails}\n                  task={selectedImportDetails}\n                  followMessages={followLogs}\n                  setFollowMessages={isFollowing => {\n                    this.setState({\n                      followLogs: isFollowing,\n                    });\n                  }}\n                  selectedImport={selectedImport}\n                  apiError={importDetailError}\n                  collectionVersion={selectedCollectionVersion}\n                />\n              </div>\n            </div>\n          </Section>\n        </Main>\n      </React.Fragment>\n    );\n  }\n\n  private get updateParams() {\n    return ParamHelper.updateParamsMixin();\n  }\n\n  private selectImport(sImport) {\n    this.setState(\n      { selectedImport: sImport, loadingImportDetails: true },\n      () => {\n        this.topOfPage.current.scrollIntoView({\n          behavior: 'smooth',\n        });\n        this.loadTaskDetails();\n      },\n    );\n  }\n\n  private poll() {\n    this.loadTaskDetails(() => {\n      // Update the state of the selected import in the list if it's\n      // different from the one loaded from the API.\n      const { selectedImport, selectedImportDetails, importList } = this.state;\n\n      if (!selectedImportDetails) {\n        return;\n      }\n\n      if (selectedImport.state !== selectedImportDetails.state) {\n        const importIndex = importList.findIndex(\n          x => x.id === selectedImport.id,\n        );\n\n        const imports = cloneDeep(importList);\n        const newSelectedImport = cloneDeep(selectedImport);\n\n        newSelectedImport.state = selectedImportDetails.state;\n        newSelectedImport.finished_at = selectedImportDetails.finished_at;\n\n        imports[importIndex] = newSelectedImport;\n\n        this.setState({\n          selectedImport: newSelectedImport,\n          importList: imports,\n        });\n      }\n    });\n  }\n\n  private loadNamespaces(callback?: () => void) {\n    MyNamespaceAPI.list({ page_size: 1000 })\n      .then(result => {\n        const namespaces = result.data.data;\n        let selectedNS;\n\n        if (this.state.params.namespace) {\n          selectedNS = namespaces.find(\n            x => x.name === this.state.params.namespace,\n          );\n        }\n\n        if (!selectedNS) {\n          selectedNS = namespaces[0];\n        }\n\n        this.setState(\n          {\n            namespaces: namespaces,\n            params: {\n              ...this.state.params,\n              namespace: selectedNS.name,\n            },\n          },\n          callback,\n        );\n      })\n      .catch(result => console.log(result));\n  }\n\n  private loadImportList(callback?: () => void) {\n    ImportAPI.list({ ...this.state.params, sort: '-created' })\n      .then(importList => {\n        this.setState(\n          {\n            importList: importList.data.data,\n            selectedImport: importList.data.data[0],\n            resultsCount: importList.data.meta.count,\n            loadingImports: false,\n          },\n          callback,\n        );\n      })\n      .catch(result => console.log(result));\n  }\n\n  private loadTaskDetails(callback?: () => void) {\n    if (!this.state.selectedImport) {\n      this.setState({\n        importDetailError: 'No data',\n        loadingImportDetails: false,\n      });\n    } else {\n      ImportAPI.get(this.state.selectedImport.id)\n        .then(result => {\n          this.setState(\n            {\n              importDetailError: '',\n              loadingImportDetails: false,\n              selectedImportDetails: result.data,\n              selectedCollectionVersion: undefined,\n            },\n            () => {\n              const importDeets = this.state.selectedImportDetails;\n\n              // have to use list instead of get because repository_list isn't\n              // available on collection version details\n              CollectionVersionAPI.list({\n                namespace: importDeets.namespace,\n                name: importDeets.name,\n                version: importDeets.version,\n              })\n                .then(result => {\n                  if (result.data.meta.count === 1) {\n                    this.setState({\n                      selectedCollectionVersion: result.data.data[0],\n                    });\n                  }\n                })\n                .finally(() => {\n                  if (callback) {\n                    callback();\n                  }\n                });\n            },\n          );\n        })\n        .catch(result => {\n          this.setState({\n            selectedImportDetails: undefined,\n            importDetailError: 'Error fetching import from API',\n            loadingImportDetails: false,\n          });\n        });\n    }\n  }\n}\n\nexport default withRouter(MyImports);\ntry {\n    // @ts-ignore\n    myimports.displayName = \"myimports\";\n    // @ts-ignore\n    myimports.__docgenInfo = { \"description\": \"\", \"displayName\": \"myimports\", \"props\": { \"wrappedComponentRef\": { \"defaultValue\": null, \"description\": \"\", \"name\": \"wrappedComponentRef\", \"required\": false, \"type\": { \"name\": \"Ref<MyImports>\" } } } };\n    // @ts-ignore\n    if (typeof STORYBOOK_REACT_CLASSES !== \"undefined\")\n        // @ts-ignore\n        STORYBOOK_REACT_CLASSES[\"src/containers/my-imports/my-imports.tsx#myimports\"] = { docgenInfo: myimports.__docgenInfo, name: \"myimports\", path: \"src/containers/my-imports/my-imports.tsx#myimports\" };\n}\ncatch (__react_docgen_typescript_loader_error) { }"],"sourceRoot":""}