"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[571],{53688:(e,t,n)=>{n.d(t,{uM:()=>a,ZP:()=>r});const a=(0,n(77245).IU)({name:"InfoCircleIcon",height:512,width:512,svgPath:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z",yOffset:0,xOffset:0}),r=a},15868:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var a=n(42982),r=n(15861),o=n(4942),i=n(15671),l=n(43144),c=n(60136),s=n(6215),u=n(61120),d=n(87757),p=n.n(d),m=n(48222),f=n(25221),h=n(30624),g=n(86235),E=n(53703),v=n(34895),y=n(68778),_=n(43047),k=n(53688),b=n(34903),C=n(79698),R=n(61647),I=n(42807),S=n(61542);var w=function(e){(0,c.Z)(S,e);var t,n,d=(t=S,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,u.Z)(t);if(n){var r=(0,u.Z)(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return(0,s.Z)(this,e)});function S(e){var t;(0,i.Z)(this,S),t=d.call(this,e);var n=C.q6.parseParamString(e.location.search,["page","page_size"]);return n.page_size||(n.page_size=10),n.sort||(n.sort="-pulp_created"),n.repository||(n.repository="staging"),t.state={versions:void 0,itemCount:0,params:n,loading:!0,updatingVersions:[],alerts:[],unauthorized:!1,inputText:""},t}return(0,l.Z)(S,[{key:"componentDidMount",value:function(){this.context.user&&!this.context.user.is_anonymous&&this.context.user.model_permissions.move_collection?this.queryCollections():this.setState({unauthorized:!0})}},{key:"render",value:function(){var e,t=this,n=this.state,a=n.versions,r=n.params,i=n.itemCount,l=n.loading,c=n.unauthorized;return a||c?h.createElement(h.Fragment,null,h.createElement(E.UP,{title:f.ag._("Approval dashboard")}),h.createElement(E.UW,{alerts:this.state.alerts,closeAlert:function(e){return t.closeAlert(e)}}),c?h.createElement(E.iA,null):h.createElement(E.or,{className:"hub-certification-dashboard"},h.createElement("section",{className:"body","data-cy":"body"},h.createElement("div",{className:"toolbar hub-certification-dashboard-toolbar"},h.createElement(v.Toolbar,null,h.createElement(v.ToolbarGroup,null,h.createElement(v.ToolbarItem,null,h.createElement(E.Kv,{inputText:this.state.inputText,onChange:function(e){t.setState({inputText:e})},updateParams:function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},params:r,filterConfig:[{id:"namespace",title:f.ag._("Namespace")},{id:"name",title:f.ag._("Collection Name")},{id:"repository",title:f.ag._("Status"),inputType:"select",options:[{id:I.g.NOTCERTIFIED,title:f.ag._("Rejected")},{id:I.g.NEEDSREVIEW,title:f.ag._("Needs Review")},{id:I.g.PUBLISHED,title:f.ag._("Approved")}]}]})))),h.createElement(E.tl,{params:r,updateParams:function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},count:i,isTop:!0})),h.createElement("div",null,h.createElement(E.M$,{updateParams:function(e){t.updateParams(e,(function(){return t.queryCollections()})),t.setState({inputText:""})},params:r,ignoredParams:["page_size","page","sort"],niceValues:{repository:(e={},(0,o.Z)(e,I.g.PUBLISHED,f.ag._("Approved")),(0,o.Z)(e,I.g.NEEDSREVIEW,f.ag._("Needs Review")),(0,o.Z)(e,I.g.NOTCERTIFIED,f.ag._("Rejected")),e)},niceNames:{repository:f.ag._("Status")}})),l?h.createElement(E.AW,null):this.renderTable(a,r),h.createElement("div",{className:"footer"},h.createElement(E.tl,{params:r,updateParams:function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},count:i}))))):h.createElement(E.gO,null)}},{key:"renderTable",value:function(e,t){var n=this;if(0===e.length)return(0,C.vS)(t,["namespace","name","repository"])?h.createElement(E.ei,null):h.createElement(E.vv,{title:f.ag._("No managed collections yet"),description:f.ag._("Collections will appear once uploaded")});var a={headers:[{title:f.ag._("Namespace"),type:"alpha",id:"namespace"},{title:f.ag._("Collection"),type:"alpha",id:"collection"},{title:f.ag._("Version"),type:"number",id:"version"},{title:f.ag._("Date created"),type:"number",id:"pulp_created"},{title:f.ag._("Status"),type:"none",id:"status"},{title:"",type:"none",id:"certify"}]};return h.createElement("table",{"aria-label":f.ag._("Collection versions"),className:"hub-c-table-content pf-c-table"},h.createElement(E.h2,{options:a,params:t,updateParams:function(e){return n.updateParams(e,(function(){return n.queryCollections()}))}}),h.createElement("tbody",null,e.map((function(e,t){return n.renderRow(e,t)}))))}},{key:"renderStatus",value:function(e){return this.state.updatingVersions.includes(e)?h.createElement("span",{className:"fa fa-lg fa-spin fa-spinner"}):e.repository_list.includes(I.g.PUBLISHED)?h.createElement("span",null,h.createElement(y.rE,{style:{color:"var(--pf-global--success-color--100)"}})," ",f.ag._("Approved")):e.repository_list.includes(I.g.NOTCERTIFIED)?h.createElement("span",null,h.createElement(_.$O,{style:{color:"var(--pf-global--danger-color--100)"}})," ",f.ag._("Rejected")):e.repository_list.includes(I.g.NEEDSREVIEW)?h.createElement("span",null,h.createElement(k.uM,{style:{color:"var(--pf-global--info-color--100)"}})," ",f.ag._("Needs Review")):void 0}},{key:"renderRow",value:function(e,t){return h.createElement("tr",{"aria-labelledby":"".concat(e.namespace,".").concat(e.name," v").concat(e.version),key:t,"data-cy":"table_row"},h.createElement("td",null,e.namespace),h.createElement("td",null,e.name),h.createElement("td",null,h.createElement(g.Link,{to:(0,R.dI)(R.nB.collectionByRepo,{namespace:e.namespace,collection:e.name,repo:e.repository_list[0]},{version:e.version})},e.version)),h.createElement("td",null,h.createElement(E.Id,{date:e.created_at})),h.createElement("td",null,this.renderStatus(e)),h.createElement("td",{style:{paddingRight:"0px",textAlign:"right"}},this.renderButtons(e)))}},{key:"renderButtons",value:function(e){var t=this;if(!this.state.updatingVersions.includes(e)){var n=h.createElement(v.DropdownItem,{key:"imports",component:h.createElement(g.Link,{to:(0,R.dI)(R.nB.myImports,{},{namespace:e.namespace,name:e.name,version:e.version})},f.ag._("View Import Logs"))}),a=function(n,a){return h.createElement(v.DropdownItem,{onClick:function(){return t.updateCertification(e,a,I.g.PUBLISHED)},isDisabled:n,key:"certify"},f.ag._("Approve"))},r=function(n,a){return h.createElement(v.DropdownItem,{onClick:function(){return t.updateCertification(e,a,I.g.NOTCERTIFIED)},isDisabled:n,className:"rejected-icon",key:"reject"},f.ag._("Reject"))};return e.repository_list.includes(I.g.PUBLISHED)?h.createElement("span",null,h.createElement(E.hu,{items:[a(!0,I.g.PUBLISHED),r(!1,I.g.PUBLISHED),n]})):e.repository_list.includes(I.g.NOTCERTIFIED)?h.createElement("span",null,h.createElement(E.hu,{items:[a(!1,I.g.NOTCERTIFIED),r(!0,I.g.NOTCERTIFIED),n]})):e.repository_list.includes(I.g.NEEDSREVIEW)?h.createElement("span",null,h.createElement(v.Button,{onClick:function(){return t.updateCertification(e,I.g.NEEDSREVIEW,I.g.PUBLISHED)}},h.createElement("span",null,f.ag._("Approve"))),h.createElement(E.hu,{items:[r(!1,I.g.NEEDSREVIEW),n]})):void 0}}},{key:"updateCertification",value:function(e,t,n){var a=this,r=this.state.alerts;this.setState({updatingVersions:[]},(function(){return b.eq.setRepository(e.namespace,e.name,e.version,t,n).then((function(t){a.setState({updatingVersions:[e]}),a.waitForUpdate(t.data.remove_task_id,e)}),a.addAlert(h.createElement(m.cC,{id:'Certification status for collection "{0} v{1}" has been successfully updated.',values:{0:e.name,1:e.version}}),"success")).catch((function(t){a.setState({updatingVersions:[],alerts:r.concat({variant:"danger",title:f.ag._("API Error: {0}",{0:t.response.status}),description:f.ag._("Could not update the certification status for {0}.{1}.{2}.",{0:e.namespace,1:e.name,2:e.version})})})}))}))}},{key:"waitForUpdate",value:function(e,t){var n=this,a=e;return b.Kc.get(a).then(function(){var e=(0,r.Z)(p().mark((function e(o){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("waiting"!==o.data.state&&"running"!==o.data.state){e.next=6;break}return e.next=3,new Promise((function(e){return setTimeout(e,500)}));case 3:n.waitForUpdate(a,t),e.next=11;break;case 6:if("completed"!==o.data.state){e.next=10;break}return e.abrupt("return",b.eq.list(n.state.params).then(function(){var e=(0,r.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({versions:t.data.data,updatingVersions:[]});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:n.setState({updatingVersions:[],alerts:n.state.alerts.concat({variant:"danger",title:f.ag._("API Error: 500"),description:f.ag._("Could not update the certification status for {0}.{1}.{2}.",{0:t.namespace,1:t.name,2:t.version})})});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){return b.eq.list(e.state.params).then((function(t){e.setState({versions:t.data.data,itemCount:t.data.meta.count,loading:!1,updatingVersions:[]})}))}))}},{key:"updateParams",get:function(){return C.q6.updateParamsMixin()}},{key:"closeAlert",get:function(){return(0,E.NQ)("alerts")}},{key:"addAlert",value:function(e,t,n){this.setState({alerts:[].concat((0,a.Z)(this.state.alerts),[{description:n,title:e,variant:t}])})}}]),S}(h.Component);const P=(0,g.withRouter)(w);w.contextType=S.I},79784:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var a=n(42982),r=n(15671),o=n(43144),i=n(60136),l=n(6215),c=n(61120),s=n(48222),u=n(25221),d=n(30624),p=n(86235),m=n(34895),f=n(61647),h=n(53703),g=n(79698),E=n(61542),v=n(34903);var y=function(e){(0,i.Z)(y,e);var t,n,E=(t=y,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,c.Z)(t);if(n){var r=(0,c.Z)(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return(0,l.Z)(this,e)});function y(e){var t;return(0,r.Z)(this,y),(t=E.call(this,e)).state={tokenData:void 0,alerts:[],repoUrl:""},t}return(0,o.Z)(y,[{key:"getMyDistributionPath",value:function(){var e=this;v.g9.list().then((function(t){var n,a=(null===(n=t.data.data.find((function(e){return e.base_path.includes("synclist")})))||void 0===n?void 0:n.base_path)||"";e.setState({repoUrl:a})})).catch((function(t){return e.setState({repoUrl:"",alerts:[].concat((0,a.Z)(e.state.alerts),[{variant:"danger",title:u.ag._("Error loading Server URL."),description:null==t?void 0:t.message}])})}))}},{key:"componentDidMount",value:function(){var e=this;window.insights.chrome.auth.getOfflineToken().then((function(t){e.setState({tokenData:t.data})})).catch((function(t){return e.setState({tokenData:void 0,alerts:[].concat((0,a.Z)(e.state.alerts),[{variant:"danger",title:u.ag._("Error loading token."),description:null==t?void 0:t.message}])})})),this.getMyDistributionPath()}},{key:"render",value:function(){var e,t=this,n=this.context.user,a=this.state,r=a.tokenData,o=a.alerts,i='curl https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token -d grant_type=refresh_token -d client_id="'.concat(n.username,'" -d refresh_token="').concat(null!==(e=null==r?void 0:r.refresh_token)&&void 0!==e?e:"{{ user_token }}",'" --fail --silent --show-error --output /dev/null');return d.createElement(d.Fragment,null,d.createElement(h.UW,{alerts:o,closeAlert:function(e){return t.closeAlert(e)}}),d.createElement(h.UP,{title:u.ag._("Connect to Hub")}),d.createElement(h.or,null,d.createElement("section",{className:"body pf-c-content"},d.createElement("h2",null,u.ag._("Connect Private Automation Hub")),d.createElement("p",null,d.createElement(s.cC,{id:"Use the <0>Repository Management</0> page to sync collections curated by your organization to the Red Hat Certified repository in your private Automation Hub. Users with the correct permissions can use the sync toggles on the <1>Collections</1> page to control which collections are added to their organization's sync repository.",components:{0:d.createElement(p.Link,{to:f.nB.repositories}),1:d.createElement(p.Link,{to:f.nB.search})}}))),d.createElement("section",{className:"body pf-c-content"},d.createElement("h2",null,u.ag._("Connect the ansible-galaxy client")),d.createElement("p",null,d.createElement(s.cC,{id:"Documentation on how to configure the <0>ansible-galaxy</0> client can be found <1>here</1>. Use the following parameters to configure the client.",components:{0:d.createElement("code",null),1:d.createElement("a",{href:"https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/",target:"_blank",rel:"noreferrer"})}}))),d.createElement("section",{className:"body pf-c-content"},d.createElement("h2",null,u.ag._("Offline token")),d.createElement("p",null,d.createElement(s.cC,{id:"Use this token to authenticate clients that need to download content from Automation Hub. This is a secret token used to protect your content. Store your API token in a secure location."})),r?d.createElement("div",null,d.createElement(h.M5,null,r.refresh_token)):d.createElement("div",null,d.createElement(m.Button,{onClick:function(){return t.loadToken()}},u.ag._("Load token"))),d.createElement("div",{className:"pf-c-content",style:{paddingTop:"var(--pf-global--spacer--md)"}},d.createElement("span",null,d.createElement(s.cC,{id:"The token will expire after 30 days of inactivity. Run the command below periodically to prevent your token from expiring."})),d.createElement(h.M5,{isCode:!0,isReadOnly:!0,variant:m.ClipboardCopyVariant.expansion},i)),d.createElement("h2",null,u.ag._("Manage tokens")),d.createElement(s.cC,{id:"To revoke a token or see all of your tokens, visit the <0>offline API token management</0> page.",components:{0:d.createElement("a",{href:"https://sso.redhat.com/auth/realms/redhat-external/account/applications",target:"_blank",rel:"noreferrer"})}})),d.createElement("section",{className:"body pf-c-content"},d.createElement("h2",null,u.ag._("Server URL")),d.createElement("p",null,d.createElement(s.cC,{id:"Use this URL to configure the API endpoints that clients need to download content from Automation Hub."})),d.createElement(h.M5,{isReadOnly:!0},(0,g.qX)(this.state.repoUrl))),d.createElement("section",{className:"body pf-c-content"},d.createElement("h2",null,u.ag._("SSO URL")),d.createElement("p",null,d.createElement(s.cC,{id:"Use this URL to configure the authentication URLs that clients need to download content from Automation Hub."})),d.createElement(h.M5,{isReadOnly:!0},"https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token"))))}},{key:"loadToken",value:function(){window.insights.chrome.auth.doOffline()}},{key:"closeAlert",get:function(){return(0,h.NQ)("alerts")}}]),y}(d.Component);const _=(0,p.withRouter)(y);y.contextType=E.I}}]);
//# sourceMappingURL=../sourcemaps/settings.fe8491aa3b4894d9d8424cc3dc9ac135.js.map