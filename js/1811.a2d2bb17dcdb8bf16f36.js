"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[1811],{61811:(e,t,n)=>{n.d(t,{Bu:()=>m,bU:()=>v,PU:()=>y,MC:()=>b,Rq:()=>_,JJ:()=>g,Ub:()=>B,No:()=>U,sO:()=>O,DO:()=>E,e5:()=>M,cv:()=>N,hE:()=>L,W:()=>V});var r,o=n(35356),a=n(92950),i=n.n(a),l=n(14057),c=function(e){var t=e.buttonVariant,n=e.condition,r=void 0===n?function(){return!0}:n,a=e.disabled,c=void 0===a?function(){return null}:a,s=e.modal,u=void 0===s?null:s,d=e.onClick,m=e.title,p=e.visible,f=void 0===p?function(){return!0}:p;return{title:m,button:function(e,n){return r(n,e)&&f(e,n)?c(e,n)?i().createElement(l.u,{content:c(e,n),key:m},i().createElement(o.Button,{variant:t,isDisabled:!0},m)):i().createElement(o.Button,{variant:t,key:m,onClick:function(){return d(e,n)}},m):null},dropdownItem:function(e,t){return r(t,e)&&f(e,t)?c(e,t)?i().createElement(o.DropdownItem,{key:m,description:c(e,t),isDisabled:!0},m):i().createElement(o.DropdownItem,{key:m,onClick:function(){return d(e,t)}},m):null},modal:u,visible:f,disabled:c}},s=n(13855),u=n(61647),d=n(6640),m=c({condition:d.rH,title:s.ag._("Add remote"),onClick:function(e,t){return(0,t.navigate)((0,u.dI)(u.nB.ansibleRemoteEdit,{name:"_"}))}}),p=n(45586),f=n(92518),v=c({condition:d.nm,title:s.ag._("Delete"),modal:function(e){var t=e.addAlert,n=e.query,r=e.setState,o=e.state;return o.deleteModalOpen?i().createElement(l.X3,{closeAction:function(){return r({deleteModalOpen:null})},deleteAction:function(){return function(e,t){var n=e.name,r=e.pulpId,o=t.addAlert,a=t.setState,i=t.query;return p.GC.delete(r).then((function(e){var t=e.data;o((0,f.zT)(t.task,s.ag._("Removal started for remote {name}",{name:n}))),a({deleteModalOpen:null}),i()})).catch((0,f.rJ)(s.ag._("Failed to remove remote {name}",{name:n}),(function(){return null}),o))}(o.deleteModalOpen,{addAlert:t,setState:r,query:n})},name:o.deleteModalOpen.name}):null},onClick:function(e,t){var n=e.name,r=e.id,o=e.pulp_href;return(0,t.setState)({deleteModalOpen:{pulpId:r||(0,f.LL)(o),name:n}})}}),y=c({title:s.ag._("Download CA certificate"),onClick:function(e){var t=e.ca_cert;return(0,f.Qz)(t,"ca_cert")},visible:function(e){return!!e.ca_cert}}),b=c({title:s.ag._("Download client certificate"),onClick:function(e){var t=e.client_cert;return(0,f.Qz)(t,"client_cert")},visible:function(e){return!!e.client_cert}}),_=c({title:s.ag._("Download requirements YAML"),onClick:function(e){var t=e.requirements_file;return(0,f.Qz)(t,"requirements.yml")},visible:function(e){return!!e.requirements_file}}),g=c({condition:d.DQ,title:s.ag._("Edit"),onClick:function(e,t){var n=e.name;return(0,t.navigate)((0,u.dI)(u.nB.ansibleRemoteEdit,{name:n}))}}),h=n(15861),C=n(64687),k=n.n(C),O=c({title:s.ag._("Copy CLI configuration"),onClick:(r=(0,h.Z)(k().mark((function e(t,n){var r,o,a,l,c,u,d;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.addAlert,o=null,t.distributions){e.next=18;break}return r({id:"copy-cli-config",title:s.ag._("Loading distribution..."),variant:"info"}),e.next=6,p.Lj.list({repository:t.pulp_href});case 6:if(e.t1=a=e.sent,e.t0=null===e.t1,e.t0){e.next=10;break}e.t0=void 0===a;case 10:if(!e.t0){e.next=14;break}e.t2=void 0,e.next=15;break;case 14:e.t2=null===(l=a.data)||void 0===l||null===(c=l.results)||void 0===c?void 0:c[0];case 15:o=e.t2,e.next=19;break;case 18:o=null===(u=t.distributions)||void 0===u?void 0:u[0];case 19:if(o){e.next=22;break}return r({id:"copy-cli-config",title:s.ag._("There are no distributions associated with this repository."),variant:"danger"}),e.abrupt("return");case 22:d=["[galaxy]","server_list = ".concat(o.base_path),"","[galaxy_server.".concat(o.base_path,"]"),"url=".concat((0,f.hv)(o.base_path)),"token=<put your token here>"].join("\n"),navigator.clipboard.writeText(d),r({description:i().createElement("pre",null,d),id:"copy-cli-config",title:s.ag._("Successfully copied to clipboard"),variant:"success"});case 25:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)}),disabled:function(e){var t=e.distributions;return t&&!t.length?s.ag._("There are no distributions associated with this repository."):null}}),E=c({condition:d.zN,title:s.ag._("Add repository"),onClick:function(e,t){return(0,t.navigate)((0,u.dI)(u.nB.ansibleRepositoryEdit,{name:"_"}))}}),A=n(42982),S=n(42807),M=c({condition:d.Xn,title:s.ag._("Delete"),modal:function(e){var t=e.addAlert,n=e.query,r=e.setState,o=e.state;return o.deleteModalOpen?i().createElement(l.Iq,{closeAction:function(){return r({deleteModalOpen:null})},deleteAction:function(){return function(e,t){return w.apply(this,arguments)}(o.deleteModalOpen,{addAlert:t,setState:r,query:n})},name:o.deleteModalOpen.name}):null},onClick:function(e,t){var n=e.name,r=e.id,o=e.pulp_href;return(0,t.setState)({deleteModalOpen:{pulpId:r||(0,f.LL)(o),name:n,pulp_href:o}})},disabled:function(e){var t=e.name;return S.g.PROTECTED_REPOSITORIES.includes(t)?s.ag._("Protected repositories cannot be deleted."):null}});function w(){return(w=(0,h.Z)(k().mark((function e(t,n){var r,o,a,i,l,c,u,d,m;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,o=t.pulp_href,a=t.pulpId,i=n.addAlert,l=n.setState,c=n.query,e.next=4,p.Lj.list({repository:o}).then((function(e){return e.data.results||[]})).catch((function(e){return(0,f.rJ)(s.ag._("Failed to list distributions, removing only the repository."),(function(){return null}),i)(e),[]}));case 4:return u=e.sent,d=p.UX.delete(a).then((function(e){var t=e.data;i((0,f.zT)(t.task,s.ag._("Removal started for repository {name}",{name:r})))})).catch((0,f.rJ)(s.ag._("Failed to remove repository {name}",{name:r}),(function(){return l({deleteModalOpen:null})}),i)),m=function(e){var t=e.name,n=e.pulp_href,r=(0,f.LL)(n);return p.Lj.delete(r).then((function(e){var n=e.data;return i((0,f.zT)(n.task,s.ag._("Removal started for distribution {name}",{name:t})))})).catch((0,f.rJ)(s.ag._("Failed to remove distribution {name}",{name:t}),(function(){return null}),i))},e.abrupt("return",Promise.all([d].concat((0,A.Z)(u.map(m)))).then((function(){l({deleteModalOpen:null}),c()})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=c({condition:d.lo,title:s.ag._("Edit"),onClick:function(e,t){var n=e.name;return(0,t.navigate)((0,u.dI)(u.nB.ansibleRepositoryEdit,{name:n}))}}),D=n(4942),q=n(70885);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,D.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=function(e){var t=e.closeAction,n=e.syncAction,r=e.name,c=(0,a.useState)(!1),u=(0,q.Z)(c,2),d=u[0],m=u[1],p=(0,a.useState)({mirror:!0,optimize:!0}),f=(0,q.Z)(p,2),v=f[0],y=f[1];return(0,a.useEffect)((function(){m(!1),y({mirror:!0,optimize:!0})}),[r]),r?i().createElement(o.Modal,{actions:[i().createElement("div",{"data-cy":"sync-button",key:"sync"},i().createElement(o.Button,{key:"sync",onClick:function(){m(!0),n(v).then(t).finally((function(){return m(!1)}))},variant:"primary",isDisabled:d},s.ag._("Sync"),d&&i().createElement(o.Spinner,{size:"sm"}))),i().createElement(o.Button,{key:"close",onClick:t,variant:"link"},s.ag._("Close"))],isOpen:!0,onClose:t,title:s.ag._('Sync repository "{name}"',{name:r}),variant:"medium"},i().createElement(o.FormGroup,{label:s.ag._("Mirror"),labelIcon:i().createElement(l.p6,{content:s.ag._("If selected, all content that is not present in the remote repository will be removed from the local repository; otherwise, sync will add missing content.")})},i().createElement(o.Switch,{isChecked:v.mirror,onChange:function(e){return y(P(P({},v),{},{mirror:e}))},label:s.ag._("Content not present in remote repository will be removed from the local repository"),labelOff:s.ag._("Sync will only add missing content")})),i().createElement("br",null),i().createElement(o.FormGroup,{label:s.ag._("Optimize"),labelIcon:i().createElement(l.p6,{content:s.ag._("Only perform the sync if no changes are reported by the remote server. To force a sync to happen, deselect this option.")})},i().createElement(o.Switch,{isChecked:v.optimize,onChange:function(e){return y(P(P({},v),{},{optimize:e}))},label:s.ag._("Only perform the sync if no changes are reported by the remote server."),labelOff:s.ag._("Force a sync to happen.")})),i().createElement("br",null)):null},L=c({condition:d.vn,title:s.ag._("Sync"),modal:function(e){var t=e.addAlert,n=e.query,r=e.setState,o=e.state;return o.syncModalOpen?i().createElement(R,{closeAction:function(){return r({syncModalOpen:null})},syncAction:function(e){return function(e,t,n){var r=e.name,o=e.pulp_href,a=t.addAlert,i=t.query,l=(0,f.LL)(o);return p.UX.sync(l,n||{mirror:!0}).then((function(e){var t=e.data;a((0,f.zT)(t.task,s.ag._('Sync started for repository "{name}".',{name:r}))),i()})).catch((0,f.rJ)(s.ag._('Failed to sync repository "{name}"',{name:r}),(function(){return null}),a))}(o.syncModalOpen,{addAlert:t,query:n},e)},name:o.syncModalOpen.name}):null},onClick:function(e,t){var n=e.name,r=e.pulp_href;return(0,t.setState)({syncModalOpen:{name:n,pulp_href:r}})},visible:function(e,t){return(0,t.hasPermission)("ansible.change_collectionremote")},disabled:function(e){var t=e.remote,n=e.last_sync_task;return t?n&&["running","waiting"].includes(n.state)?s.ag._("Sync task is already queued."):null:s.ag._("There are no remotes associated with this repository.")}}),T=n(14744),z=function(e){var t=e.version,n=e.cancelAction,r=e.revertAction,l=(0,a.useState)(!1),c=(0,q.Z)(l,2),u=c[0],d=c[1];return i().createElement(o.Modal,{actions:[i().createElement("div",{"data-cy":"delete-button",key:"delete"},i().createElement(o.Button,{key:"delete",onClick:function(){d(!0),r()},variant:"danger",isDisabled:u},s.ag._("Revert"),u&&i().createElement(o.Spinner,{size:"sm"}))),i().createElement(o.Button,{key:"cancel",onClick:n,variant:"link"},s.ag._("Cancel"))],isOpen:!0,onClose:n,title:s.ag._("Revert repository"),titleIconVariant:"warning",variant:"small","data-cy":"modal_checkbox"},i().createElement(T.cC,{id:"Are you sure you want to revert this repository to the version below?"}),i().createElement("br",null),i().createElement("b",null,t))},V=c({condition:d.Wt,title:s.ag._("Revert to this version"),modal:function(e){var t=e.addAlert,n=e.state,r=e.setState,o=e.query;return n.revertModal?i().createElement(z,{cancelAction:function(){return r({revertModal:null})},revertAction:function(){return function(e,t){var n=e.repositoryName,r=e.pulp_href,o=e.number,a=t.addAlert,i=t.setState,l=t.query,c=(0,f.LL)(r);return p.UX.revert(c,r).then((function(e){var t=e.data;a((0,f.zT)(t.task,s.ag._('Revert started for repository "{repositoryName}".',{repositoryName:n}))),i({revertModal:null}),l()})).catch((0,f.rJ)(s.ag._('Failed to revert repository "{repositoryName}" to version "{number}"',{repositoryName:n,number:o}),(function(){return i({revertModal:null})}),a))}(n.revertModal,{addAlert:t,setState:r,query:o})},version:n.revertModal.number}):null},onClick:function(e,t){var n=e.repositoryName,r=e.number,o=e.pulp_href;return(0,t.setState)({revertModal:{repositoryName:n,number:r,pulp_href:o}})},disabled:function(e){return e.isLatest?s.ag._("Already the current version"):null}});function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){(0,D.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=function(e){var t=e.addAction,n=e.closeAction,r=e.sourceRepository,c=(0,a.useState)([]),u=(0,q.Z)(c,2),d=u[0],m=u[1],v=(0,a.useState)([]),y=(0,q.Z)(v,2),b=y[0],_=y[1],g=function(e){var t=x({},e.params);return t.ordering=t.sort,delete t.sort,p.eq.list(x({},t)).then((function(e){var t=e.data;return{data:{count:t.meta.count,results:t.data}}}))},h=(0,a.useState)({}),C=(0,q.Z)(h,2),k=C[0],O=C[1];return i().createElement(o.Modal,{actions:[i().createElement(o.Button,{key:"confirm",onClick:function(){return t(b)},variant:"primary",isDisabled:!b},s.ag._("Select")),i().createElement(o.Button,{key:"cancel",onClick:n,variant:"link"},s.ag._("Cancel"))],isOpen:!0,onClose:n,title:s.ag._("Select a collection"),variant:"large"},i().createElement("section",{className:"modal-body","data-cy":"modal-body"},i().createElement(l.qU,{actionContext:{addAlert:function(e){m([].concat((0,A.Z)(d),[e]))},state:k,setState:O,query:g,hasPermission:function(){throw"unused"}},defaultPageSize:10,defaultSort:"name",errorTitle:s.ag._("Collection versions could not be displayed."),filterConfig:[{id:"keywords",title:s.ag._("Keywords")},{id:"namespace",title:s.ag._("Namespace")},{id:"repository_name",title:s.ag._("Repository")}],noDataDescription:s.ag._("Collection versions will appear once a collection is uploaded."),noDataTitle:s.ag._("No collection versions yet"),query:g,renderTableRow:function(e,t){var n=e.collection_version,a=n.name,l=n.namespace,c=n.version,s=n.description,u=e.repository,d=r.pulp_href===u.pulp_href;return i().createElement("tr",{onClick:function(){return _(f.KU.pushToOrFilterOutCollections(e,b))},key:t},i().createElement("td",null,i().createElement(o.Checkbox,{"aria-label":"".concat(l,".").concat(a," v").concat(c),id:"collection-".concat(t),isChecked:d||b.includes(e),name:"collection-".concat(t),isDisabled:d})),i().createElement("td",null,l,".",a," v",c),i().createElement("td",null,s),i().createElement("td",null,u.name))},sortHeaders:[{title:"",type:"none",id:"radio"},{title:s.ag._("Collection"),type:"none",id:"col1"},{title:s.ag._("Description"),type:"none",id:"col2"},{title:s.ag._("Repository"),type:"none",id:"col3"}],title:s.ag._("Collection versions")})),i().createElement(l.UW,{alerts:d,closeAlert:function(e){return(0,l.M6)(e,{alerts:d,setAlerts:m})}}))},B=c({condition:d.lo,title:s.ag._("Add collection"),modal:function(e){var t=e.addAlert,n=e.state,r=e.setState,o=e.query;return n.addCollectionVersionModal?i().createElement(F,{addAction:function(e){!function(e,t,n){var r=e.repositoryHref,o=e.repositoryName,a=n.addAlert,i=n.setState,l=n.query,c=(0,f.LL)(r),u=t.map((function(e){return e.collection_version.pulp_href}));p.UX.addContent(c,u).then((function(e){var n=e.data;t.map((function(e){var t=e.collection_version,r=t.name,c=t.namespace,u=t.version,d=e.repository;a((0,f.zT)(n.task,s.ag._('Started adding {namespace}.{name} v{version} from "{0}" to repository "{repositoryName}".',{0:d.name,namespace:c,name:r,version:u,repositoryName:o}))),i((function(e){return x(x({},e),{},{addCollectionVersionModal:null})})),l({})}))})).catch((0,f.rJ)(s.ag._('{0, plural, one {Failed to add collection to repository "{repositoryName}".} other {Failed to add collections to repository "{repositoryName}".}}',{0:t.length,repositoryName:o}),(function(){return i((function(e){return x(x({},e),{},{addCollectionVersionModal:null})}))}),a))}(n.addCollectionVersionModal,e,{addAlert:t,setState:r,query:o})},closeAction:function(){return r((function(e){return x(x({},e),{},{addCollectionVersionModal:null})}))},sourceRepository:n.repository}):null},onClick:function(e,t){var n=t.state.repository,r=n.name,o=n.pulp_href;return(0,t.setState)((function(e){return x(x({},e),{},{addCollectionVersionModal:{repositoryHref:o,repositoryName:r}})}))}}),Z=function(e){var t=e.name,n=e.namespace,r=e.repositoryName,c=e.version,u=e.closeAction,d=e.deleteAction,m=(0,a.useState)(!1),p=(0,q.Z)(m,2),f=p[0],v=p[1];return t?i().createElement(l.pf,{spinner:f,cancelAction:function(){v(!1),u()},deleteAction:function(){v(!1),d()},isDisabled:f,isRemove:!0,title:s.ag._("Remove collection version?")},i().createElement(o.Text,null,i().createElement(T.cC,{id:"Are you sure you want to remove the collection version <0>{namespace}.{name} v{version}</0> from the <1>{repositoryName}</1> repository?",values:{namespace:n,name:t,version:c,repositoryName:r},components:{0:i().createElement("b",null),1:i().createElement("b",null)}}))):null},U=c({condition:d.lo,title:s.ag._("Remove"),modal:function(e){var t=e.addAlert,n=e.state,r=e.setState,o=e.query;return n.removeCollectionVersionModal?i().createElement(Z,{closeAction:function(){return r({removeCollectionVersionModal:null})},deleteAction:function(){return function(e,t){var n=e.collection,r=n.namespace,o=n.name,a=n.version,i=e.collectionVersionHref,l=e.repositoryHref,c=e.repositoryName,u=t.addAlert,d=t.setState,m=t.query,v=(0,f.LL)(l);return p.UX.removeContent(v,i).then((function(e){var t=e.data;u((0,f.zT)(t.task,s.ag._('Removal of {namespace}.{name} v{version} from repository "{repositoryName}" started.',{namespace:r,name:o,version:a,repositoryName:c}))),d({removeCollectionVersionModal:null}),m()})).catch((0,f.rJ)(s.ag._('Failed to remove {namespace}.{name} v{version} from repository "{repositoryName}".',{namespace:r,name:o,version:a,repositoryName:c}),(function(){return d({removeCollectionVersionModal:null})}),u))}(n.removeCollectionVersionModal,{addAlert:t,setState:r,query:o})},name:n.removeCollectionVersionModal.collection.name,namespace:n.removeCollectionVersionModal.collection.namespace,repositoryName:n.removeCollectionVersionModal.repositoryName,version:n.removeCollectionVersionModal.collection.version}):null},onClick:function(e,t){var n=e.collection_version,r=n.namespace,o=n.name,a=n.version,i=n.pulp_href,l=e.repository,c=l.name,s=l.pulp_href;return(0,t.setState)({removeCollectionVersionModal:{collection:{namespace:r,name:o,version:a},repositoryName:c,repositoryHref:s,collectionVersionHref:i}})}})},6640:(e,t,n)=>{n.d(t,{DQ:()=>l,MT:()=>c,Wt:()=>y,X0:()=>v,Xn:()=>d,fY:()=>f,lo:()=>m,nm:()=>i,rH:()=>a,vn:()=>p,yA:()=>s,zN:()=>u});var r=function(e){return function(t){var n=t.hasPermission,r=t.user;return n(e)||(null==r?void 0:r.is_superuser)}},o=function(e){return function(t,n){var r=t.hasPermission,o=t.hasObjectPermission,a=t.user;return r(e)||(null==o?void 0:o(e,n))||(null==a?void 0:a.is_superuser)}},a=r("ansible.add_collectionremote"),i=o("ansible.delete_collectionremote"),l=o("ansible.change_collectionremote"),c=o("ansible.view_collectionremote"),s=o("ansible.manage_roles_collectionremote"),u=r("ansible.add_ansiblerepository"),d=o("ansible.delete_ansiblerepository"),m=o("ansible.change_ansiblerepository"),p=m,f=function(e){var t=e.user,n=e.featureFlags;return t&&(null==n?void 0:n.display_repositories)},v=o("ansible.manage_roles_ansiblerepository"),y=m}}]);
//# sourceMappingURL=../sourcemaps/1811.4edf6bec081f6e4eecd4b7e9e7edb8e7.js.map