"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[153],{95153:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(42982),r=n(15671),l=n(43144),s=n(79340),i=n(82963),c=n(61120),o=n(48403),u=n.n(o),m=n(62747),p=n(92950),d=n(27693),g=n(62012),E=n(48706),h=n(11930),k=n(76473),f=n(95517),_=n(61647),D=n(42807),L=n(90005),T=n(29423);var v=function(e){(0,s.Z)(v,e);var t,n,o=(t=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,c.Z)(t);if(n){var r=(0,c.Z)(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return(0,i.Z)(this,e)});function v(e){var t;return(0,r.Z)(this,v),(t=o.call(this,e)).state={loading:!0,task:null,parentTask:null,childTasks:[],alerts:[],cancelModalVisible:!1,taskName:"",resources:[],redirect:null,polling:null},t}return(0,l.Z)(v,[{key:"componentDidMount",value:function(){this.loadContent()}},{key:"componentWillUnmount",value:function(){this.state.polling&&clearInterval(this.state.polling)}},{key:"componentDidUpdate",value:function(e){e.routeParams.task!==this.props.routeParams.task&&(this.setState({loading:!0}),this.loadContent())}},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,a=t.task,r=t.parentTask,l=t.childTasks,s=t.cancelModalVisible,i=t.alerts,c=t.taskName,o=t.resources,m=t.redirect,f=[{url:(0,_.dI)(_.nB.taskList),name:d.ag._("Task management")},{name:a?c:""}],T=null;return r&&(T=(0,L.L)(r.pulp_href)),m?p.createElement(g.Navigate,{to:m}):n?p.createElement(E.AW,null):p.createElement(p.Fragment,null,p.createElement(E.UW,{alerts:i,closeAlert:function(t){return e.closeAlert(t)}}),s?this.renderCancelModal():null,p.createElement(E.UP,{title:c,breadcrumbs:p.createElement(E.Oo,{links:f}),pageControls:["running","waiting"].includes(a.state)&&p.createElement(h.Button,{variant:"secondary",onClick:function(){return e.setState({cancelModalVisible:!0})}},d.ag._("Stop task")),status:p.createElement(E.Eg,{className:"hub-c-task-status",status:a.state})}),p.createElement(E.or,null,p.createElement(h.Flex,null,p.createElement(h.Flex,{direction:{default:"column"},flex:{default:"flex_1"}},p.createElement(h.FlexItem,null,p.createElement("section",{className:"body card-area"},p.createElement(h.Title,{headingLevel:"h2",size:"lg"},d.ag._("Task detail")),p.createElement("br",null),p.createElement(h.DescriptionList,{isHorizontal:!0},p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Task name")),p.createElement(h.DescriptionListDescription,null,a.name)),a.name!==c&&p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Descriptive name")),p.createElement(h.DescriptionListDescription,null,c)),p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Finished at")),p.createElement(h.DescriptionListDescription,null,p.createElement(E.Id,{date:a.finished_at}))),p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Created on")),p.createElement(h.DescriptionListDescription,null,p.createElement(E.Id,{date:a.pulp_created})))))),p.createElement(h.FlexItem,null,p.createElement("section",{className:"body card-area"},p.createElement(h.Title,{headingLevel:"h2",size:"lg"},d.ag._("Task groups")),p.createElement("br",null),p.createElement(h.DescriptionList,{isHorizontal:!0},p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Task group")),p.createElement(h.DescriptionListDescription,null,a.task_group?a.task_group:d.ag._("No task group"))),p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Parent task")),p.createElement(h.DescriptionListDescription,null,r?p.createElement(g.Link,{to:(0,_.dI)(_.nB.taskDetail,{task:T})},D.g.TASK_NAMES[r.name]&&d.ag._(D.g.TASK_NAMES[r.name])||r.name):d.ag._("No parent task"))),p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Child tasks")),p.createElement(h.DescriptionListDescription,null,l.length?l.map((function(e){var t=(0,L.L)(e.pulp_href);return p.createElement(p.Fragment,{key:t},p.createElement(g.Link,{to:(0,_.dI)(_.nB.taskDetail,{task:t})},D.g.TASK_NAMES[e.name]&&d.ag._(D.g.TASK_NAMES[e.name])||e.name),p.createElement("br",null))})):d.ag._("No child task")))))),p.createElement(h.FlexItem,null,p.createElement("section",{className:"body card-area"},p.createElement(h.Title,{headingLevel:"h2",size:"lg"},d.ag._("Reserve resources")),p.createElement("br",null),o.length?p.createElement(h.DescriptionList,{isHorizontal:!0},o.map((function(e,t){return p.createElement(p.Fragment,{key:e.type+t},p.createElement("hr",null),p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Type")),p.createElement(h.DescriptionListDescription,null,e.type)),e.pluginName&&p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Plugin")),p.createElement(h.DescriptionListDescription,null,e.pluginName)),e.name&&p.createElement(h.DescriptionListGroup,null,p.createElement(h.DescriptionListTerm,null,d.ag._("Name")),p.createElement(h.DescriptionListDescription,null,e.name)))}))):d.ag._("There's no resource record")))),p.createElement(h.Flex,{direction:{default:"column"},flex:{default:"flex_1"}},p.createElement(h.FlexItem,null,!a.error&&p.createElement("section",{className:"body card-area"},p.createElement(h.Title,{headingLevel:"h2",size:"lg"},d.ag._("Progress messages")),p.createElement("br",null),a.progress_reports.length?p.createElement(h.DescriptionList,{isHorizontal:!0},a.progress_reports.reverse().map((function(e,t){return p.createElement(p.Fragment,{key:t},p.createElement("hr",null),Object.keys(e).map((function(t,n){return!!e[t]&&p.createElement(h.DescriptionListGroup,{key:t+n},p.createElement(h.DescriptionListTerm,null,{message:d.ag._("Message"),code:d.ag._("Code"),state:d.ag._("State"),done:d.ag._("Done")}[t]||u()(t)),p.createElement(h.DescriptionListDescription,null,e[t]))}))," ")}))):p.createElement(E.WU,{icon:k.TF,title:d.ag._("There is no progress message."),description:d.ag._("There is no progress message.")})),!!a.error&&p.createElement("section",{className:"body card-area"},p.createElement(h.Title,{headingLevel:"h2",size:"lg"},d.ag._("Error message")),p.createElement("br",null),p.createElement(p.Fragment,null,p.createElement(h.Title,{headingLevel:"h3"},d.ag._("Description")),p.createElement(h.CodeBlock,null,a.error.description),p.createElement(h.Title,{headingLevel:"h3"},d.ag._("Traceback")),p.createElement(h.CodeBlock,{className:"hub-code-block"},a.error.traceback))))))))}},{key:"renderCancelModal",value:function(){var e=this,t=this.state.taskName;return p.createElement(E.sm,{cancelAction:function(){return e.setState({cancelModalVisible:!1})},confirmAction:function(){return e.cancelTask()},title:d.ag._("Stop task"),confirmButtonTitle:d.ag._("Yes, stop")},d.ag._("{name} will stop running.",{name:t}))}},{key:"cancelTask",value:function(){var e=this,t=this.state,n=t.task,r=t.taskName;f.sb.patch((0,L.L)(n.pulp_href),{state:"canceled"}).then((function(){e.setState({loading:!0,cancelModalVisible:!1,alerts:[].concat((0,a.Z)(e.state.alerts),[{variant:"success",title:r,description:p.createElement(m.cC,{id:'Task "{taskName}" stopped successfully.',values:{taskName:r}})}])}),e.loadContent()})).catch((function(t){var n=t.response,l=n.status,s=n.statusText;e.setState({loading:!0,cancelModalVisible:!1,alerts:[].concat((0,a.Z)(e.state.alerts),[{variant:"danger",title:d.ag._('Task "{taskName}" could not be stopped.',{taskName:r}),description:(0,T.N3)(l,s)}])}),e.loadContent()}))}},{key:"loadContent",value:function(){var e=this;this.state.polling||this.state.task||this.setState({polling:setInterval((function(){return e.loadContent()}),1e4)});var t=this.props.routeParams.task;return f.sb.get(t).then((function(t){var n=[],a=null,r=[],l=[];if(["canceled","completed","failed"].includes(t.data.state)&&(clearInterval(e.state.polling),e.setState({polling:null})),t.data.parent_task){var s=(0,L.L)(t.data.parent_task);n.push(f.sb.get(s).then((function(e){a=e.data})).catch((function(){return!0})))}return t.data.child_tasks.length&&t.data.child_tasks.forEach((function(e){var t=(0,L.L)(e);n.push(f.sb.get(t).then((function(e){r.push(e.data)})).catch((function(){return!0})))})),t.data.reserved_resources_record.length&&t.data.reserved_resources_record.forEach((function(e){var t=e.replace("/api/automation-hub/pulp/api/v3/",""),a=(0,L.L)(t),r=t.split("/"),s="",i="";r.length>=3?(s="".concat(r[0],": ").concat(r[2]),i=r[1]):e=r[0],a?n.push(f.O8.get(t).then((function(e){l.push({name:e.data.name,type:s,pluginName:i})})).catch((function(){return!0}))):l.push({type:s})})),Promise.all(n).then((function(){e.setState({task:t.data,childTasks:r,parentTask:a,loading:!1,taskName:D.g.TASK_NAMES[t.data.name]&&d.ag._(D.g.TASK_NAMES[t.data.name])||t.data.name,resources:l})}))})).catch((function(){e.setState({redirect:(0,_.dI)(_.nB.notFound)})}))}},{key:"closeAlert",get:function(){return(0,E.NQ)("alerts")}}]),v}(p.Component);const b=(0,T.EN)(v)}}]);
//# sourceMappingURL=../sourcemaps/153.6513cf30aef4458fc8945662070b2a94.js.map