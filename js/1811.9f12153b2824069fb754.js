"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[1811],{61811:(e,t,n)=>{n.d(t,{Bu:()=>m,bU:()=>f,PU:()=>y,MC:()=>_,Rq:()=>b,JJ:()=>g,Ub:()=>I,No:()=>B,sO:()=>E,DO:()=>A,e5:()=>S,cv:()=>N,hE:()=>q,W:()=>T});var r,o=n(35356),a=n(92950),i=n.n(a),l=n(14057),c=function(e){var t=e.buttonVariant,n=e.condition,r=void 0===n?function(){return!0}:n,a=e.disabled,c=void 0===a?function(){return null}:a,s=e.modal,u=void 0===s?null:s,d=e.onClick,m=e.title,p=e.visible,v=void 0===p?function(){return!0}:p;return{title:m,button:function(e,n){return r(n,e)&&v(e,n)?c(e,n)?i().createElement(l.u,{content:c(e,n),key:m},i().createElement(o.Button,{variant:t,isDisabled:!0},m)):i().createElement(o.Button,{variant:t,key:m,onClick:function(){return d(e,n)}},m):null},dropdownItem:function(e,t){return r(t,e)&&v(e,t)?c(e,t)?i().createElement(o.DropdownItem,{key:m,description:c(e,t),isDisabled:!0},m):i().createElement(o.DropdownItem,{key:m,onClick:function(){return d(e,t)}},m):null},modal:u,visible:v,disabled:c}},s=n(13855),u=n(61647),d=n(6640),m=c({condition:d.rH,title:s.ag._("Add remote"),onClick:function(e,t){return(0,t.navigate)((0,u.dI)(u.nB.ansibleRemoteEdit,{name:"_"}))}}),p=n(45586),v=n(92518),f=c({condition:d.nm,title:s.ag._("Delete"),modal:function(e){var t=e.addAlert,n=e.query,r=e.setState,o=e.state;return o.deleteModalOpen?i().createElement(l.X3,{closeAction:function(){return r({deleteModalOpen:null})},deleteAction:function(){return function(e,t){var n=e.name,r=e.pulpId,o=t.addAlert,a=t.setState,i=t.query;return p.GC.delete(r).then((function(e){var t=e.data;o((0,v.zT)(t.task,s.ag._("Removal started for remote {name}",{name:n}))),a({deleteModalOpen:null}),i()})).catch((0,v.rJ)(s.ag._("Failed to remove remote {name}",{name:n}),(function(){return null}),o))}(o.deleteModalOpen,{addAlert:t,setState:r,query:n})},name:o.deleteModalOpen.name}):null},onClick:function(e,t){var n=e.name,r=e.id,o=e.pulp_href;return(0,t.setState)({deleteModalOpen:{pulpId:r||(0,v.LL)(o),name:n}})}}),y=c({title:s.ag._("Download CA certificate"),onClick:function(e){var t=e.ca_cert;return(0,v.Qz)(t,"ca_cert")},visible:function(e){return!!e.ca_cert}}),_=c({title:s.ag._("Download client certificate"),onClick:function(e){var t=e.client_cert;return(0,v.Qz)(t,"client_cert")},visible:function(e){return!!e.client_cert}}),b=c({title:s.ag._("Download requirements YAML"),onClick:function(e){var t=e.requirements_file;return(0,v.Qz)(t,"requirements.yml")},visible:function(e){return!!e.requirements_file}}),g=c({condition:d.DQ,title:s.ag._("Edit"),onClick:function(e,t){var n=e.name;return(0,t.navigate)((0,u.dI)(u.nB.ansibleRemoteEdit,{name:n}))}}),h=n(15861),C=n(64687),k=n.n(C),E=c({title:s.ag._("Copy CLI configuration"),onClick:(r=(0,h.Z)(k().mark((function e(t,n){var r,o,a,l,c,u,d;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.addAlert,o=null,t.distributions){e.next=18;break}return r({id:"copy-cli-config",title:s.ag._("Loading distribution..."),variant:"info"}),e.next=6,p.Lj.list({repository:t.pulp_href});case 6:if(e.t1=a=e.sent,e.t0=null===e.t1,e.t0){e.next=10;break}e.t0=void 0===a;case 10:if(!e.t0){e.next=14;break}e.t2=void 0,e.next=15;break;case 14:e.t2=null===(l=a.data)||void 0===l||null===(c=l.results)||void 0===c?void 0:c[0];case 15:o=e.t2,e.next=19;break;case 18:o=null===(u=t.distributions)||void 0===u?void 0:u[0];case 19:if(o){e.next=22;break}return r({id:"copy-cli-config",title:s.ag._("There are no distributions associated with this repository."),variant:"danger"}),e.abrupt("return");case 22:d=["[galaxy]","server_list = ".concat(o.base_path),"","[galaxy_server.".concat(o.base_path,"]"),"url=".concat((0,v.hv)(o.base_path)),"token=<put your token here>"].join("\n"),navigator.clipboard.writeText(d),r({description:i().createElement("pre",null,d),id:"copy-cli-config",title:s.ag._("Successfully copied to clipboard"),variant:"success"});case 25:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)}),disabled:function(e){var t=e.distributions;return t&&!t.length?s.ag._("There are no distributions associated with this repository."):null}}),A=c({condition:d.zN,title:s.ag._("Add repository"),onClick:function(e,t){return(0,t.navigate)((0,u.dI)(u.nB.ansibleRepositoryEdit,{name:"_"}))}}),M=n(42982),O=n(42807),S=c({condition:d.Xn,title:s.ag._("Delete"),modal:function(e){var t=e.addAlert,n=e.query,r=e.setState,o=e.state;return o.deleteModalOpen?i().createElement(l.Iq,{closeAction:function(){return r({deleteModalOpen:null})},deleteAction:function(){return function(e,t){return w.apply(this,arguments)}(o.deleteModalOpen,{addAlert:t,setState:r,query:n})},name:o.deleteModalOpen.name}):null},onClick:function(e,t){var n=e.name,r=e.id,o=e.pulp_href;return(0,t.setState)({deleteModalOpen:{pulpId:r||(0,v.LL)(o),name:n,pulp_href:o}})},disabled:function(e){var t=e.name;return O.g.PROTECTED_REPOSITORIES.includes(t)?s.ag._("Protected repositories cannot be deleted."):null}});function w(){return(w=(0,h.Z)(k().mark((function e(t,n){var r,o,a,i,l,c,u,d,m;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,o=t.pulp_href,a=t.pulpId,i=n.addAlert,l=n.setState,c=n.query,e.next=4,p.Lj.list({repository:o}).then((function(e){return e.data.results||[]})).catch((function(e){return(0,v.rJ)(s.ag._("Failed to list distributions, removing only the repository."),(function(){return null}),i)(e),[]}));case 4:return u=e.sent,d=p.UX.delete(a).then((function(e){var t=e.data;i((0,v.zT)(t.task,s.ag._("Removal started for repository {name}",{name:r})))})).catch((0,v.rJ)(s.ag._("Failed to remove repository {name}",{name:r}),(function(){return l({deleteModalOpen:null})}),i)),m=function(e){var t=e.name,n=e.pulp_href,r=(0,v.LL)(n);return p.Lj.delete(r).then((function(e){var n=e.data;return i((0,v.zT)(n.task,s.ag._("Removal started for distribution {name}",{name:t})))})).catch((0,v.rJ)(s.ag._("Failed to remove distribution {name}",{name:t}),(function(){return null}),i))},e.abrupt("return",Promise.all([d].concat((0,M.Z)(u.map(m)))).then((function(){l({deleteModalOpen:null}),c()})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=c({condition:d.lo,title:s.ag._("Edit"),onClick:function(e,t){var n=e.name;return(0,t.navigate)((0,u.dI)(u.nB.ansibleRepositoryEdit,{name:n}))}}),q=c({condition:d.vn,title:s.ag._("Sync"),onClick:function(e,t){var n=e.name,r=e.pulp_href,o=t.addAlert,a=t.query,i=(0,v.LL)(r);p.UX.sync(i,{mirror:!0}).then((function(e){var t=e.data;o((0,v.zT)(t.task,s.ag._('Sync started for repository "{name}".',{name:n}))),a()})).catch((0,v.rJ)(s.ag._('Failed to sync repository "{name}"',{name:n}),(function(){return null}),o))},visible:function(e,t){return(0,t.hasPermission)("ansible.change_collectionremote")},disabled:function(e){var t=e.remote,n=e.last_sync_task;return t?n&&["running","waiting"].includes(n.state)?s.ag._("Sync task is already queued."):null:s.ag._("There are no remotes associated with this repository.")}}),D=n(70885),R=n(14744),L=function(e){var t=e.version,n=e.cancelAction,r=e.revertAction,l=(0,a.useState)(!1),c=(0,D.Z)(l,2),u=c[0],d=c[1];return i().createElement(o.Modal,{actions:[i().createElement("div",{"data-cy":"delete-button",key:"delete"},i().createElement(o.Button,{key:"delete",onClick:function(){d(!0),r()},variant:"danger",isDisabled:u},s.ag._("Revert"),u&&i().createElement(o.Spinner,{size:"sm"}))),i().createElement(o.Button,{key:"cancel",onClick:n,variant:"link"},s.ag._("Cancel"))],isOpen:!0,onClose:n,title:s.ag._("Revert repository"),titleIconVariant:"warning",variant:"small","data-cy":"modal_checkbox"},i().createElement(R.cC,{id:"Are you sure you want to revert this repository to the version below?"}),i().createElement("br",null),i().createElement("b",null,t))},T=c({condition:d.Wt,title:s.ag._("Revert to this version"),modal:function(e){var t=e.addAlert,n=e.state,r=e.setState,o=e.query;return n.revertModal?i().createElement(L,{cancelAction:function(){return r({revertModal:null})},revertAction:function(){return function(e,t){var n=e.repositoryName,r=e.pulp_href,o=e.number,a=t.addAlert,i=t.setState,l=t.query,c=(0,v.LL)(r);return p.UX.revert(c,r).then((function(e){var t=e.data;a((0,v.zT)(t.task,s.ag._('Revert started for repository "{repositoryName}".',{repositoryName:n}))),i({revertModal:null}),l()})).catch((0,v.rJ)(s.ag._('Failed to revert repository "{repositoryName}" to version "{number}"',{repositoryName:n,number:o}),(function(){return i({revertModal:null})}),a))}(n.revertModal,{addAlert:t,setState:r,query:o})},version:n.revertModal.number}):null},onClick:function(e,t){var n=e.repositoryName,r=e.number,o=e.pulp_href;return(0,t.setState)({revertModal:{repositoryName:n,number:r,pulp_href:o}})},disabled:function(e){return e.isLatest?s.ag._("Already the current version"):null}}),V=n(4942);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,V.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=function(e){var t=e.addAction,n=e.closeAction,r=e.sourceRepository,c=(0,a.useState)([]),u=(0,D.Z)(c,2),d=u[0],m=u[1],f=(0,a.useState)([]),y=(0,D.Z)(f,2),_=y[0],b=y[1],g=function(e){var t=x({},e.params);return t.ordering=t.sort,delete t.sort,p.eq.list(x({},t)).then((function(e){var t=e.data;return{data:{count:t.meta.count,results:t.data}}}))},h=(0,a.useState)({}),C=(0,D.Z)(h,2),k=C[0],E=C[1];return i().createElement(o.Modal,{actions:[i().createElement(o.Button,{key:"confirm",onClick:function(){return t(_)},variant:"primary",isDisabled:!_},s.ag._("Select")),i().createElement(o.Button,{key:"cancel",onClick:n,variant:"link"},s.ag._("Cancel"))],isOpen:!0,onClose:n,title:s.ag._("Select a collection"),variant:"large"},i().createElement("section",{className:"modal-body","data-cy":"modal-body"},i().createElement(l.qU,{actionContext:{addAlert:function(e){m([].concat((0,M.Z)(d),[e]))},state:k,setState:E,query:g,hasPermission:function(){throw"unused"}},defaultPageSize:10,defaultSort:"name",errorTitle:s.ag._("Collection versions could not be displayed."),filterConfig:[{id:"keywords",title:s.ag._("Keywords")},{id:"namespace",title:s.ag._("Namespace")},{id:"repository_name",title:s.ag._("Repository")}],noDataDescription:s.ag._("Collection versions will appear once a collection is uploaded."),noDataTitle:s.ag._("No collection versions yet"),query:g,renderTableRow:function(e,t){var n=e.collection_version,a=n.name,l=n.namespace,c=n.version,s=n.description,u=e.repository,d=r.pulp_href===u.pulp_href;return i().createElement("tr",{onClick:function(){return b(v.KU.pushToOrFilterOutCollections(e,_))},key:t},i().createElement("td",null,i().createElement(o.Checkbox,{"aria-label":"".concat(l,".").concat(a," v").concat(c),id:"collection-".concat(t),isChecked:d||_.includes(e),name:"collection-".concat(t),isDisabled:d})),i().createElement("td",null,l,".",a," v",c),i().createElement("td",null,s),i().createElement("td",null,u.name))},sortHeaders:[{title:"",type:"none",id:"radio"},{title:s.ag._("Collection"),type:"none",id:"col1"},{title:s.ag._("Description"),type:"none",id:"col2"},{title:s.ag._("Repository"),type:"none",id:"col3"}],title:s.ag._("Collection versions")})),i().createElement(l.UW,{alerts:d,closeAlert:function(e){return(0,l.M6)(e,{alerts:d,setAlerts:m})}}))},I=c({condition:d.lo,title:s.ag._("Add collection"),modal:function(e){var t=e.addAlert,n=e.state,r=e.setState,o=e.query;return n.addCollectionVersionModal?i().createElement(j,{addAction:function(e){!function(e,t,n){var r=e.repositoryHref,o=e.repositoryName,a=n.addAlert,i=n.setState,l=n.query,c=(0,v.LL)(r),u=t.map((function(e){return e.collection_version.pulp_href}));p.UX.addContent(c,u).then((function(e){var n=e.data;t.map((function(e){var t=e.collection_version,r=t.name,c=t.namespace,u=t.version,d=e.repository;a((0,v.zT)(n.task,s.ag._('Started adding {namespace}.{name} v{version} from "{0}" to repository "{repositoryName}".',{0:d.name,namespace:c,name:r,version:u,repositoryName:o}))),i((function(e){return x(x({},e),{},{addCollectionVersionModal:null})})),l({})}))})).catch((0,v.rJ)(s.ag._('{0, plural, one {Failed to add collection to repository "{repositoryName}".} other {Failed to add collections to repository "{repositoryName}".}}',{0:t.length,repositoryName:o}),(function(){return i((function(e){return x(x({},e),{},{addCollectionVersionModal:null})}))}),a))}(n.addCollectionVersionModal,e,{addAlert:t,setState:r,query:o})},closeAction:function(){return r((function(e){return x(x({},e),{},{addCollectionVersionModal:null})}))},sourceRepository:n.repository}):null},onClick:function(e,t){var n=t.state.repository,r=n.name,o=n.pulp_href;return(0,t.setState)((function(e){return x(x({},e),{},{addCollectionVersionModal:{repositoryHref:o,repositoryName:r}})}))}}),z=function(e){var t=e.name,n=e.namespace,r=e.repositoryName,c=e.version,u=e.closeAction,d=e.deleteAction,m=(0,a.useState)(!1),p=(0,D.Z)(m,2),v=p[0],f=p[1];return t?i().createElement(l.pf,{spinner:v,cancelAction:function(){f(!1),u()},deleteAction:function(){f(!1),d()},isDisabled:v,isRemove:!0,title:s.ag._("Remove collection version?")},i().createElement(o.Text,null,i().createElement(R.cC,{id:"Are you sure you want to remove the collection version <0>{namespace}.{name} v{version}</0> from the <1>{repositoryName}</1> repository?",values:{namespace:n,name:t,version:c,repositoryName:r},components:{0:i().createElement("b",null),1:i().createElement("b",null)}}))):null},B=c({condition:d.lo,title:s.ag._("Remove"),modal:function(e){var t=e.addAlert,n=e.state,r=e.setState,o=e.query;return n.removeCollectionVersionModal?i().createElement(z,{closeAction:function(){return r({removeCollectionVersionModal:null})},deleteAction:function(){return function(e,t){var n=e.collection,r=n.namespace,o=n.name,a=n.version,i=e.collectionVersionHref,l=e.repositoryHref,c=e.repositoryName,u=t.addAlert,d=t.setState,m=t.query,f=(0,v.LL)(l);return p.UX.removeContent(f,i).then((function(e){var t=e.data;u((0,v.zT)(t.task,s.ag._('Removal of {namespace}.{name} v{version} from repository "{repositoryName}" started.',{namespace:r,name:o,version:a,repositoryName:c}))),d({removeCollectionVersionModal:null}),m()})).catch((0,v.rJ)(s.ag._('Failed to remove {namespace}.{name} v{version} from repository "{repositoryName}".',{namespace:r,name:o,version:a,repositoryName:c}),(function(){return d({removeCollectionVersionModal:null})}),u))}(n.removeCollectionVersionModal,{addAlert:t,setState:r,query:o})},name:n.removeCollectionVersionModal.collection.name,namespace:n.removeCollectionVersionModal.collection.namespace,repositoryName:n.removeCollectionVersionModal.repositoryName,version:n.removeCollectionVersionModal.collection.version}):null},onClick:function(e,t){var n=e.collection_version,r=n.namespace,o=n.name,a=n.version,i=n.pulp_href,l=e.repository,c=l.name,s=l.pulp_href;return(0,t.setState)({removeCollectionVersionModal:{collection:{namespace:r,name:o,version:a},repositoryName:c,repositoryHref:s,collectionVersionHref:i}})}})},6640:(e,t,n)=>{n.d(t,{DQ:()=>l,MT:()=>c,Wt:()=>y,X0:()=>f,Xn:()=>d,fY:()=>v,lo:()=>m,nm:()=>i,rH:()=>a,vn:()=>p,yA:()=>s,zN:()=>u});var r=function(e){return function(t){var n=t.hasPermission,r=t.user;return n(e)||(null==r?void 0:r.is_superuser)}},o=function(e){return function(t,n){var r=t.hasPermission,o=t.hasObjectPermission,a=t.user;return r(e)||(null==o?void 0:o(e,n))||(null==a?void 0:a.is_superuser)}},a=r("ansible.add_collectionremote"),i=o("ansible.delete_collectionremote"),l=o("ansible.change_collectionremote"),c=o("ansible.view_collectionremote"),s=o("ansible.manage_roles_collectionremote"),u=r("ansible.add_ansiblerepository"),d=o("ansible.delete_ansiblerepository"),m=o("ansible.change_ansiblerepository"),p=m,v=function(e){var t=e.user,n=e.featureFlags;return t&&(null==n?void 0:n.display_repositories)},f=o("ansible.manage_roles_ansiblerepository"),y=m}}]);
//# sourceMappingURL=../sourcemaps/1811.0a5d672b0ddd081d484b6543ba5665f3.js.map