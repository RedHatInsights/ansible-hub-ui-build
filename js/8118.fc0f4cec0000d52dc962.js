"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[8118],{48118:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var n=r(4942),a=r(14744),o=r(13855),l=r(92950),i=r.n(l),s=r(61811),u=r(45586),c=r(41315),p=r(61647),m=r(6640),d=r(92518),f=r(70885);function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==r.return||r.return()}finally{if(i)throw o}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var b=function(e){var t=e.item,r=e.actionContext,n=r.addAlert,a=r.featureFlags,s=r.hasPermission,y=r.state.params,b=r.user,g=(null==t?void 0:t.pulp_href)&&(0,d.LL)(t.pulp_href),h=(0,l.useState)(null==t?void 0:t.name),_=(0,f.Z)(h,2),O=_[0],E=_[1],P=(0,l.useState)(null),w=(0,f.Z)(P,2),j=w[0],R=w[1],S=(0,l.useState)(!1),D=(0,f.Z)(S,2),C=D[0],Z=D[1],k=(0,l.useState)(null),A=(0,f.Z)(k,2),U=A[0],I=A[1],N=(0,l.useState)(null),x=(0,f.Z)(N,2),L=x[0],G=x[1],T=(0,l.useState)(null),B=(0,f.Z)(T,2),V=B[0],F=B[1],q=(0,l.useState)(null),X=(0,f.Z)(q,2),z=X[0],M=X[1],W=(0,l.useState)(null),H=(0,f.Z)(W,2),Y=H[0],K=H[1],$=function(){R(null),u.UX.myPermissions(g).then((function(e){var t=e.data.permissions;Z((0,m.X0)({hasPermission:s,hasObjectPermission:function(e){return t.includes(e)},user:b,featureFlags:a})),u.UX.listRoles(g).then((function(e){var t,r=e.data.roles,n=[],a=v(r);try{for(a.s();!(t=a.n()).done;){var o,l=t.value,i=l.groups,s=l.role,u=v(i);try{var c=function(){var e=o.value,t=n.findIndex((function(t){return t.name===e}));-1==t?n.push({name:e,object_roles:[s]}):n[t].object_roles.push(s)};for(u.s();!(o=u.n()).done;)c()}catch(e){u.e(e)}finally{u.f()}}}catch(e){a.e(e)}finally{a.f()}E(O),R(n)})).catch((function(){R([])}))})).catch((function(){R([]),Z(!1)}))},J=function(e){var t=e.roles,r=e.alertSuccess,a=e.alertFailure,o=e.stateUpdate;Promise.all(t).then((function(){n({title:r,variant:"success"}),$()})).catch((function(e){var t=e.response,r=t.status,o=t.statusText;n({title:a,variant:"danger",description:(0,d.N3)(r,o)})})).finally((function(){Q(o)}))},Q=function(e){Object.entries(e).forEach((function(e){var t=(0,f.Z)(e,2),r=t[0],n=t[1];switch(r){case"showGroupRemoveModal":G(n);break;case"showGroupSelectWizard":F(n);break;case"showRoleRemoveModal":M(n);break;case"showRoleSelectWizard":K(n);break;default:console.error("updateProps",r,n)}}))};return(0,l.useEffect)($,[t.pulp_href]),(0,l.useEffect)((function(){j&&(null!=y&&y.group?u.lO.list({name:y.group}).then((function(e){var t=e.data.data;I(j.find((function(e){return e.name===t[0].name})))})):I(null))}),[null==y?void 0:y.group,j]),i().createElement(c.yW,{addGroup:function(e,t){var r=t.map((function(t){return u.UX.addRole(g,{role:t.name,groups:[e.name]})}));J({roles:r,alertSuccess:o.ag._('Group "{0}" has been successfully added to "{name}".',{0:e.name,name:O}),alertFailure:o.ag._('Group "{0}" could not be added to "{name}".',{0:e.name,name:O}),stateUpdate:{showGroupSelectWizard:null}})},addRole:function(e,t){var r=t.map((function(t){return u.UX.addRole(g,{role:t.name,groups:[e.name]})}));J({roles:r,alertSuccess:o.ag._('Group "{0}" roles successfully updated in "{name}".',{0:e.name,name:O}),alertFailure:o.ag._('Group "{0}" roles could not be update in "{name}".',{0:e.name,name:O}),stateUpdate:{showRoleSelectWizard:null}})},canEditOwners:C,group:U,groups:j,name:O,pulpObjectType:"repositories/ansible/ansible",removeGroup:function(e){var t=e.object_roles.map((function(t){return u.UX.removeRole(g,{role:t,groups:[e.name]})}));J({roles:t,alertSuccess:o.ag._('Group "{0}" has been successfully removed from "{name}".',{0:e.name,name:O}),alertFailure:o.ag._('Group "{0}" could not be removed from "{name}".',{0:e.name,name:O}),stateUpdate:{showGroupRemoveModal:null}})},removeRole:function(e,t){var r=u.UX.removeRole(g,{role:e,groups:[t.name]});J({roles:[r],alertSuccess:o.ag._('Group "{0}" roles successfully updated in "{name}".',{0:t.name,name:O}),alertFailure:o.ag._('Group "{0}" roles could not be update in "{name}".',{0:t.name,name:O}),stateUpdate:{showRoleRemoveModal:null}})},selectRolesMessage:o.ag._("The selected roles will be added to this specific Ansible repository."),showGroupRemoveModal:L,showGroupSelectWizard:V,showRoleRemoveModal:z,showRoleSelectWizard:Y,updateProps:Q,urlPrefix:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:O})})},g=r(62012);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=function(e){var t=e.item,r=e.actionContext,n=r.addAlert,a=r.hasPermission,m=function(e){var r=_({},e.params);r.ordering=r.sort,delete r.sort;var n=(0,d.LL)(t.pulp_href);return u.eq.list(_({repository:n},r)).then((function(e){var t=e.data;return{data:{count:t.meta.count,results:t.data}}}))},v=(0,l.useState)({repository:t}),y=(0,f.Z)(v,2),b=y[0],h=y[1];return(0,l.useEffect)((function(){return h((function(e){return _(_({},e),{},{repository:t})}))}),[t]),i().createElement(c.qU,{actionContext:{addAlert:n,state:b,setState:h,query:m,hasPermission:a,hasObjectPermission:function(e){var r,n;return null==t||null===(r=t.my_permissions)||void 0===r||null===(n=r.includes)||void 0===n?void 0:n.call(r,e)}},defaultPageSize:10,defaultSort:"name",errorTitle:o.ag._("Collection versions could not be displayed."),filterConfig:[{id:"keywords",title:o.ag._("Keywords")},{id:"namespace",title:o.ag._("Namespace")}],headerActions:[s.Ub],listItemActions:[s.No],noDataButton:s.Ub.button,noDataDescription:o.ag._("Collection versions will appear once the collection is modified."),noDataTitle:o.ag._("No collection versions yet"),query:m,renderTableRow:function(e,t,r,n){var a=e.collection_version,o=a.name,l=a.namespace,s=a.version,u=a.description,m=e.repository,d=n.map((function(t){return t.dropdownItem(e,r)}));return i().createElement("tr",{key:t},i().createElement("td",null,i().createElement(g.Link,{to:(0,p.dI)(p.nB.collectionByRepo,{repo:m.name,namespace:l,collection:o},{version:s})},l,".",o," v",s)),i().createElement("td",null,u),i().createElement(c.cT,{kebabItems:d}))},sortHeaders:[{title:o.ag._("Collection"),type:"none",id:"col1"},{title:o.ag._("Description"),type:"none",id:"col2"}],title:o.ag._("Collection versions")})},E=function(e){var t,r=e.item,n=(0,l.useState)(null),a=(0,f.Z)(n,2),s=a[0],m=a[1];return(0,l.useEffect)((function(){var e=r.remote&&(0,d.LL)(r.remote);e?u.GC.get(e).then((function(e){var t=e.data;return m(t)})):m(null)}),[r.remote]),i().createElement(c.PO,{fields:[{label:o.ag._("Repository name"),value:null==r?void 0:r.name},{label:o.ag._("Description"),value:(null==r?void 0:r.description)||o.ag._("None")},{label:o.ag._("Retained version count"),value:null!==(t=null==r?void 0:r.retain_repo_versions)&&void 0!==t?t:o.ag._("All")},{label:o.ag._("Distribution"),value:i().createElement(c.fM,{repositoryHref:r.pulp_href})},{label:o.ag._("Labels"),value:i().createElement(c.rT,{labels:null==r?void 0:r.pulp_labels})},{label:o.ag._("Private"),value:null!=r&&r.private?o.ag._("Yes"):o.ag._("No")},{label:o.ag._("Remote"),value:s?i().createElement(g.Link,{to:(0,p.dI)(p.nB.ansibleRemoteDetail,{name:s.name})},s.name):o.ag._("None")}]})},P=r(87462),w=r(43144),j=r(15671),R=r(97326),S=r(79340),D=r(82963),C=r(61120),Z=r(35356);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var U=function(e){var t=e.href,r=e.addAlert,a=e.hasPermission,s=e.repositoryName,m=(0,l.useState)({}),d=(0,f.Z)(m,2),v=d[0],y=d[1];if(!t)return null;var b=function(e){return new(function(t){(0,S.Z)(l,t);var r,a,o=(r=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,C.Z)(r);if(a){var n=(0,C.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,D.Z)(this,e)});function l(){var t;(0,j.Z)(this,l);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=o.call.apply(o,[this].concat(a)),(0,n.Z)((0,R.Z)(t),"useOrdering",!0),(0,n.Z)((0,R.Z)(t),"apiPath",e.replace("/api/automation-hub/pulp/api/v3/","")),t}return(0,w.Z)(l)}(u.jx))}(t),h=function(e){var t=e.params;return b.list(t)};return i().createElement(c.qU,{actionContext:{addAlert:r,state:v,setState:y,query:h,hasPermission:a},defaultPageSize:10,defaultSort:"name",errorTitle:o.ag._("Collection versions could not be displayed."),noDataDescription:o.ag._("No collection versions in this repository version."),noDataTitle:o.ag._("No collection versions yet"),query:h,renderTableRow:function(e){var t=e.manifest.collection_info,r=t.namespace,n=t.name,a=t.version,o=e.description;return i().createElement("tr",null,i().createElement("td",null,i().createElement(g.Link,{to:(0,p.dI)(p.nB.collectionByRepo,{repo:s,namespace:r,collection:n},{version:a})},r,".",n," v",a)),i().createElement("td",null,o))},sortHeaders:[{title:o.ag._("Collection"),type:"none",id:"col1"},{title:o.ag._("Description"),type:"none",id:"col2"}],title:o.ag._("Collection versions")})},I=function(e){var t=e.data;return Object.keys(t).length?i().createElement("table",{className:"pf-c-table"},i().createElement("tr",null,i().createElement("th",null,o.ag._("Count")),i().createElement("th",null,o.ag._("Pulp type"))),Object.entries(t).map((function(e){var t=(0,f.Z)(e,2),r=t[0],n=t[1];return i().createElement("tr",{key:r},i().createElement("td",null,n.count),i().createElement("th",null,r))}))):i().createElement(i().Fragment,null,o.ag._("None"))},N=function(e){var t=e.repositoryName,r=e.data;if(!r)return i().createElement(i().Fragment,null,o.ag._("None"));var n=r.split("/").at(-2);return i().createElement(g.Link,{to:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:t},{repositoryVersion:n,tab:"repository-versions"})},n)},x=function(e){var t,r,n,a=e.item,m=e.actionContext,v=m.addAlert,y=m.state,b=m.hasPermission,h=m.hasObjectPermission,_=(0,d.LL)(a.pulp_href),O=a.latest_version_href,E=a.name,w=function(e){var t=e.params;return u.UX.listVersions(_,t)},j=(0,l.useState)({}),R=(0,f.Z)(j,2),S=R[0],D=R[1],C=(0,l.useState)(null),k=(0,f.Z)(C,2),x=k[0],L=k[1];return(0,l.useEffect)((function(){var e,t;y.params.repositoryVersion?(e={number:y.params.repositoryVersion},t=e.number,u.UX.listVersions(_,{number:t})).then((function(e){var t,r=e.data;null!=r&&null!==(t=r.results)&&void 0!==t&&t[0]||v({variant:"danger",title:o.ag._("Failed to find repository version")}),L(r.results[0])})):L(null)}),[y.params.repositoryVersion]),y.params.repositoryVersion?x?i().createElement(i().Fragment,null,i().createElement(c.PO,{fields:[{label:o.ag._("Version number"),value:x.number},{label:o.ag._("Created date"),value:i().createElement(c.Id,{date:x.pulp_created})},{label:o.ag._("Content added"),value:i().createElement(I,{data:null===(t=x.content_summary)||void 0===t?void 0:t.added})},{label:o.ag._("Content removed"),value:i().createElement(I,{data:null===(r=x.content_summary)||void 0===r?void 0:r.removed})},{label:o.ag._("Current content"),value:i().createElement(I,{data:null===(n=x.content_summary)||void 0===n?void 0:n.present})},{label:o.ag._("Base version"),value:i().createElement(N,{repositoryName:E,data:x.base_version})}]}),i().createElement("div",{className:"pf-c-page__main-section",style:{padding:"8px 0",margin:"24px -16px 0"}}),i().createElement(U,(0,P.Z)({},x.content_summary.present["ansible.collection_version"],{repositoryName:E}))):i().createElement(Z.Spinner,{size:"md"}):i().createElement(c.qU,{actionContext:{addAlert:v,state:S,setState:D,query:w,hasPermission:b,hasObjectPermission:h},defaultPageSize:10,defaultSort:"-pulp_created",errorTitle:o.ag._("Repository versions could not be displayed."),filterConfig:null,listItemActions:[s.W],noDataButton:null,noDataDescription:o.ag._("Repository versions will appear once the repository is modified."),noDataTitle:o.ag._("No repository versions yet"),query:w,renderTableRow:function(e,t,r,n){var a=e.number,l=e.pulp_created,s=e.pulp_href,u=O===s,m=n.map((function(t){return t.dropdownItem(A(A({},e),{},{isLatest:u,repositoryName:E}),r)}));return i().createElement("tr",{key:t},i().createElement("td",null,i().createElement(g.Link,{to:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:E},{repositoryVersion:a,tab:"repository-versions"})},a),u?" "+o.ag._("(latest)"):null),i().createElement("td",null,i().createElement(c.Id,{date:l})),i().createElement(c.cT,{kebabItems:m}))},sortHeaders:[{title:o.ag._("Version number"),type:"numeric",id:"number"},{title:o.ag._("Created date"),type:"numeric",id:"pulp_created"}],title:o.ag._("Repository versions")})};function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=[{id:"details",name:o.ag._("Details")},{id:"access",name:o.ag._("Access")},{id:"collection-versions",name:o.ag._("Collection versions")},{id:"repository-versions",name:o.ag._("Versions")}];const B=(0,c.L9)({breadcrumbs:function(e){var t=e.name,r=e.tab,n=e.params,a=n.repositoryVersion,l=n.group;return[{url:(0,p.dI)(p.nB.ansibleRepositories),name:o.ag._("Repositories")},{url:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:t}),name:t},"repository-versions"===r.id&&a||"access"===r.id&&l?{url:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:t},{tab:r.id}),name:r.name}:null,"repository-versions"===r.id&&a?{name:o.ag._("Version {repositoryVersion}",{repositoryVersion:a})}:"access"===r.id&&l?{name:o.ag._("Group {group}",{group:l})}:{name:r.name}].filter(Boolean)},condition:m.fY,displayName:"AnsibleRepositoryDetail",errorTitle:o.ag._("Repository could not be displayed."),headerActions:[s.cv,s.hE,s.sO,s.e5],headerDetails:function(e){return i().createElement(i().Fragment,null,(null==e?void 0:e.last_sync_task)&&i().createElement("p",{className:"hub-m-truncated"},i().createElement(a.cC,{id:"Last updated from registry {0}",values:{0:(0,d.Fr)(e)}})," ",(0,d.Eb)(e)))},query:function(e){var t=e.name;return u.UX.list({name:t}).then((function(e){return e.data.results[0]})).then((function(e){return e?u.UX.myPermissions((0,d.LL)(e.pulp_href)).then((function(e){return e.data.permissions})).catch((function(e){return console.error(e),[]})).then((function(t){return G(G({},e),{},{my_permissions:t})})):Promise.reject({response:{status:404}})}))},renderTab:function(e,t,r){return{details:i().createElement(E,{item:t,actionContext:r}),access:i().createElement(b,{item:t,actionContext:r}),"collection-versions":i().createElement(O,{item:t,actionContext:r}),"repository-versions":i().createElement(x,{item:t,actionContext:r})}[e]},tabs:T,tabUpdateParams:function(e){return delete e.repositoryVersion,delete e.group,e}})}}]);
//# sourceMappingURL=../sourcemaps/8118.5d0e315bf20ffea70304cdad2eb2eeb8.js.map