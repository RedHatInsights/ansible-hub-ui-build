"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[679],{66679:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var r=n(53986),a=n(10467),i=n(45458),o=n(80296),s=n(23029),u=n(92901),l=n(50388),c=n(53954),p=n(15361),d=n(64467),f=n(54756),m=n.n(f),v=n(47712),h=n(30769),y=n(5924),g=n(64490),_=n(52565),b=n(31554),R=n(97192),C=n(44914),A=n.n(C),k=n(88696),E=n(35894),S=n(97899),j=n(39799),P=["sort"];function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e,t,n){return t=(0,c.A)(t),(0,l.A)(e,w()?Reflect.construct(t,n||[],(0,c.A)(e).constructor):t.apply(e,n))}function w(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(w=function(){return!!e})()}var V=function(e){function t(e){var n;(0,s.A)(this,t),n=U(this,t,[e]);var r=j.mb.parseParamString(e.location.search,["page","page_size"]);return r.page_size||(r.page_size=10),r.sort||(r.sort="-pulp_created"),r.repository_label||(r.repository_label="pipeline=staging"),n.state={versions:void 0,itemCount:0,params:r,loading:!0,updatingVersions:[],alerts:[],unauthorized:!1,inputText:"",uploadCertificateModalOpen:!1,versionToUploadCertificate:null,approveModalInfo:null,repositories:{approved:null,rejected:null}},n}return(0,p.A)(t,e),(0,u.A)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.context,n=t.user,r=t.hasPermission;n&&!n.is_anonymous&&r("ansible.modify_ansible_repo_content")?(this.setState({loading:!0}),Promise.all([this.queryCollections(!1),this.queryRepositories()]).then((function(){e.setState({loading:!1}),e.setState({updatingVersions:[]})}))):this.setState({unauthorized:!0})}},{key:"queryRepositories",value:function(){var e=this,t=function(t){return k.Xj.list({page:1,page_size:1,pulp_label_select:"pipeline=".concat(t)}).then((function(e){var t=e.data,n=t.count,r=t.results;return 1===n?r[0]:null})).catch((function(n){return e.addAlert(v.Ru._({id:"clie21",values:{pipeline:t}}),"danger",null==n?void 0:n.message),null}))};return Promise.all([t("approved"),t("rejected")]).then((function(t){var n=(0,o.A)(t,2),r=n[0],a=n[1];return e.setState({repositories:{approved:r,rejected:a}})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.alerts,r=t.versions,a=t.params,i=t.itemCount,o=t.loading,s=t.unauthorized;return r||s?A().createElement(A().Fragment,null,A().createElement(E.T$,{title:v.Ru._({id:"WSRF7q"})}),A().createElement(E.NS,{alerts:n,closeAlert:function(t){return(0,E.R$)(t,{alerts:n,setAlerts:function(t){return e.setState({alerts:t})}})}}),s?A().createElement(E.Pd,null):A().createElement(E.gZ,{className:"hub-certification-dashboard"},A().createElement("section",{className:"body","data-cy":"body"},A().createElement("div",{className:"hub-toolbar"},A().createElement(h.M,null,A().createElement(y.P,null,A().createElement(g.$,null,A().createElement(_.T,null,A().createElement(E.Mw,{inputText:this.state.inputText,onChange:function(t){e.setState({inputText:t})},updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},params:a,filterConfig:[{id:"namespace",title:v.Ru._({id:"wMe2Qp"})},{id:"name",title:v.Ru._({id:"Bcyiqj"})},{id:"repository_label",title:v.Ru._({id:"uAQUqI"}),inputType:"select",options:[{id:"pipeline=rejected",title:v.Ru._({id:"ekCRTP"})},{id:"pipeline=staging",title:v.Ru._({id:"K7lqZC"})},{id:"pipeline=approved",title:v.Ru._({id:"7kb4LU"})}]}]}))))),A().createElement(E.w1,{params:a,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:i,isTop:!0})),A().createElement("div",null,A().createElement(E.lU,{updateParams:function(t){e.updateParams(t,(function(){return e.queryCollections(!0)})),e.setState({inputText:""})},params:a,ignoredParams:["page_size","page","sort"],niceValues:{repository_label:{"pipeline=approved":v.Ru._({id:"7kb4LU"}),"pipeline=rejected":v.Ru._({id:"ekCRTP"}),"pipeline=staging":v.Ru._({id:"K7lqZC"})}},niceNames:{name:v.Ru._({id:"Bcyiqj"}),namespace:v.Ru._({id:"wMe2Qp"}),repository_label:v.Ru._({id:"uAQUqI"})}})),o?A().createElement(E.kt,null):this.renderTable(r,a),A().createElement("div",{className:"footer"},A().createElement(E.w1,{params:a,updateParams:function(t){return e.updateParams(t,(function(){return e.queryCollections(!0)}))},count:i}))),A().createElement(E.vO,{isOpen:this.state.uploadCertificateModalOpen,onCancel:function(){return e.closeUploadCertificateModal()},onSubmit:function(t){return e.submitCertificate(t)}}),this.state.approveModalInfo&&A().createElement(E.Nl,{closeAction:function(){e.setState({approveModalInfo:null})},finishAction:function(){e.setState({approveModalInfo:null}),e.queryCollections(!0)},collectionVersion:this.state.approveModalInfo,addAlert:function(t){return e.addAlertObj(t)}}))):A().createElement(E.AV,null)}},{key:"renderTable",value:function(e,t){var n=this;if(0===e.length)return(0,j.l)(t,["namespace","name","repository_label"])?A().createElement(E.br,null):A().createElement(E.a4,{title:v.Ru._({id:"f1gH0D"}),description:v.Ru._({id:"6STYN5"})});var r={headers:[{title:v.Ru._({id:"wMe2Qp"}),type:"alpha",id:"namespace"},{title:v.Ru._({id:"q+hNag"}),type:"alpha",id:"name"},{title:v.Ru._({id:"eE0JZ4"}),type:"number",id:"version"},{title:v.Ru._({id:"u46WEi"}),type:"number",id:"pulp_created"},{title:v.Ru._({id:"IreQBq"}),type:"none",id:""},{title:v.Ru._({id:"uAQUqI"}),type:"none",id:"repository_label"},{title:"",type:"none",id:"certify"}]};return A().createElement(b.X,{"aria-label":v.Ru._({id:"QGV1gp"})},A().createElement(E.HW,{options:r,params:t,updateParams:function(e){return n.updateParams(e,(function(){return n.queryCollections(!0)}))}}),A().createElement(R.N,null,e.map((function(e,t){return A().createElement(E.K3,{approve:function(e){return n.approve(e)},collectionVersion:e,featureFlags:n.context.featureFlags,isVersionUpdating:function(e){return n.isVersionUpdating(e)},key:t,openUploadCertificateModal:function(e){return n.openUploadCertificateModal(e)},reject:function(e){return n.reject(e)}})}))))}},{key:"isVersionUpdating",value:function(e){return!!this.state.updatingVersions.find((function(t){return t==e}))}},{key:"openUploadCertificateModal",value:function(e){this.setState({uploadCertificateModalOpen:!0,versionToUploadCertificate:e})}},{key:"closeUploadCertificateModal",value:function(){this.setState({uploadCertificateModalOpen:!1,versionToUploadCertificate:null})}},{key:"submitCertificate",value:function(e){var t=this,n=this.state.versionToUploadCertificate,r=n.collection_version,a=n.repository,i=r.pulp_href,o=r.name,s=r.namespace,u=r.version;k.l5.upload({file:e,repository:a.pulp_href,signed_collection:i}).then((function(e){var t=e.data.task;return(0,j.aZ)(t)})).then((function(){return t.addAlert(v.Ru._({id:"EeVTY1",values:{namespace:s,name:o,version:u}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var n=e.response?(0,j.gJ)(e.response.status,e.response.statusText):e;t.addAlert(v.Ru._({id:"CAcrUo",values:{namespace:s,name:o,version:u}}),"danger",n)})).finally((function(){return t.closeUploadCertificateModal()}))}},{key:"setUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:[].concat((0,i.A)(t),[e])})}},{key:"unsetUpdatingVersion",value:function(e){var t=this.state.updatingVersions;this.setState({updatingVersions:t.filter((function(t){return t!==e}))})}},{key:"approve",value:(c=(0,a.A)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.state.repositories).approved?this.move(t,n.approved):this.setState({approveModalInfo:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"reject",value:(l=(0,a.A)(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.state.repositories).rejected){e.next=5;break}return r=t.collection_version,this.addAlert(v.Ru._({id:"vwJz0n",values:{0:r.namespace,1:r.name,2:r.version}}),"danger",v.Ru._({id:"F020md"})),e.abrupt("return");case 5:return e.next=7,this.isRejected(t);case 7:if(!e.sent){e.next=11;break}this.remove(t),e.next=12;break;case 11:this.move(t,n.rejected);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"move",value:function(e,t){var n=this,r=e.collection_version,a=e.repository;return this.setUpdatingVersion(e),Promise.all([(0,j.Jh)(a.name,a.pulp_href),(0,j.Jh)(t.name,t.pulp_href)]).then((function(e){var t=(0,o.A)(e,2),n=t[0],a=t[1];return k.R4.move(r.namespace,r.name,r.version,n,a)})).then((function(e){return(0,j.aZ)(e.data.remove_task_id,{waitMs:500})})).then((function(){return n.addAlert(v.Ru._({id:"f0S6WW",values:{0:r.namespace,1:r.name,2:r.version}}),"success")})).then((function(){return n.queryCollections(!0)})).catch((function(e){var t=e.response?(0,j.gJ)(e.response.status,e.response.statusText):e;n.addAlert(v.Ru._({id:"vwJz0n",values:{0:r.namespace,1:r.name,2:r.version}}),"danger",t)})).finally((function(){return n.unsetUpdatingVersion(e)}))}},{key:"remove",value:function(e){var t=this,n=e.collection_version,r=e.repository;return this.setUpdatingVersion(e),k.Xj.removeContent((0,j.dx)(r.pulp_href),n.pulp_href).then((function(e){var t=e.data.task;return(0,j.RN)(t)})).then((function(){return t.addAlert(v.Ru._({id:"f0S6WW",values:{0:n.namespace,1:n.name,2:n.version}}),"success")})).then((function(){return t.queryCollections(!0)})).catch((function(e){var r=e.response?(0,j.gJ)(e.response.status,e.response.statusText):e;t.addAlert(v.Ru._({id:"vwJz0n",values:{0:n.namespace,1:n.name,2:n.version}}),"danger",r)})).finally((function(){return t.unsetUpdatingVersion(e)}))}},{key:"isRejected",value:(n=(0,a.A)(m().mark((function e(t){var n,r,a,i,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state.repositories,r=t.collection_version,a=r.name,i=r.namespace,o=r.version,e.abrupt("return",k.R4.list({name:a,namespace:i,page:1,page_size:1,repository:(0,j.dx)(n.rejected.pulp_href),version:o}).then((function(e){return!!e.data.meta.count})).catch((function(){return!1})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"queryCollections",value:function(e){var t=this;e&&this.setState({loading:!0});var n=this.state.params,a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,d.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({order_by:n.sort},(0,r.A)(n,P));return k.R4.list(a).then((function(n){t.setState({versions:n.data.data,itemCount:n.data.meta.count}),e&&t.setState({loading:!1,updatingVersions:[]})})).catch((function(e){t.addAlert(v.Ru._({id:"A5KmrN"}),"danger",null==e?void 0:e.message),t.setState({loading:!1,updatingVersions:[]})}))}},{key:"updateParams",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;j.mb.updateParams({params:e,navigate:function(e){return t.props.navigate(e)},setState:function(e){return t.setState(e,n)}})}},{key:"addAlert",value:function(e,t,n){this.setState({alerts:[].concat((0,i.A)(this.state.alerts),[{description:n,title:e,variant:t}])})}},{key:"addAlertObj",value:function(e){this.addAlert(e.title,e.variant,e.description)}}]);var n,l,c}(C.Component);(0,d.A)(V,"contextType",S.B);const q=(0,j.y)(V)}}]);
//# sourceMappingURL=../sourcemaps/679.839a2206767e7826b01c5cd0345a2b0c.js.map