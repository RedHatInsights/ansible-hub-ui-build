"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[885],{50885:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var a=n(58168),r=n(45458),l=n(23029),o=n(92901),i=n(56822),c=n(53954),s=n(15361),u=n(64467),d=n(47712),p=n(85889),m=n(44914),f=n.n(m),h=n(49634),y=n(88756),v=n(90593),g=n(97899),_=n(60165),S=n(75841);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,u.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t,n){return t=(0,c.A)(t),(0,i.A)(e,P()?Reflect.construct(t,n||[],(0,c.A)(e).constructor):t.apply(e,n))}function P(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(P=function(){return!!e})()}var w=function(e){function t(e){var n;(0,l.A)(this,t),n=C(this,t,[e]);var a=S.mb.parseParamString(e.location.search,["page","page_size"]);return a.page_size||(a.page_size=10),a.view_type||(a.view_type=localStorage.getItem("search_view_type")),a.sort||(a.sort="name"),n.state={collections:[],params:a,count:0,loading:!0,synclist:void 0,alerts:[],updateCollection:null,showImportModal:!1,redirect:null,noDependencies:!1,deleteCollection:null,confirmDelete:!1,isDeletionPending:!1,deleteAll:!0},n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.queryCollections(),this.getSynclist()}},{key:"addAlert",value:function(e){this.setState({alerts:[].concat((0,r.A)(this.state.alerts),[e])})}},{key:"closeAlert",get:function(){return(0,v.Ap)("alerts")}},{key:"render",value:function(){var e,t=this;if(this.state.redirect)return f().createElement(h.Navigate,{to:this.state.redirect});var n=this.state,r=n.loading,l=n.collections,o=n.params,i=n.count,c=n.showImportModal,s=n.updateCollection,u=n.deleteCollection,p=n.confirmDelete,m=n.isDeletionPending,y=0===l.length&&!(0,S.l)(o,["keywords","tags","is_signed","repository_name","namespace"]),g=function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},k=this.state.deleteAll?null:null==u||null===(e=u.repository)||void 0===e?void 0:e.name,b=["page","page_size","sort","view_type"];return f().createElement("div",{className:"search-page"},f().createElement(v.NS,{alerts:this.state.alerts,closeAlert:function(e){return t.closeAlert(e)}}),f().createElement(v.rm,{deleteCollection:u,collections:l,isDeletionPending:m,confirmDelete:p,setConfirmDelete:function(e){return t.setState({confirmDelete:e})},cancelAction:function(){return t.setState({deleteCollection:null})},deleteAction:function(){return t.setState({isDeletionPending:!0},(function(){return S.fG.deleteCollection({collection:u,setState:function(e){return t.setState(e)},load:function(){return t.load()},redirect:!1,addAlert:function(e){return t.addAlert(e)},deleteFromRepo:k})}))},deleteFromRepo:k}),c&&f().createElement(v.zb,{isOpen:c,onUploadSuccess:function(){return t.setState({redirect:(0,_.jV)(_.Jh.myImports,{},{namespace:s.collection_version.namespace})})},setOpen:function(e,n){return t.toggleImportModal(e,n)},collection:s.collection_version,namespace:s.collection_version.namespace}),f().createElement(v.T$,{className:"hub-header-bordered",title:d.Ru._({id:"DoJzLz"})}),!y&&f().createElement(v.Rx,(0,a.A)({count:i,ignoredParams:b,params:o,switcher:"search_view_type",updateParams:g},(0,v.L2)({featureFlags:this.context.featureFlags,ignoredParams:b}))),r?f().createElement(v.hQ,null):y?f().createElement(v.a4,{title:d.Ru._({id:"V1hs4Y"}),description:d.Ru._({id:"6STYN5"})}):f().createElement(f().Fragment,null,f().createElement("section",{className:"collection-container"},this.renderCollections(l,{count:i,params:o,updateParams:g})),f().createElement("section",{className:"footer"},f().createElement(v.w1,{params:o,updateParams:g,count:i}))))}},{key:"toggleImportModal",value:function(e,t){t&&this.setState({alerts:[].concat((0,r.A)(this.state.alerts),[{title:t,variant:"warning"}])}),this.setState({showImportModal:e})}},{key:"renderCollections",value:function(e,t){var n=t.count,a=t.params,r=t.updateParams;return 0===e.length?f().createElement(v.br,{clearAllFilters:function(){S.mb.clearAllFilters({params:a,ignoredParams:["page","page_size","sort","view_type"],updateParams:r})}}):"list"===a.view_type?this.renderList(e):this.renderCards(e,{count:n,params:a,updateParams:r})}},{key:"renderCards",value:function(e,t){var n,r=this,l=t.count,o=t.params,i=t.updateParams;return f().createElement("div",{className:"hub-cards"},e.map((function(e,t){return f().createElement(v.DQ,(0,a.A)({key:t},e,{footer:r.renderSyncToogle(e.collection_version.name,e.collection_version.namespace),menu:r.renderMenu(!1,e),displaySignatures:r.context.featureFlags.display_signatures}))})),l>o.page_size*(null!==(n=o.page)&&void 0!==n?n:1)?f().createElement(v.Oe,{onClick:function(){var e;return i(b(b({},o),{},{page:(null!==(e=o.page)&&void 0!==e?e:1)+1}))}}):null)}},{key:"handleControlClick",value:function(e){var t=this,n=e.collection_version.name;y.Xy.setDeprecation(e).then((function(a){var l=(0,S.dx)(a.data.task);return(0,S.aZ)(l).then((function(){var a=e.deprecated?d.Ru._({id:"QKaTiY",values:{name:n}}):d.Ru._({id:"BlYFt4",values:{name:n}});t.setState({alerts:[].concat((0,r.A)(t.state.alerts),[{title:a,variant:"success"}])}),t.load()}))})).catch((function(a){var l=a.response,o=l.status,i=l.statusText;t.setState({alerts:[].concat((0,r.A)(t.state.alerts),[{variant:"danger",title:e.deprecated?d.Ru._({id:"5dhPcd",values:{name:n}}):d.Ru._({id:"hEP0ZC",values:{name:n}}),description:(0,S.gJ)(o,i)}])})}))}},{key:"renderMenu",value:function(e,t){var n=this,a=(0,this.context.hasPermission)("galaxy.upload_to_namespace"),r=function(e){return{addAlert:function(e){return n.addAlert(e)},collection:t,openModal:function(){return n.setState({deleteCollection:t,confirmDelete:!1,deleteAll:e})}}},l=f().createElement(v.wj,{collection:t,"data-cy":"collection-kebab",onDelete:r(!0),onDeprecate:function(){return n.handleControlClick(t)},onRemove:r(!1),onUploadVersion:e?null:function(){return n.checkUploadPrivilleges(t)},wrapper:e?null:function(e){var t=e.any,n=e.children;return t?f().createElement("span",null,n):f().createElement("span",{className:"hidden-menu-space"})}});return e?{uploadButton:a?f().createElement(p.Button,{onClick:function(){return n.checkUploadPrivilleges(t)},variant:"secondary"},d.Ru._({id:"PHsJXN"})):null,dropdownMenu:l}:l}},{key:"renderSyncToogle",value:function(e,t){var n=this;return this.state.synclist?f().createElement(p.Switch,{id:t+"."+e,className:"sync-toggle",label:d.Ru._({id:"Nu4DdT"}),isChecked:this.isCollectionSynced(e,t),onChange:function(){return n.toggleCollectionSync(e,t)}}):null}},{key:"checkUploadPrivilleges",value:function(e){var t=this,n=function(){t.setState({alerts:[].concat((0,r.A)(t.state.alerts),[{title:d.Ru._({id:"XoMS0d"}),variant:"warning"}])})};y.U.get(e.collection_version.namespace,{include_related:"my_permissions"}).then((function(a){a.data.related_fields.my_permissions.includes("galaxy.upload_to_namespace")?t.setState({updateCollection:e,showImportModal:!0}):n()})).catch((function(){n()}))}},{key:"toggleCollectionSync",value:function(e,t){var n=this,a=b({},this.state.synclist),r=a.collections.findIndex((function(n){return n.name===e&&n.namespace===t}));r<0?a.collections.push({name:e,namespace:t}):a.collections.splice(r,1),y.qI.update(a.id,a).then((function(e){n.setState({synclist:e.data}),y.qI.curate(a.id).then((function(){return null}))}))}},{key:"isCollectionSynced",value:function(e,t){var n=this.state.synclist,a=n.collections.find((function(n){return n.name===e&&n.namespace===t}));return"include"===n.policy?!!a:!a}},{key:"renderList",value:function(e){var t=this;return f().createElement("div",{className:"list-container"},f().createElement("div",{className:"hub-list"},f().createElement(p.DataList,{className:"data-list","aria-label":d.Ru._({id:"74Eard"})},e.map((function(e,n){return f().createElement(v.wU,(0,a.A)({key:n,collection:e,displaySignatures:t.context.featureFlags.display_signatures,showNamespace:!0,synclistSwitch:t.renderSyncToogle(e.collection_version.name,e.collection_version.namespace)},t.renderMenu(!0,e)))})))))}},{key:"getSynclist",value:function(){var e=this;y.qI.list().then((function(t){1===t.data.meta.count?e.setState({synclist:t.data.data[0]}):console.error("my-synclist returned ".concat(t.data.meta.count," synclists"))}))}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){y.R4.list(b(b({},S.mb.getReduced(e.state.params,["view_type"])),{},{is_deprecated:!1,repository_label:"!hide_from_search",is_highest:!0})).then((function(t){e.setState({collections:t.data.data,count:t.data.meta.count,loading:!1})}))}))}},{key:"updateParams",get:function(){return S.mb.updateParamsMixin()}}]),t}(m.Component);(0,u.A)(w,"contextType",g.B);const A=(0,S.y)(w)}}]);
//# sourceMappingURL=../sourcemaps/885.2c9acb0ae5b3e08d6c2ed332a7b57b2f.js.map