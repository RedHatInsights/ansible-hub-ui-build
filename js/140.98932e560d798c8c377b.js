"use strict";(self.webpackChunkautomationHub=self.webpackChunkautomationHub||[]).push([[140],{50140:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(4942),r=n(87462),l=n(42982),o=n(15671),c=n(43144),i=n(82963),s=n(61120),u=n(79340),d=n(89555),p=n(15021),m=n(92950),f=n.n(m),g=n(62012),v=n(92403),h=n(27515),y=n(42807),_=n(61542),E=n(61647),S=n(15751);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){function t(e){var n;(0,o.Z)(this,t),n=function(e,t,n){return t=(0,s.Z)(t),(0,i.Z)(e,function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){return!1}}()?Reflect.construct(t,n||[],(0,s.Z)(e).constructor):t.apply(e,n))}(this,t,[e]);var a=S.q6.parseParamString(e.location.search,["page","page_size"]);return a.page_size||(a.page_size=y.g.DEFAULT_PAGE_SIZE),a.view_type||(a.view_type=localStorage.getItem(y.g.SEARCH_VIEW_TYPE_LOCAL_KEY)),a.sort||(a.sort="name"),n.state={collections:[],params:a,count:0,loading:!0,synclist:void 0,alerts:[],updateCollection:null,showImportModal:!1,redirect:null,noDependencies:!1,deleteCollection:null,confirmDelete:!1,isDeletionPending:!1,deleteAll:!0},n}return(0,u.Z)(t,e),(0,c.Z)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.queryCollections(),this.getSynclist()}},{key:"addAlert",value:function(e){this.setState({alerts:[].concat((0,l.Z)(this.state.alerts),[e])})}},{key:"closeAlert",get:function(){return(0,h.NQ)("alerts")}},{key:"render",value:function(){var e,t=this;if(this.state.redirect)return f().createElement(g.Navigate,{to:this.state.redirect});var n=this.state,a=n.loading,l=n.collections,o=n.params,c=n.count,i=n.showImportModal,s=n.updateCollection,u=n.deleteCollection,p=n.confirmDelete,m=n.isDeletionPending,v=0===l.length&&!(0,S.vS)(o,["keywords","tags","is_signed","repository_name","namespace"]),_=function(e){return t.updateParams(e,(function(){return t.queryCollections()}))},P=this.state.deleteAll?null:null==u||null===(e=u.repository)||void 0===e?void 0:e.name,C=["page","page_size","sort","view_type"];return f().createElement("div",{className:"search-page"},f().createElement(h.UW,{alerts:this.state.alerts,closeAlert:function(e){return t.closeAlert(e)}}),f().createElement(h.gQ,{deleteCollection:u,collections:l,isDeletionPending:m,confirmDelete:p,setConfirmDelete:function(e){return t.setState({confirmDelete:e})},cancelAction:function(){return t.setState({deleteCollection:null})},deleteAction:function(){return t.setState({isDeletionPending:!0},(function(){return S.K1.deleteCollection({collection:u,setState:function(e){return t.setState(e)},load:function(){return t.load()},redirect:!1,addAlert:function(e){return t.addAlert(e)},deleteFromRepo:P})}))},deleteFromRepo:P}),i&&f().createElement(h.ZO,{isOpen:i,onUploadSuccess:function(){return t.setState({redirect:(0,E.dI)(E.nB.myImports,{},{namespace:s.collection_version.namespace})})},setOpen:function(e,n){return t.toggleImportModal(e,n)},collection:s.collection_version,namespace:s.collection_version.namespace}),f().createElement(h.UP,{className:"hub-header-bordered",title:d.ag._({id:"DoJzLz"})}),!v&&f().createElement(h.Q_,(0,r.Z)({count:c,ignoredParams:C,params:o,switcher:y.g.SEARCH_VIEW_TYPE_LOCAL_KEY,updateParams:_},(0,h.$m)({featureFlags:this.context.featureFlags,ignoredParams:C}))),a?f().createElement(h.AW,null):v?f().createElement(h.vv,{title:d.ag._({id:"V1hs4Y"}),description:d.ag._({id:"6STYN5"})}):f().createElement(f().Fragment,null,f().createElement("section",{className:"collection-container"},this.renderCollections(l,{count:c,params:o,updateParams:_})),f().createElement("section",{className:"footer"},f().createElement(h.tl,{params:o,updateParams:_,count:c}))))}},{key:"toggleImportModal",value:function(e,t){t&&this.setState({alerts:[].concat((0,l.Z)(this.state.alerts),[{title:t,variant:"warning"}])}),this.setState({showImportModal:e})}},{key:"renderCollections",value:function(e,t){var n=t.count,a=t.params,r=t.updateParams;return 0===e.length?f().createElement(h.ei,{clearAllFilters:function(){S.q6.clearAllFilters({params:a,ignoredParams:["page","page_size","sort","view_type"],updateParams:r})}}):"list"===a.view_type?this.renderList(e):this.renderCards(e,{count:n,params:a,updateParams:r})}},{key:"renderCards",value:function(e,t){var n,a=this,l=t.count,o=t.params,c=t.updateParams;return f().createElement("div",{className:"hub-cards"},e.map((function(e,t){return f().createElement(h.zt,(0,r.Z)({key:t},e,{footer:a.renderSyncToogle(e.collection_version.name,e.collection_version.namespace),menu:a.renderMenu(!1,e),displaySignatures:a.context.featureFlags.display_signatures}))})),l>o.page_size*(null!==(n=o.page)&&void 0!==n?n:1)?f().createElement(h.xY,{onClick:function(){var e;return c(C(C({},o),{},{page:(null!==(e=o.page)&&void 0!==e?e:1)+1}))}}):null)}},{key:"handleControlClick",value:function(e){var t=this,n=e.collection_version.name;v.gu.setDeprecation(e).then((function(a){var r=(0,S.LL)(a.data.task);return(0,S.BA)(r).then((function(){var a=e.deprecated?d.ag._({id:"QKaTiY",values:{name:n}}):d.ag._({id:"BlYFt4",values:{name:n}});t.setState({alerts:[].concat((0,l.Z)(t.state.alerts),[{title:a,variant:"success"}])}),t.load()}))})).catch((function(a){var r=a.response,o=r.status,c=r.statusText;t.setState({alerts:[].concat((0,l.Z)(t.state.alerts),[{variant:"danger",title:e.deprecated?d.ag._({id:"5dhPcd",values:{name:n}}):d.ag._({id:"hEP0ZC",values:{name:n}}),description:(0,S.N3)(o,c)}])})}))}},{key:"renderMenu",value:function(e,t){var n=this,a=(0,this.context.hasPermission)("galaxy.upload_to_namespace"),r=function(e){return{addAlert:function(e){return n.addAlert(e)},collection:t,openModal:function(){return n.setState({deleteCollection:t,confirmDelete:!1,deleteAll:e})}}},l=f().createElement(h.bv,{collection:t,"data-cy":"collection-kebab",onDelete:r(!0),onDeprecate:function(){return n.handleControlClick(t)},onRemove:r(!1),onUploadVersion:e?null:function(){return n.checkUploadPrivilleges(t)},wrapper:e?null:function(e){var t=e.any,n=e.children;return t?f().createElement("span",null,n):f().createElement("span",{className:"hidden-menu-space"})}});return e?{uploadButton:a?f().createElement(p.Button,{onClick:function(){return n.checkUploadPrivilleges(t)},variant:"secondary"},d.ag._({id:"PHsJXN"})):null,dropdownMenu:l}:l}},{key:"renderSyncToogle",value:function(e,t){var n=this;return this.state.synclist?f().createElement(p.Switch,{id:t+"."+e,className:"sync-toggle",label:d.ag._({id:"Nu4DdT"}),isChecked:this.isCollectionSynced(e,t),onChange:function(){return n.toggleCollectionSync(e,t)}}):null}},{key:"checkUploadPrivilleges",value:function(e){var t=this,n=function(){t.setState({alerts:[].concat((0,l.Z)(t.state.alerts),[{title:d.ag._({id:"XoMS0d"}),variant:"warning"}])})};v.V$.get(e.collection_version.namespace,{include_related:"my_permissions"}).then((function(a){a.data.related_fields.my_permissions.includes("galaxy.upload_to_namespace")?t.setState({updateCollection:e,showImportModal:!0}):n()})).catch((function(){n()}))}},{key:"toggleCollectionSync",value:function(e,t){var n=this,a=C({},this.state.synclist),r=a.collections.findIndex((function(n){return n.name===e&&n.namespace===t}));r<0?a.collections.push({name:e,namespace:t}):a.collections.splice(r,1),v.vy.update(a.id,a).then((function(e){n.setState({synclist:e.data}),v.vy.curate(a.id).then((function(){return null}))}))}},{key:"isCollectionSynced",value:function(e,t){var n=this.state.synclist,a=n.collections.find((function(n){return n.name===e&&n.namespace===t}));return"include"===n.policy?!!a:!a}},{key:"renderList",value:function(e){var t=this;return f().createElement("div",{className:"list-container"},f().createElement("div",{className:"hub-list"},f().createElement(p.DataList,{className:"data-list","aria-label":d.ag._({id:"74Eard"})},e.map((function(e,n){return f().createElement(h.Op,(0,r.Z)({key:n,collection:e,displaySignatures:t.context.featureFlags.display_signatures,showNamespace:!0,synclistSwitch:t.renderSyncToogle(e.collection_version.name,e.collection_version.namespace)},t.renderMenu(!0,e)))})))))}},{key:"getSynclist",value:function(){var e=this;v.vy.list().then((function(t){1===t.data.meta.count?e.setState({synclist:t.data.data[0]}):console.error("my-synclist returned ".concat(t.data.meta.count," synclists"))}))}},{key:"queryCollections",value:function(){var e=this;this.setState({loading:!0},(function(){v.eq.list(C(C({},S.q6.getReduced(e.state.params,["view_type"])),{},{is_deprecated:!1,repository_label:"!hide_from_search",is_highest:!0})).then((function(t){e.setState({collections:t.data.data,count:t.data.meta.count,loading:!1})}))}))}},{key:"updateParams",get:function(){return S.q6.updateParamsMixin()}}]),t}(f().Component);const b=(0,S.EN)(k);k.contextType=_.I}}]);
//# sourceMappingURL=../sourcemaps/140.a58307c5c0a08b93e35409d1fa1dc62d.js.map