"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[811],{91811:(e,t,a)=>{a.r(t),a.d(t,{TaskListView:()=>y,default:()=>E});var n=a(42982),s=a(15671),r=a(43144),l=a(79340),i=a(82963),c=a(61120),u=a(62747),o=a(27693),d=a(11930),m=a(92950),p=a(62012),f=a(95517),g=a(48706),h=a(42807),_=a(61542),k=a(61647),T=a(29423),v=a(90005);var y=function(e){(0,l.Z)(y,e);var t,a,_=(t=y,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,c.Z)(t);if(a){var s=(0,c.Z)(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return(0,i.Z)(this,e)});function y(e){var t;(0,s.Z)(this,y),t=_.call(this,e);var a=T.q6.parseParamString(e.location.search,["page","page_size"]);return a.page_size||(a.page_size=10),a.sort||(a.sort="-pulp_created"),t.state={params:a,items:[],loading:!0,itemCount:0,alerts:[],cancelModalVisible:!1,selectedTask:null,unauthorised:!1,inputText:""},t}return(0,r.Z)(y,[{key:"componentDidMount",value:function(){var e=this.context,t=e.user,a=e.hasPermission;!t||t.is_anonymous?this.setState({loading:!1,unauthorised:!0}):this.queryTasks(),a("core.view_task")||this.addAlert(o.ag._("You do not have permission to view all tasks. Only tasks created by you are visible."),"info")}},{key:"render",value:function(){var e=this,t=this.state,a=t.params,n=t.itemCount,s=t.loading,r=t.items,l=t.alerts,i=t.cancelModalVisible,c=t.unauthorised,u=0===r.length&&!(0,T.vS)(a,["name__contains","state"]);return m.createElement(m.Fragment,null,m.createElement(g.UW,{alerts:l,closeAlert:function(t){return e.closeAlert(t)}}),i?this.renderCancelModal():null,m.createElement(g.UP,{title:o.ag._("Task Management")}),c?m.createElement(g.iA,null):u&&!s?m.createElement(g.vv,{title:o.ag._("No tasks yet"),description:o.ag._("Tasks will appear once created.")}):m.createElement(g.or,null,s?m.createElement(g.AW,null):m.createElement("section",{className:"body"},m.createElement("div",{className:"hub-list-toolbar"},m.createElement(d.Toolbar,null,m.createElement(d.ToolbarContent,null,m.createElement(d.ToolbarGroup,null,m.createElement(d.ToolbarItem,null,m.createElement(g.Kv,{inputText:this.state.inputText,onChange:function(t){return e.setState({inputText:t})},updateParams:function(t){return e.updateParams(t,(function(){return e.queryTasks()}))},params:a,filterConfig:[{id:"name__contains",title:o.ag._("Task name")},{id:"state",title:o.ag._("Status"),inputType:"select",options:[{id:"completed",title:o.ag._("Completed")},{id:"failed",title:o.ag._("Failed")},{id:"running",title:o.ag._("Running")},{id:"waiting",title:o.ag._("Waiting")}]}]}))))),m.createElement(g.tl,{params:a,updateParams:function(t){return e.updateParams(t,(function(){return e.queryTasks()}))},count:n,isTop:!0})),m.createElement("div",null,m.createElement(g.M$,{updateParams:function(t){e.updateParams(t,(function(){return e.queryTasks()})),e.setState({inputText:""})},params:a,ignoredParams:["page_size","page","sort","ordering"],niceNames:{name__contains:o.ag._("Task name"),state:o.ag._("Status")}})),s?m.createElement(g.AW,null):this.renderTable(a),m.createElement(g.tl,{params:a,updateParams:function(t){return e.updateParams(t,(function(){return e.queryTasks()}))},count:n}))))}},{key:"renderTable",value:function(e){var t=this,a=this.state.items;if(0===a.length)return m.createElement(g.ei,null);var n={headers:[{title:o.ag._("Task name"),type:"alpha",id:"name"},{title:o.ag._("Created on"),type:"numeric",id:"pulp_created"},{title:o.ag._("Started at"),type:"numeric",id:"started_at"},{title:o.ag._("Finished at"),type:"numeric",id:"finished_at"},{title:o.ag._("Status"),type:"alpha",id:"state"}]};return m.createElement("table",{"aria-label":o.ag._("Task list"),className:"hub-c-table-content pf-c-table"},m.createElement(g.h2,{options:n,params:e,updateParams:function(e){return t.updateParams(e,(function(){return t.queryTasks()}))}}),m.createElement("tbody",null,a.map((function(e,a){return t.renderTableRow(e,a)}))))}},{key:"renderTableRow",value:function(e,t){var a=e.name,n=e.state,s=e.pulp_created,r=e.started_at,l=e.finished_at,i=e.pulp_href,c=(0,v.L)(i);return m.createElement("tr",{key:t},m.createElement("td",null,m.createElement(p.Link,{to:(0,k.dI)(k.nB.taskDetail,{task:c})},m.createElement(g.u,{content:h.g.TASK_NAMES[a]&&o.ag._(h.g.TASK_NAMES[a])||a},a))),m.createElement("td",null,m.createElement(g.Id,{date:s})),m.createElement("td",null,m.createElement(g.Id,{date:r})),m.createElement("td",null,m.createElement(g.Id,{date:l})),m.createElement("td",null,m.createElement(g.Eg,{status:n})),m.createElement("td",null,this.cancelButton(n,e)))}},{key:"cancelButton",value:function(e,t){var a=this;switch(e){case"running":case"waiting":return m.createElement(d.Button,{variant:"secondary","aria-label":o.ag._("Delete"),key:"delete",onClick:function(){return a.setState({cancelModalVisible:!0,selectedTask:t})}},o.ag._("Stop task"))}}},{key:"renderCancelModal",value:function(){var e=this,t=h.g.TASK_NAMES[this.state.selectedTask.name]||this.state.selectedTask.name;return m.createElement(g.sm,{cancelAction:function(){return e.setState({cancelModalVisible:!1})},title:o.ag._("Stop task?"),confirmAction:function(){return e.selectedTask(e.state.selectedTask,t)},confirmButtonTitle:o.ag._("Yes, stop")},o.ag._("{name} will be cancelled.",{name:t}))}},{key:"selectedTask",value:function(e,t){var a=this;f.sb.patch((0,v.L)(e.pulp_href),{state:"canceled"}).then((function(){a.setState({loading:!0,selectedTask:null,cancelModalVisible:!1,alerts:[].concat((0,n.Z)(a.state.alerts),[{variant:"success",title:t,description:m.createElement(u.cC,{id:'Task "{name}" stopped successfully.',values:{name:t}})}])}),a.queryTasks()})).catch((function(e){var s=e.response,r=s.status,l=s.statusText;a.setState({loading:!0,cancelModalVisible:!1,alerts:[].concat((0,n.Z)(a.state.alerts),[{variant:"danger",title:o.ag._('Task "{name}" could not be stopped.',{name:t}),description:(0,T.N3)(r,l)}])})}))}},{key:"closeAlert",get:function(){return(0,g.NQ)("alerts")}},{key:"queryTasks",value:function(){var e=this;this.setState({loading:!0},(function(){f.sb.list(e.state.params).then((function(t){e.setState({items:t.data.results,itemCount:t.data.count,loading:!1})})).catch((function(t){var a=t.response,s=a.status,r=a.statusText;e.setState({loading:!1,items:[],itemCount:0,alerts:[].concat((0,n.Z)(e.state.alerts),[{variant:"danger",title:o.ag._("Tasks list could not be displayed."),description:(0,T.N3)(s,r)}])})}))}))}},{key:"addAlert",value:function(e,t,a){this.setState({alerts:[].concat((0,n.Z)(this.state.alerts),[{description:a,title:e,variant:t}])})}},{key:"updateParams",get:function(){return T.q6.updateParamsMixin()}}]),y}(m.Component);const E=(0,T.EN)(y);y.contextType=_.I}}]);
//# sourceMappingURL=../sourcemaps/811.279fbcee3b7fd229d9f227d7dc8ab211.js.map