"use strict";(self.webpackChunkansible_hub_ui=self.webpackChunkansible_hub_ui||[]).push([[8118],{48118:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(4942),a=n(14744),o=n(13855),l=n(92950),i=n.n(l),s=n(61811),u=n(45586),c=n(41315),p=n(61647),m=n(6640),d=n(92518),f=n(70885);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y=function(e){var t=e.item,n=e.actionContext,r=n.addAlert,a=n.state.params,s=n.hasPermission,b=n.user,y=(null==t?void 0:t.pulp_href)&&(0,d.LL)(t.pulp_href),g=(0,l.useState)(null==t?void 0:t.name),h=(0,f.Z)(g,2),_=h[0],O=h[1],E=(0,l.useState)(null),w=(0,f.Z)(E,2),P=w[0],j=w[1],S=(0,l.useState)(!1),R=(0,f.Z)(S,2),D=R[0],C=R[1],Z=(0,l.useState)(null),k=(0,f.Z)(Z,2),A=k[0],U=k[1],I=(0,l.useState)(null),x=(0,f.Z)(I,2),L=x[0],N=x[1],G=(0,l.useState)(null),T=(0,f.Z)(G,2),V=T[0],B=T[1],q=(0,l.useState)(null),F=(0,f.Z)(q,2),X=F[0],z=F[1],M=(0,l.useState)(null),W=(0,f.Z)(M,2),H=W[0],Y=W[1],K=function(){j(null),u.UX.myPermissions(y).then((function(e){var t=e.data.permissions;C((0,m.X0)({hasPermission:s,hasObjectPermission:function(e){return t.includes(e)},user:b})),u.UX.listRoles(y).then((function(e){var t,n=e.data.roles,r=[],a=v(n);try{for(a.s();!(t=a.n()).done;){var o,l=t.value,i=l.groups,s=l.role,u=v(i);try{var c=function(){var e=o.value,t=r.findIndex((function(t){return t.name===e}));-1==t?r.push({name:e,object_roles:[s]}):r[t].object_roles.push(s)};for(u.s();!(o=u.n()).done;)c()}catch(e){u.e(e)}finally{u.f()}}}catch(e){a.e(e)}finally{a.f()}O(_),j(r)})).catch((function(){j([])}))})).catch((function(){j([]),C(!1)}))},$=function(e){var t=e.roles,n=e.alertSuccess,a=e.alertFailure,o=e.stateUpdate;Promise.all(t).then((function(){r({title:n,variant:"success"}),K()})).catch((function(e){var t=e.response,n=t.status,o=t.statusText;r({title:a,variant:"danger",description:(0,d.N3)(n,o)})})).finally((function(){J(o)}))},J=function(e){Object.entries(e).forEach((function(e){var t=(0,f.Z)(e,2),n=t[0],r=t[1];switch(n){case"showGroupRemoveModal":N(r);break;case"showGroupSelectWizard":B(r);break;case"showRoleRemoveModal":z(r);break;case"showRoleSelectWizard":Y(r);break;default:console.error("updateProps",n,r)}}))};return(0,l.useEffect)(K,[t.pulp_href]),(0,l.useEffect)((function(){P&&(null!=a&&a.group?u.lO.list({name:a.group}).then((function(e){var t=e.data.data;U(P.find((function(e){return e.name===t[0].name})))})):U(null))}),[null==a?void 0:a.group,P]),i().createElement(c.yW,{addGroup:function(e,t){var n=t.map((function(t){return u.UX.addRole(y,{role:t.name,groups:[e.name]})}));$({roles:n,alertSuccess:o.ag._('Group "{0}" has been successfully added to "{name}".',{0:e.name,name:_}),alertFailure:o.ag._('Group "{0}" could not be added to "{name}".',{0:e.name,name:_}),stateUpdate:{showGroupSelectWizard:null}})},addRole:function(e,t){var n=t.map((function(t){return u.UX.addRole(y,{role:t.name,groups:[e.name]})}));$({roles:n,alertSuccess:o.ag._('Group "{0}" roles successfully updated in "{name}".',{0:e.name,name:_}),alertFailure:o.ag._('Group "{0}" roles could not be update in "{name}".',{0:e.name,name:_}),stateUpdate:{showRoleSelectWizard:null}})},canEditOwners:D,group:A,groups:P,name:_,pulpObjectType:"repositories/ansible/ansible",removeGroup:function(e){var t=e.object_roles.map((function(t){return u.UX.removeRole(y,{role:t,groups:[e.name]})}));$({roles:t,alertSuccess:o.ag._('Group "{0}" has been successfully removed from "{name}".',{0:e.name,name:_}),alertFailure:o.ag._('Group "{0}" could not be removed from "{name}".',{0:e.name,name:_}),stateUpdate:{showGroupRemoveModal:null}})},removeRole:function(e,t){var n=u.UX.removeRole(y,{role:e,groups:[t.name]});$({roles:[n],alertSuccess:o.ag._('Group "{0}" roles successfully updated in "{name}".',{0:t.name,name:_}),alertFailure:o.ag._('Group "{0}" roles could not be update in "{name}".',{0:t.name,name:_}),stateUpdate:{showRoleRemoveModal:null}})},selectRolesMessage:o.ag._("The selected roles will be added to this specific Ansible repository."),showGroupRemoveModal:L,showGroupSelectWizard:V,showRoleRemoveModal:X,showRoleSelectWizard:H,updateProps:J,urlPrefix:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:_})})},g=n(62012);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=function(e){var t=e.item,n=e.actionContext,r=n.addAlert,a=n.hasPermission,m=function(e){var n=_({},e.params);n.ordering=n.sort,delete n.sort;var r=(0,d.LL)(t.pulp_href);return u.eq.list(_({repository:r},n)).then((function(e){var t=e.data;return{data:{count:t.meta.count,results:t.data}}}))},v=(0,l.useState)({repository:t}),b=(0,f.Z)(v,2),y=b[0],h=b[1];return(0,l.useEffect)((function(){return h((function(e){return _(_({},e),{},{repository:t})}))}),[t]),i().createElement(c.qU,{actionContext:{addAlert:r,state:y,setState:h,query:m,hasPermission:a},defaultPageSize:10,defaultSort:"name",errorTitle:o.ag._("Collection versions could not be displayed."),filterConfig:[{id:"keywords",title:o.ag._("Keywords")},{id:"namespace",title:o.ag._("Namespace")}],headerActions:[s.Ub],listItemActions:[s.No],noDataButton:s.Ub.button,noDataDescription:o.ag._("Collection versions will appear once the collection is modified."),noDataTitle:o.ag._("No collection versions yet"),query:m,renderTableRow:function(e,t,n,r){var a=e.collection_version,o=a.name,l=a.namespace,s=a.version,u=a.description,m=r.map((function(t){return t.dropdownItem(e,n)}));return i().createElement("tr",{key:t},i().createElement("td",null,i().createElement(g.Link,{to:(0,p.dI)(p.nB.collection,{namespace:l,collection:o},{version:s})},l,".",o," v",s)),i().createElement("td",null,u),i().createElement(c.cT,{kebabItems:m}))},sortHeaders:[{title:o.ag._("Collection"),type:"none",id:"col1"},{title:o.ag._("Description"),type:"none",id:"col2"}],title:o.ag._("Collection versions")})},E=function(e){var t,n=e.item,r=(0,l.useState)(null),a=(0,f.Z)(r,2),s=a[0],m=a[1];return(0,l.useEffect)((function(){var e=n.remote&&(0,d.LL)(n.remote);e?u.GC.get(e).then((function(e){var t=e.data;return m(t)})):m(null)}),[n.remote]),i().createElement(c.PO,{fields:[{label:o.ag._("Repository name"),value:null==n?void 0:n.name},{label:o.ag._("Description"),value:(null==n?void 0:n.description)||o.ag._("None")},{label:o.ag._("Retained version count"),value:null!==(t=null==n?void 0:n.retain_repo_versions)&&void 0!==t?t:o.ag._("All")},{label:o.ag._("Distribution"),value:i().createElement(c.fM,{repositoryHref:n.pulp_href})},{label:o.ag._("Labels"),value:i().createElement(c.rT,{labels:null==n?void 0:n.pulp_labels})},{label:o.ag._("Private"),value:null!=n&&n.private?o.ag._("Yes"):o.ag._("No")},{label:o.ag._("Remote"),value:s?i().createElement(g.Link,{to:(0,p.dI)(p.nB.ansibleRemoteDetail,{name:s.name})},s.name):o.ag._("None")}]})},w=n(43144),P=n(15671),j=n(97326),S=n(79340),R=n(82963),D=n(61120),C=n(35356);function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=function(e){var t=e.href,n=e.addAlert,a=e.hasPermission,s=(0,l.useState)({}),m=(0,f.Z)(s,2),d=m[0],v=m[1];if(!t)return null;var b=function(e){return new(function(t){(0,S.Z)(l,t);var n,a,o=(n=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,D.Z)(n);if(a){var r=(0,D.Z)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,R.Z)(this,e)});function l(){var t;(0,P.Z)(this,l);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return t=o.call.apply(o,[this].concat(a)),(0,r.Z)((0,j.Z)(t),"useOrdering",!0),(0,r.Z)((0,j.Z)(t),"apiPath",e.replace("/api/automation-hub/pulp/api/v3/","")),t}return(0,w.Z)(l)}(u.jx))}(t),y=function(e){var t=e.params;return b.list(t)};return i().createElement(c.qU,{actionContext:{addAlert:n,state:d,setState:v,query:y,hasPermission:a},defaultPageSize:10,defaultSort:"name",errorTitle:o.ag._("Collection versions could not be displayed."),noDataDescription:o.ag._("No collection versions in this repository version."),noDataTitle:o.ag._("No collection versions yet"),query:y,renderTableRow:function(e){var t=e.manifest.collection_info,n=t.namespace,r=t.name,a=t.version,o=e.description;return i().createElement("tr",null,i().createElement("td",null,i().createElement(g.Link,{to:(0,p.dI)(p.nB.collection,{namespace:n,collection:r},{version:a})},n,".",r," v",a)),i().createElement("td",null,o))},sortHeaders:[{title:o.ag._("Collection"),type:"none",id:"col1"},{title:o.ag._("Description"),type:"none",id:"col2"}],title:o.ag._("Collection versions")})},U=function(e){var t=e.data;return Object.keys(t).length?i().createElement("table",{className:"pf-c-table"},i().createElement("tr",null,i().createElement("th",null,o.ag._("Count")),i().createElement("th",null,o.ag._("Pulp type"))),Object.entries(t).map((function(e){var t=(0,f.Z)(e,2),n=t[0],r=t[1];return i().createElement("tr",{key:n},i().createElement("td",null,r.count),i().createElement("th",null,n))}))):i().createElement(i().Fragment,null,o.ag._("None"))},I=function(e){var t=e.repositoryName,n=e.data;if(!n)return i().createElement(i().Fragment,null,o.ag._("None"));var r=n.split("/").at(-2);return i().createElement(g.Link,{to:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:t},{repositoryVersion:r,tab:"repository-versions"})},r)},x=function(e){var t,n,r,a=e.item,m=e.actionContext,v=m.addAlert,b=m.state,y=m.hasPermission,h=m.hasObjectPermission,_=(0,d.LL)(a.pulp_href),O=a.latest_version_href,E=a.name,w=function(e){var t=e.params;return u.UX.listVersions(_,t)},P=(0,l.useState)({}),j=(0,f.Z)(P,2),S=j[0],R=j[1],D=(0,l.useState)(null),Z=(0,f.Z)(D,2),x=Z[0],L=Z[1];return(0,l.useEffect)((function(){var e,t;b.params.repositoryVersion?(e={number:b.params.repositoryVersion},t=e.number,u.UX.listVersions(_,{number:t})).then((function(e){var t,n=e.data;null!=n&&null!==(t=n.results)&&void 0!==t&&t[0]||v({variant:"danger",title:o.ag._("Failed to find repository version")}),L(n.results[0])})):L(null)}),[b.params.repositoryVersion]),b.params.repositoryVersion?x?i().createElement(i().Fragment,null,i().createElement(c.PO,{fields:[{label:o.ag._("Version number"),value:x.number},{label:o.ag._("Created date"),value:i().createElement(c.Id,{date:x.pulp_created})},{label:o.ag._("Content added"),value:i().createElement(U,{data:null===(t=x.content_summary)||void 0===t?void 0:t.added})},{label:o.ag._("Content removed"),value:i().createElement(U,{data:null===(n=x.content_summary)||void 0===n?void 0:n.removed})},{label:o.ag._("Current content"),value:i().createElement(U,{data:null===(r=x.content_summary)||void 0===r?void 0:r.present})},{label:o.ag._("Base version"),value:i().createElement(I,{repositoryName:E,data:x.base_version})}]}),i().createElement("div",{className:"pf-c-page__main-section",style:{padding:"8px 0",margin:"24px -16px 0"}}),i().createElement(A,x.content_summary.present["ansible.collection_version"])):i().createElement(C.Spinner,{size:"md"}):i().createElement(c.qU,{actionContext:{addAlert:v,state:S,setState:R,query:w,hasPermission:y,hasObjectPermission:h},defaultPageSize:10,defaultSort:"-pulp_created",errorTitle:o.ag._("Repository versions could not be displayed."),filterConfig:null,listItemActions:[s.W],noDataButton:null,noDataDescription:o.ag._("Repository versions will appear once the repository is modified."),noDataTitle:o.ag._("No repository versions yet"),query:w,renderTableRow:function(e,t,n,r){var a=e.number,l=e.pulp_created,s=e.pulp_href,u=O===s,m=r.map((function(t){return t.dropdownItem(k(k({},e),{},{isLatest:u,repositoryName:E}),n)}));return i().createElement("tr",{key:t},i().createElement("td",null,i().createElement(g.Link,{to:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:E},{repositoryVersion:a,tab:"repository-versions"})},a),u?" "+o.ag._("(latest)"):null),i().createElement("td",null,i().createElement(c.Id,{date:l})),i().createElement(c.cT,{kebabItems:m}))},sortHeaders:[{title:o.ag._("Version number"),type:"numeric",id:"number"},{title:o.ag._("Created date"),type:"numeric",id:"pulp_created"}],title:o.ag._("Repository versions")})};function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=[{id:"details",name:o.ag._("Details")},{id:"access",name:o.ag._("Access")},{id:"collection-versions",name:o.ag._("Collection versions")},{id:"repository-versions",name:o.ag._("Versions")}];const T=(0,c.L9)({breadcrumbs:function(e){var t=e.name,n=e.tab,r=e.params,a=r.repositoryVersion,l=r.group;return[{url:(0,p.dI)(p.nB.ansibleRepositories),name:o.ag._("Repositories")},{url:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:t}),name:t},"repository-versions"===n.id&&a||"access"===n.id&&l?{url:(0,p.dI)(p.nB.ansibleRepositoryDetail,{name:t},{tab:n.id}),name:n.name}:null,"repository-versions"===n.id&&a?{name:o.ag._("Version {repositoryVersion}",{repositoryVersion:a})}:"access"===n.id&&l?{name:o.ag._("Group {group}",{group:l})}:{name:n.name}].filter(Boolean)},condition:m.fY,displayName:"AnsibleRepositoryDetail",errorTitle:o.ag._("Repository could not be displayed."),headerActions:[s.cv,s.hE,s.sO,s.e5],headerDetails:function(e){return i().createElement(i().Fragment,null,(null==e?void 0:e.last_sync_task)&&i().createElement("p",{className:"hub-m-truncated"},i().createElement(a.cC,{id:"Last updated from registry {0}",values:{0:(0,d.Fr)(e)}})," ",(0,d.Eb)(e)))},query:function(e){var t=e.name;return u.UX.list({name:t}).then((function(e){return e.data.results[0]})).then((function(e){return u.UX.myPermissions((0,d.LL)(e.pulp_href)).then((function(e){return e.data.permissions})).catch((function(e){return console.error(e),[]})).then((function(t){return N(N({},e),{},{my_permissions:t})}))}))},renderTab:function(e,t,n){return{details:i().createElement(E,{item:t,actionContext:n}),access:i().createElement(y,{item:t,actionContext:n}),"collection-versions":i().createElement(O,{item:t,actionContext:n}),"repository-versions":i().createElement(x,{item:t,actionContext:n})}[e]},tabs:G,tabUpdateParams:function(e){return delete e.repositoryVersion,delete e.group,e}})}}]);
//# sourceMappingURL=../sourcemaps/8118.03a7618a5b40f8b5df52ec4eb2f66a45.js.map