{"version":3,"file":"js/6401.ac8458c799a31eb0e6cb.js","mappings":"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","sources":["webpack:///./src/containers/ansible-remote/edit.tsx","webpack:///./src/permissions.ts"],"sourcesContent":["import { t } from '@lingui/macro';\nimport React from 'react';\nimport { AnsibleRemoteAPI, AnsibleRemoteType } from 'src/api';\nimport { Page, RemoteForm } from 'src/components';\nimport { Paths, formatPath } from 'src/paths';\nimport { canAddAnsibleRemote, canEditAnsibleRemote } from 'src/permissions';\nimport { parsePulpIDFromURL, taskAlert } from 'src/utilities';\n\nconst initialRemote: AnsibleRemoteType = {\n  name: '',\n  url: '',\n  ca_cert: null,\n  client_cert: null,\n  tls_validation: true,\n  proxy_url: null,\n  download_concurrency: null,\n  rate_limit: null,\n  requirements_file: null,\n  auth_url: null,\n  signed_only: false,\n\n  hidden_fields: [\n    'client_key',\n    'proxy_username',\n    'proxy_password',\n    'username',\n    'password',\n    'token',\n  ].map((name) => ({ name, is_set: false })),\n};\n\nconst AnsibleRemoteEdit = Page<AnsibleRemoteType>({\n  breadcrumbs: ({ name }) =>\n    [\n      { url: formatPath(Paths.ansibleRemotes), name: t`Remotes` },\n      name && { url: formatPath(Paths.ansibleRemoteDetail, { name }), name },\n      name ? { name: t`Edit` } : { name: t`Add` },\n    ].filter(Boolean),\n\n  condition: (context, item?) =>\n    canAddAnsibleRemote(context) || canEditAnsibleRemote(context, item),\n  displayName: 'AnsibleRemoteEdit',\n  errorTitle: t`Remote could not be displayed.`,\n  query: ({ name }) => {\n    return AnsibleRemoteAPI.list({ name })\n      .then(({ data: { results } }) => results[0])\n      .then((remote) => {\n        return AnsibleRemoteAPI.myPermissions(\n          parsePulpIDFromURL(remote.pulp_href),\n        )\n          .then(({ data: { permissions } }) => permissions)\n          .catch((e) => {\n            console.error(e);\n            return [];\n          })\n          .then((my_permissions) => ({ ...remote, my_permissions }));\n      });\n  },\n\n  title: ({ name }) => name || t`Add new remote`,\n  transformParams: ({ name, ...rest }) => ({\n    ...rest,\n    name: name !== '_' ? name : null,\n  }),\n\n  render: (item, { navigate, queueAlert, state, setState }) => {\n    if (!state.remoteToEdit) {\n      const remoteToEdit = {\n        ...initialRemote,\n        ...item,\n      };\n      setState({ remoteToEdit, errorMessages: {} });\n    }\n\n    const { remoteToEdit, errorMessages } = state;\n    if (!remoteToEdit) {\n      return null;\n    }\n\n    const saveRemote = () => {\n      const { remoteToEdit } = state;\n\n      const data = { ...remoteToEdit };\n\n      if (!item) {\n        // prevent \"This field may not be blank.\" when writing in and then deleting username/password/etc\n        // only when creating, edit diffs with item\n        Object.keys(data).forEach((k) => {\n          if (data[k] === '' || data[k] == null) {\n            delete data[k];\n          }\n        });\n\n        delete data.hidden_fields;\n      }\n\n      delete data.my_permissions;\n\n      // api requires traling slash, fix the trivial case\n      if (data.url && !data.url.includes('?') && !data.url.endsWith('/')) {\n        data.url += '/';\n      }\n\n      const promise = !item\n        ? AnsibleRemoteAPI.create(data)\n        : AnsibleRemoteAPI.smartUpdate(\n            parsePulpIDFromURL(item.pulp_href),\n            data,\n            item,\n          );\n\n      promise\n        .then(({ data: task }) => {\n          setState({\n            errorMessages: {},\n            remoteToEdit: undefined,\n          });\n\n          queueAlert(\n            item\n              ? taskAlert(task, t`Update started for remote ${data.name}`)\n              : {\n                  variant: 'success',\n                  title: t`Successfully created remote ${data.name}`,\n                },\n          );\n\n          navigate(\n            formatPath(Paths.ansibleRemoteDetail, {\n              name: data.name,\n            }),\n          );\n        })\n        .catch(({ response: { data } }) =>\n          setState({\n            errorMessages: {\n              __nofield: data.non_field_errors || data.detail,\n              ...data,\n            },\n          }),\n        );\n    };\n\n    const closeModal = () => {\n      setState({ errorMessages: {}, remoteToEdit: undefined });\n      navigate(\n        item\n          ? formatPath(Paths.ansibleRemoteDetail, {\n              name: item.name,\n            })\n          : formatPath(Paths.ansibleRemotes),\n      );\n    };\n\n    return (\n      <RemoteForm\n        allowEditName={!item}\n        remote={remoteToEdit}\n        updateRemote={(r) => setState({ remoteToEdit: r })}\n        remoteType='ansible-remote'\n        showMain={true}\n        saveRemote={saveRemote}\n        errorMessages={errorMessages}\n        closeModal={closeModal}\n      />\n    );\n  },\n});\n\nexport default AnsibleRemoteEdit;\n","import { FeatureFlagsType, SettingsType, UserType } from 'src/api';\n\nexport type PermissionContextType = (\n  o: {\n    featureFlags: FeatureFlagsType;\n    settings?: SettingsType;\n    user: UserType;\n    hasPermission: (string) => boolean;\n    hasObjectPermission?: (string, item?) => boolean;\n  },\n  item?,\n) => boolean;\n\nexport const isLoggedIn: PermissionContextType = ({ user }) =>\n  user && !user.is_anonymous;\n\nconst has_model_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, user }) =>\n    hasPermission(permission) || user?.is_superuser;\n\nconst has_model_or_obj_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, hasObjectPermission, user }, item?) =>\n    hasPermission(permission) ||\n    hasObjectPermission?.(permission, item) ||\n    user?.is_superuser;\n\n// Ansible Remotes\nexport const canAddAnsibleRemote = has_model_perms(\n  'ansible.add_collectionremote',\n);\nexport const canDeleteAnsibleRemote = has_model_or_obj_perms(\n  'ansible.delete_collectionremote',\n);\nexport const canEditAnsibleRemote = has_model_or_obj_perms(\n  'ansible.change_collectionremote',\n);\nexport const canViewAnsibleRemotes = has_model_or_obj_perms(\n  'ansible.view_collectionremote',\n);\nexport const canEditAnsibleRemoteAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_collectionremote',\n);\n\n// Ansible Repositories\nexport const canAddAnsibleRepository = has_model_perms(\n  'ansible.add_ansiblerepository',\n);\nexport const canDeleteAnsibleRepository = has_model_or_obj_perms(\n  'ansible.delete_ansiblerepository',\n);\nexport const canEditAnsibleRepository = has_model_or_obj_perms(\n  'ansible.change_ansiblerepository',\n);\nexport const canSyncAnsibleRepository = canEditAnsibleRepository;\n// everybody can list/view, not has_model_or_obj_perms('ansible.view_ansiblerepository'); under feature flag\nexport const canViewAnsibleRepositories = ({ user, featureFlags }) =>\n  user && featureFlags?.display_repositories;\nexport const canEditAnsibleRepositoryAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_ansiblerepository',\n);\n\n// Ansible Repository Versions\n// simulating has_repository_model_or_obj_perms by passing in repository as item\nexport const canRevertAnsibleRepositoryVersion = canEditAnsibleRepository;\n"],"names":["initialRemote","name","url","ca_cert","client_cert","tls_validation","proxy_url","download_concurrency","rate_limit","requirements_file","auth_url","signed_only","hidden_fields","map","is_set","Page","breadcrumbs","_ref","formatPath","Paths","ansibleRemotes","i18n","_","ansibleRemoteDetail","filter","Boolean","condition","context","item","canAddAnsibleRemote","canEditAnsibleRemote","displayName","errorTitle","query","_ref2","AnsibleRemoteAPI","list","then","_ref3","data","results","remote","myPermissions","parsePulpIDFromURL","pulp_href","_ref4","permissions","e","console","error","my_permissions","_objectSpread","title","_ref5","transformParams","_ref6","_objectWithoutProperties","_excluded","render","_ref7","navigate","queueAlert","state","setState","remoteToEdit","errorMessages","React","RemoteForm","allowEditName","updateRemote","r","remoteType","showMain","saveRemote","Object","keys","forEach","k","includes","endsWith","smartUpdate","create","_ref8","task","undefined","taskAlert","variant","_ref9","response","__nofield","non_field_errors","detail","closeModal","has_model_perms","permission","hasPermission","user","is_superuser","has_model_or_obj_perms","hasObjectPermission","canDeleteAnsibleRemote","canViewAnsibleRemotes","canEditAnsibleRemoteAccess","canAddAnsibleRepository","canDeleteAnsibleRepository","canEditAnsibleRepository","canSyncAnsibleRepository","canViewAnsibleRepositories","featureFlags","display_repositories","canEditAnsibleRepositoryAccess","canRevertAnsibleRepositoryVersion"],"sourceRoot":""}