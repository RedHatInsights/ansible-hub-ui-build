{"version":3,"file":"js/7545.99ec2fccc00aa747b711.js","mappings":"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","sources":["webpack:///./src/containers/ansible-repository/edit.tsx","webpack:///./src/permissions.ts"],"sourcesContent":["import { msg, t } from '@lingui/macro';\nimport React from 'react';\nimport {\n  AnsibleDistributionAPI,\n  AnsibleRepositoryAPI,\n  AnsibleRepositoryType,\n} from 'src/api';\nimport { AnsibleRepositoryForm, Page } from 'src/components';\nimport { Paths, formatPath } from 'src/paths';\nimport {\n  canAddAnsibleRepository,\n  canEditAnsibleRepository,\n} from 'src/permissions';\nimport { parsePulpIDFromURL, taskAlert } from 'src/utilities';\n\nconst initialRepository: AnsibleRepositoryType = {\n  name: '',\n  description: '',\n  retain_repo_versions: 1,\n  pulp_labels: {},\n  remote: null,\n};\n\nconst AnsibleRepositoryEdit = Page<AnsibleRepositoryType>({\n  breadcrumbs: ({ name }) =>\n    [\n      { url: formatPath(Paths.ansibleRepositories), name: t`Repositories` },\n      name && {\n        url: formatPath(Paths.ansibleRepositoryDetail, { name }),\n        name,\n      },\n      name ? { name: t`Edit` } : { name: t`Add` },\n    ].filter(Boolean),\n\n  condition: (context, item?) =>\n    canAddAnsibleRepository(context) || canEditAnsibleRepository(context, item),\n  displayName: 'AnsibleRepositoryEdit',\n  errorTitle: msg`Repository could not be displayed.`,\n  listUrl: formatPath(Paths.ansibleRepositories),\n  query: ({ name }) => {\n    return AnsibleRepositoryAPI.list({ name })\n      .then(({ data: { results } }) => results[0])\n      .then((repository) => {\n        return AnsibleRepositoryAPI.myPermissions(\n          parsePulpIDFromURL(repository.pulp_href),\n        )\n          .then(({ data: { permissions } }) => permissions)\n          .catch((e) => {\n            console.error(e);\n            return [];\n          })\n          .then((my_permissions) => ({ ...repository, my_permissions }));\n      });\n  },\n\n  title: ({ name }) => name || t`Add new repository`,\n  transformParams: ({ name, ...rest }) => ({\n    ...rest,\n    name: name !== '_' ? name : null,\n  }),\n\n  render: (item, { navigate, queueAlert, state, setState }) => {\n    if (!state.repositoryToEdit) {\n      const repositoryToEdit = {\n        ...initialRepository,\n        ...item,\n      };\n      setState({ repositoryToEdit, errorMessages: {} });\n    }\n\n    const { repositoryToEdit, errorMessages } = state;\n    if (!repositoryToEdit) {\n      return null;\n    }\n\n    const saveRepository = ({\n      createDistribution,\n      hideFromSearch,\n      pipeline,\n    }) => {\n      const { repositoryToEdit } = state;\n\n      const data = { ...repositoryToEdit };\n\n      // prevent \"This field may not be blank.\" for nullable fields\n      Object.keys(data).forEach((k) => {\n        if (data[k] === '') {\n          data[k] = null;\n        }\n      });\n\n      if (item) {\n        delete data.last_sync_task;\n        delete data.last_synced_metadata_time;\n        delete data.latest_version_href;\n        delete data.pulp_created;\n        delete data.pulp_href;\n        delete data.versions_href;\n      }\n\n      delete data.my_permissions;\n\n      data.pulp_labels ||= {};\n      if (hideFromSearch) {\n        data.pulp_labels.hide_from_search = '';\n      } else {\n        delete data.pulp_labels.hide_from_search;\n      }\n      if (pipeline) {\n        data.pulp_labels.pipeline = pipeline;\n      } else {\n        delete data.pulp_labels.pipeline;\n      }\n\n      let promise = !item\n        ? AnsibleRepositoryAPI.create(data).then(({ data: newData }) => {\n            queueAlert({\n              variant: 'success',\n              title: t`Successfully created repository ${data.name}`,\n            });\n\n            return newData.pulp_href;\n          })\n        : AnsibleRepositoryAPI.update(\n            parsePulpIDFromURL(item.pulp_href),\n            data,\n          ).then(({ data: task }) => {\n            queueAlert(\n              taskAlert(task, t`Update started for repository ${data.name}`),\n            );\n\n            return item.pulp_href;\n          });\n\n      if (createDistribution) {\n        // only alphanumerics, slashes, underscores and dashes are allowed in base_path, transform anything else to _\n        const basePathTransform = (name) =>\n          name.replaceAll(/[^-a-zA-Z0-9_/]/g, '_');\n        let distributionName = data.name;\n\n        promise = promise\n          .then((pulp_href) =>\n            AnsibleDistributionAPI.create({\n              name: distributionName,\n              base_path: basePathTransform(distributionName),\n              repository: pulp_href,\n            }).catch(() => {\n              // if distribution already exists, try a numeric suffix to name & base_path\n              distributionName =\n                data.name + Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\n              return AnsibleDistributionAPI.create({\n                name: distributionName,\n                base_path: basePathTransform(distributionName),\n                repository: pulp_href,\n              });\n            }),\n          )\n          .then(({ data: task }) =>\n            queueAlert(\n              taskAlert(\n                task,\n                t`Creation started for distribution ${distributionName}`,\n              ),\n            ),\n          );\n      }\n\n      promise\n        .then(() => {\n          setState({\n            errorMessages: {},\n            repositoryToEdit: undefined,\n          });\n\n          navigate(\n            formatPath(Paths.ansibleRepositoryDetail, {\n              name: data.name,\n            }),\n          );\n        })\n        .catch(({ response: { data } }) =>\n          setState({\n            errorMessages: {\n              __nofield: data.non_field_errors || data.detail,\n              ...data,\n            },\n          }),\n        );\n    };\n\n    const closeModal = () => {\n      setState({ errorMessages: {}, repositoryToEdit: undefined });\n      navigate(\n        item\n          ? formatPath(Paths.ansibleRepositoryDetail, {\n              name: item.name,\n            })\n          : formatPath(Paths.ansibleRepositories),\n      );\n    };\n\n    return (\n      <AnsibleRepositoryForm\n        allowEditName={!item}\n        errorMessages={errorMessages}\n        onCancel={closeModal}\n        onSave={saveRepository}\n        repository={repositoryToEdit}\n        updateRepository={(r) => setState({ repositoryToEdit: r })}\n      />\n    );\n  },\n});\n\nexport default AnsibleRepositoryEdit;\n","import { FeatureFlagsType, SettingsType, UserType } from 'src/api';\n\nexport type PermissionContextType = (\n  o: {\n    featureFlags: FeatureFlagsType;\n    settings?: SettingsType;\n    user: UserType;\n    hasPermission: (string) => boolean;\n    hasObjectPermission?: (string, item?) => boolean;\n  },\n  item?,\n) => boolean;\n\nexport const isLoggedIn: PermissionContextType = ({ user }) =>\n  user && !user.is_anonymous;\n\nconst has_model_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, user }) =>\n    hasPermission(permission) || user?.is_superuser;\n\nconst has_model_or_obj_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, hasObjectPermission, user }, item?) =>\n    hasPermission(permission) ||\n    hasObjectPermission?.(permission, item) ||\n    user?.is_superuser;\n\n// Ansible Remotes\nexport const canAddAnsibleRemote = has_model_perms(\n  'ansible.add_collectionremote',\n);\nexport const canDeleteAnsibleRemote = has_model_or_obj_perms(\n  'ansible.delete_collectionremote',\n);\nexport const canEditAnsibleRemote = has_model_or_obj_perms(\n  'ansible.change_collectionremote',\n);\nexport const canViewAnsibleRemotes = has_model_or_obj_perms(\n  'ansible.view_collectionremote',\n);\nexport const canEditAnsibleRemoteAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_collectionremote',\n);\n\n// Ansible Repositories\nexport const canAddAnsibleRepository = has_model_perms(\n  'ansible.add_ansiblerepository',\n);\nexport const canDeleteAnsibleRepository = has_model_or_obj_perms(\n  'ansible.delete_ansiblerepository',\n);\nexport const canEditAnsibleRepository = has_model_or_obj_perms(\n  'ansible.change_ansiblerepository',\n);\nexport const canSyncAnsibleRepository = canEditAnsibleRepository;\n// everybody can list/view, not has_model_or_obj_perms('ansible.view_ansiblerepository'); under feature flag\nexport const canViewAnsibleRepositories = ({ user, featureFlags }) =>\n  user && featureFlags?.display_repositories;\nexport const canEditAnsibleRepositoryAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_ansiblerepository',\n);\n\n// Ansible Repository Versions\n// simulating has_repository_model_or_obj_perms by passing in repository as item\nexport const canRevertAnsibleRepositoryVersion = canEditAnsibleRepository;\n"],"names":["initialRepository","name","description","retain_repo_versions","pulp_labels","remote","Page","breadcrumbs","_ref","url","formatPath","Paths","ansibleRepositories","i18n","_","id","ansibleRepositoryDetail","filter","Boolean","condition","context","item","canAddAnsibleRepository","canEditAnsibleRepository","displayName","errorTitle","listUrl","query","_ref2","AnsibleRepositoryAPI","list","then","_ref3","data","results","repository","myPermissions","parsePulpIDFromURL","pulp_href","_ref4","permissions","e","console","error","my_permissions","_objectSpread","title","_ref5","transformParams","_ref6","_objectWithoutProperties","_excluded","render","_ref7","navigate","queueAlert","state","setState","repositoryToEdit","errorMessages","React","AnsibleRepositoryForm","allowEditName","onCancel","undefined","onSave","_ref8","createDistribution","hideFromSearch","pipeline","Object","keys","forEach","k","last_sync_task","last_synced_metadata_time","latest_version_href","pulp_created","versions_href","hide_from_search","promise","update","_ref10","task","taskAlert","values","create","_ref9","newData","variant","basePathTransform","replaceAll","distributionName","AnsibleDistributionAPI","base_path","Math","floor","random","Number","MAX_SAFE_INTEGER","_ref11","_ref12","response","__nofield","non_field_errors","detail","updateRepository","r","has_model_perms","permission","hasPermission","user","is_superuser","has_model_or_obj_perms","hasObjectPermission","canAddAnsibleRemote","canDeleteAnsibleRemote","canEditAnsibleRemote","canViewAnsibleRemotes","canEditAnsibleRemoteAccess","canDeleteAnsibleRepository","canSyncAnsibleRepository","canViewAnsibleRepositories","featureFlags","display_repositories","canEditAnsibleRepositoryAccess","canRevertAnsibleRepositoryVersion"],"sourceRoot":""}