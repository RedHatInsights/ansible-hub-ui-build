{"version":3,"file":"js/6401.ab833919c7b155b3af26.js","mappings":"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","sources":["webpack:///./src/containers/ansible-remote/edit.tsx","webpack:///./src/permissions.ts"],"sourcesContent":["import { t } from '@lingui/macro';\nimport React from 'react';\nimport { AnsibleRemoteAPI, AnsibleRemoteType } from 'src/api';\nimport { Page, RemoteForm } from 'src/components';\nimport { Paths, formatPath } from 'src/paths';\nimport { canAddAnsibleRemote, canEditAnsibleRemote } from 'src/permissions';\nimport { parsePulpIDFromURL, taskAlert } from 'src/utilities';\n\nconst initialRemote: AnsibleRemoteType = {\n  name: '',\n  url: '',\n  ca_cert: null,\n  client_cert: null,\n  tls_validation: true,\n  proxy_url: null,\n  download_concurrency: null,\n  rate_limit: null,\n  requirements_file: null,\n  auth_url: null,\n  signed_only: false,\n\n  hidden_fields: [\n    'client_key',\n    'proxy_username',\n    'proxy_password',\n    'username',\n    'password',\n    'token',\n  ].map((name) => ({ name, is_set: false })),\n};\n\nconst AnsibleRemoteEdit = Page<AnsibleRemoteType>({\n  breadcrumbs: ({ name }) =>\n    [\n      { url: formatPath(Paths.ansibleRemotes), name: t`Remotes` },\n      name && { url: formatPath(Paths.ansibleRemoteDetail, { name }), name },\n      name ? { name: t`Edit` } : { name: t`Add` },\n    ].filter(Boolean),\n\n  condition: (context, item?) =>\n    canAddAnsibleRemote(context) || canEditAnsibleRemote(context, item),\n  displayName: 'AnsibleRemoteEdit',\n  errorTitle: t`Remote could not be displayed.`,\n  query: ({ name }) => {\n    return AnsibleRemoteAPI.list({ name })\n      .then(({ data: { results } }) => results[0])\n      .then((remote) => {\n        return AnsibleRemoteAPI.myPermissions(\n          parsePulpIDFromURL(remote.pulp_href),\n        )\n          .then(({ data: { permissions } }) => permissions)\n          .catch((e) => {\n            console.error(e);\n            return [];\n          })\n          .then((my_permissions) => ({ ...remote, my_permissions }));\n      });\n  },\n\n  title: ({ name }) => name || t`Add new remote`,\n  transformParams: ({ name, ...rest }) => ({\n    ...rest,\n    name: name !== '_' ? name : null,\n  }),\n\n  render: (item, { navigate, queueAlert, state, setState }) => {\n    if (!state.remoteToEdit) {\n      const remoteToEdit = {\n        ...initialRemote,\n        ...item,\n      };\n      setState({ remoteToEdit, errorMessages: {} });\n    }\n\n    const { remoteToEdit, errorMessages } = state;\n    if (!remoteToEdit) {\n      return null;\n    }\n\n    const saveRemote = () => {\n      const { remoteToEdit } = state;\n\n      const data = { ...remoteToEdit };\n\n      if (!item) {\n        // prevent \"This field may not be blank.\" when writing in and then deleting username/password/etc\n        // only when creating, edit diffs with item\n        Object.keys(data).forEach((k) => {\n          if (data[k] === '' || data[k] == null) {\n            delete data[k];\n          }\n        });\n\n        delete data.hidden_fields;\n      }\n\n      delete data.my_permissions;\n\n      // api requires traling slash, fix the trivial case\n      if (data.url && !data.url.includes('?') && !data.url.endsWith('/')) {\n        data.url += '/';\n      }\n\n      const promise = !item\n        ? AnsibleRemoteAPI.create(data)\n        : AnsibleRemoteAPI.smartUpdate(\n            parsePulpIDFromURL(item.pulp_href),\n            data,\n            item,\n          );\n\n      promise\n        .then(({ data: task }) => {\n          setState({\n            errorMessages: {},\n            remoteToEdit: undefined,\n          });\n\n          queueAlert(\n            item\n              ? taskAlert(task, t`Update started for remote ${data.name}`)\n              : {\n                  variant: 'success',\n                  title: t`Successfully created remote ${data.name}`,\n                },\n          );\n\n          navigate(\n            formatPath(Paths.ansibleRemoteDetail, {\n              name: data.name,\n            }),\n          );\n        })\n        .catch(({ response: { data } }) =>\n          setState({\n            errorMessages: {\n              __nofield: data.non_field_errors || data.detail,\n              ...data,\n            },\n          }),\n        );\n    };\n\n    const closeModal = () => {\n      setState({ errorMessages: {}, remoteToEdit: undefined });\n      navigate(\n        item\n          ? formatPath(Paths.ansibleRemoteDetail, {\n              name: item.name,\n            })\n          : formatPath(Paths.ansibleRemotes),\n      );\n    };\n\n    return (\n      <RemoteForm\n        allowEditName={!item}\n        remote={remoteToEdit}\n        updateRemote={(r) => setState({ remoteToEdit: r })}\n        remoteType='ansible-remote'\n        showMain={true}\n        saveRemote={saveRemote}\n        errorMessages={errorMessages}\n        closeModal={closeModal}\n      />\n    );\n  },\n});\n\nexport default AnsibleRemoteEdit;\n","import { FeatureFlagsType, SettingsType, UserType } from 'src/api';\n\nexport type PermissionContextType = (\n  o: {\n    featureFlags?: FeatureFlagsType;\n    settings?: SettingsType;\n    user: UserType;\n    hasPermission: (string) => boolean;\n    hasObjectPermission?: (string, item?) => boolean;\n  },\n  item?,\n) => boolean;\n\nexport const isLoggedIn: PermissionContextType = ({ user }) =>\n  user && !user.is_anonymous;\n\nconst has_model_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, user }) =>\n    hasPermission(permission) || user?.is_superuser;\n\nconst has_model_or_obj_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, hasObjectPermission, user }, item?) =>\n    hasPermission(permission) ||\n    hasObjectPermission?.(permission, item) ||\n    user?.is_superuser;\n\n// Ansible Remotes\nexport const canAddAnsibleRemote = has_model_perms(\n  'ansible.add_collectionremote',\n);\nexport const canDeleteAnsibleRemote = has_model_or_obj_perms(\n  'ansible.delete_collectionremote',\n);\nexport const canEditAnsibleRemote = has_model_or_obj_perms(\n  'ansible.change_collectionremote',\n);\nexport const canViewAnsibleRemotes = has_model_or_obj_perms(\n  'ansible.view_collectionremote',\n);\nexport const canEditAnsibleRemoteAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_collectionremote',\n);\n\n// Ansible Repositories\nexport const canAddAnsibleRepository = has_model_perms(\n  'ansible.add_ansiblerepository',\n);\nexport const canDeleteAnsibleRepository = has_model_or_obj_perms(\n  'ansible.delete_ansiblerepository',\n);\nexport const canEditAnsibleRepository = has_model_or_obj_perms(\n  'ansible.change_ansiblerepository',\n);\nexport const canSyncAnsibleRepository = canEditAnsibleRepository;\n// everybody can list/view, not has_model_or_obj_perms('ansible.view_ansiblerepository')\nexport const canViewAnsibleRepositories = isLoggedIn;\nexport const canEditAnsibleRepositoryAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_ansiblerepository',\n);\n\n// Ansible Repository Versions\n// simulating has_repository_model_or_obj_perms by passing in repository as item\nexport const canRevertAnsibleRepositoryVersion = canEditAnsibleRepository;\n"],"names":["initialRemote","name","url","ca_cert","client_cert","tls_validation","proxy_url","download_concurrency","rate_limit","requirements_file","auth_url","signed_only","hidden_fields","map","is_set","Page","breadcrumbs","_ref","formatPath","Paths","i18n","filter","Boolean","condition","context","item","canAddAnsibleRemote","canEditAnsibleRemote","displayName","errorTitle","query","_ref2","AnsibleRemoteAPI","then","_ref3","data","results","remote","parsePulpIDFromURL","pulp_href","_ref4","permissions","e","console","error","my_permissions","_objectSpread","title","_ref5","transformParams","_ref6","_objectWithoutProperties","_excluded","render","_ref7","navigate","queueAlert","state","setState","remoteToEdit","errorMessages","React","RemoteForm","allowEditName","updateRemote","r","remoteType","showMain","saveRemote","Object","keys","forEach","k","includes","endsWith","_ref8","task","undefined","taskAlert","variant","_ref9","response","__nofield","non_field_errors","detail","closeModal","has_model_perms","permission","hasPermission","user","is_superuser","has_model_or_obj_perms","hasObjectPermission","canDeleteAnsibleRemote","canViewAnsibleRemotes","canEditAnsibleRemoteAccess","canAddAnsibleRepository","canDeleteAnsibleRepository","canEditAnsibleRepository","canSyncAnsibleRepository","canViewAnsibleRepositories","is_anonymous","canEditAnsibleRepositoryAccess","canRevertAnsibleRepositoryVersion"],"sourceRoot":""}