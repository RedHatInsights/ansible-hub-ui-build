{"version":3,"file":"js/search.1650849528879.6c72d4620054ab4c4b61.js","mappings":"+5BA4CMA,EAAAA,SAAAA,I,2bAGJ,WAAYC,GAAO,sBACjB,cAAMA,GAEN,IAAMC,EAASC,EAAAA,EAAAA,iBAA6BF,EAAMG,SAASC,OAAQ,CACjE,OACA,cALe,OAQZH,EAAM,YACTA,EAAM,UAAgBI,EAAAA,EAAAA,wBAKnBJ,EAAM,YACTA,EAAM,UAAgBK,aAAaC,QACjCF,EAAAA,EAAAA,6BAIJ,EAAKG,MAAQ,CACXC,YAAa,GACbR,OAAQA,EACRS,gBAAiB,EACjBC,SAAS,EACTC,cAAUC,GAzBK,E,gDA6BnB,WACEC,KAAKC,mBAEDC,aAAoBX,EAAAA,EAAAA,0BACtBS,KAAKG,gB,oBAIT,WAAS,WACP,EAA0DH,KAAKN,MAAvDG,EAAR,EAAQA,QAASF,EAAjB,EAAiBA,YAAaR,EAA9B,EAA8BA,OAAQS,EAAtC,EAAsCA,gBAChCQ,EACmB,IAAvBT,EAAYU,UACXC,EAAAA,EAAAA,IAAYnB,EAAQ,CAAC,WAAY,OAAQ,eAEtCoB,EAAe,SAACC,GAAD,OACnB,EAAKD,aAAaC,GAAG,kBAAM,EAAKP,uBAElC,OACE,uBAAKQ,UAAU,eACb,gBAAC,KAAD,CACEA,UAAU,SACVC,MAAO,sBACPC,gBACE,gBAAC,KAAD,CACEC,aAAcZ,KAAKa,QAAQD,aAC3BE,KAAMC,EAAAA,GAAAA,iBAIRX,GACA,uBAAKK,UAAU,uBACb,uBAAKA,UAAU,WACb,gBAAC,KAAD,CACEO,cAAe,CAAC,OAAQ,YAAa,OAAQ,aAC7C7B,OAAQA,EACRoB,aAAcA,IAGhB,uBAAKE,UAAU,4BACb,uBAAKA,UAAU,sBACb,gBAAC,KAAD,CACEQ,KAAK,KACL9B,OAAQA,EACRoB,aAAc,SAACC,GAAD,OACZ,EAAKD,aAAaC,GAAG,kBAMnBhB,aAAa0B,QACX3B,EAAAA,EAAAA,2BACA,EAAKG,MAAMP,OAAOgC,kBAO5B,gBAAC,KAAD,CACEhC,OAAQA,EACRoB,aAAcA,EACda,MAAOxB,EACPyB,eAAgB9B,EAAAA,EAAAA,gCAChB+B,OAAK,QAOhBzB,EACC,gBAAC,KAAD,MACEO,EACF,gBAAC,KAAD,CACEM,MAAO,6BACPa,YAAa,kDAGf,gBAAC,WAAD,KACE,2BAASd,UAAU,wBAChBT,KAAKwB,kBAAkB7B,EAAaR,EAAQoB,IAE/C,2BAASE,UAAU,UACjB,gBAAC,KAAD,CACEtB,OAAQA,EACRoB,aAAc,SAACC,GAAD,OACZ,EAAKD,aAAaC,GAAG,kBAAM,EAAKP,uBAElCoB,eAAgB9B,EAAAA,EAAAA,gCAChB6B,MAAOxB,S,+BASrB,SAA0BD,EAAaR,EAAQoB,GAC7C,OAA2B,IAAvBZ,EAAYU,OAEZ,gBAAC,KAAD,CACEoB,gBAAiB,WACfrC,EAAAA,EAAAA,gBAA4B,CAC1BD,OAAAA,EACA6B,cAAe,CAAC,OAAQ,YAAa,OAAQ,aAC7CT,aAAAA,OAMe,SAArBpB,EAAOgC,UACFnB,KAAK0B,WAAW/B,GAEhBK,KAAK2B,YAAYhC,K,yBAI5B,SAAoBA,GAAa,WAC/B,OACE,uBAAKc,UAAU,SACZd,EAAYiC,KAAI,SAACC,GAChB,OACE,gBAAC,MAAD,QACEpB,UAAU,OACVqB,IAAKD,EAAEE,IACHF,EAHN,CAIEG,OAAQ,EAAKC,iBAAiBJ,EAAEK,KAAML,EAAEM,UAAUD,MAClDE,KAAM,EAAKvB,QAAQD,sB,8BAQ/B,SAAyBsB,EAAcC,GAAoC,WAEzE,OADqBnC,KAAKN,MAAlBI,SAKN,gBAAC,EAAAuC,OAAD,CACEN,GAAII,EAAY,IAAMD,EACtBzB,UAAU,cACV6B,MAAO,eACPC,UAAWvC,KAAKwC,mBAAmBN,EAAMC,GACzCM,SAAU,kBAAM,EAAKC,qBAAqBR,EAAMC,MAR3C,O,kCAaX,SAA6BD,EAAcC,GAAmB,WACtDrC,EAAW,EAAH,GAAQE,KAAKN,MAAMI,UAE3B6C,EAAW7C,EAASH,YAAYiD,WACpC,SAACC,GAAD,OAAQA,EAAGX,OAASA,GAAQW,EAAGV,YAAcA,KAG3CQ,EAAW,EACb7C,EAASH,YAAYmD,KAAK,CAAEZ,KAAMA,EAAMC,UAAWA,IAEnDrC,EAASH,YAAYoD,OAAOJ,EAAU,GAGxCK,EAAAA,GAAAA,OAAqBlD,EAASiC,GAAIjC,GAAUmD,MAAK,SAACC,GAChD,EAAKC,SAAS,CAAErD,SAAUoD,EAASE,OACnCJ,EAAAA,GAAAA,OAAqBlD,EAASiC,IAAIkB,MAAK,kBAAM,a,gCAIjD,SAA2Bf,EAAcC,GACvC,IAAQrC,EAAaE,KAAKN,MAAlBI,SACFuD,EAAQvD,EAASH,YAAY2D,MACjC,SAACT,GAAD,OAAQA,EAAGX,OAASA,GAAQW,EAAGV,YAAcA,KAG/C,MAAwB,YAApBrC,EAASyD,cACQxD,IAAVsD,QAEQtD,IAAVsD,I,wBAIX,SAAmB1D,GAAa,WAC9B,OACE,uBAAKc,UAAU,kBACb,uBAAKA,UAAU,QACb,gBAAC,EAAA+C,SAAD,CAAU/C,UAAU,YAAY,aAAY,+BACzCd,EAAYiC,KAAI,SAACC,GAAD,OACf,gBAAC,MAAD,QACE4B,eAAe,EACf3B,IAAKD,EAAEE,IACHF,EAHN,CAIE6B,SAAU,EAAKzB,iBAAiBJ,EAAEK,KAAML,EAAEM,UAAUD,MACpDE,KAAM,EAAKvB,QAAQD,wB,yBASjC,WAAsB,WACpBoC,EAAAA,GAAAA,OAAqBC,MAAK,SAACU,GAGM,IAA3BA,EAAOP,KAAKQ,KAAKxC,MACnB,EAAK+B,SAAS,CAAErD,SAAU6D,EAAOP,KAAKA,KAAK,KAE3CS,QAAQC,MAAR,+BAC0BH,EAAOP,KAAKQ,KAAKxC,MAD3C,oB,8BAON,WAA2B,WACzBpB,KAAKmD,SAAS,CAAEtD,SAAS,IAAQ,WAC/BkE,EAAAA,GAAAA,KAAA,OAEO3E,EAAAA,EAAAA,WAAuB,EAAKM,MAAMP,OAAQ,CAAC,eAFlD,IAGI6E,YAAY,IAEd,EAAKnD,QAAQD,cACbqC,MAAK,SAACU,GACN,EAAKR,SAAS,CACZxD,YAAagE,EAAOP,KAAKA,KACzBxD,gBAAiB+D,EAAOP,KAAKQ,KAAKxC,MAClCvB,SAAS,Y,wBAMjB,WACE,OAAOT,EAAAA,EAAAA,wB,EA/QLH,CAAegF,EAAAA,WAmRrB,SAAeC,EAAAA,EAAAA,YAAWjF,GAE1BA,EAAOkF,YAAcC,EAAAA","sources":["webpack:///./src/containers/search/search.tsx"],"sourcesContent":["import { t } from '@lingui/macro';\nimport * as React from 'react';\nimport './search.scss';\n\nimport { withRouter, RouteComponentProps } from 'react-router-dom';\nimport { DataList, Switch } from '@patternfly/react-core';\nimport {\n  BaseHeader,\n  CardListSwitcher,\n  CollectionCard,\n  CollectionFilter,\n  CollectionListItem,\n  EmptyStateFilter,\n  EmptyStateNoData,\n  LoadingPageSpinner,\n  Pagination,\n  RepoSelector,\n} from 'src/components';\nimport {\n  CollectionAPI,\n  CollectionListType,\n  SyncListType,\n  MySyncListAPI,\n} from 'src/api';\nimport { ParamHelper } from 'src/utilities/param-helper';\nimport { Constants } from 'src/constants';\nimport { AppContext } from 'src/loaders/app-context';\nimport { filterIsSet } from 'src/utilities';\nimport { Paths } from 'src/paths';\n\ninterface IState {\n  collections: CollectionListType[];\n  numberOfResults: number;\n  params: {\n    page?: number;\n    page_size?: number;\n    keywords?: string;\n    tags?: string[];\n    view_type?: string;\n  };\n  loading: boolean;\n  synclist: SyncListType;\n}\n\nclass Search extends React.Component<RouteComponentProps, IState> {\n  tags: string[];\n\n  constructor(props) {\n    super(props);\n\n    const params = ParamHelper.parseParamString(props.location.search, [\n      'page',\n      'page_size',\n    ]);\n\n    if (!params['page_size']) {\n      params['page_size'] = Constants.CARD_DEFAULT_PAGE_SIZE;\n    }\n\n    // Load view type from local storage if it's not set. This allows a\n    // user's view type preference to persist\n    if (!params['view_type']) {\n      params['view_type'] = localStorage.getItem(\n        Constants.SEARCH_VIEW_TYPE_LOCAL_KEY,\n      );\n    }\n\n    this.state = {\n      collections: [],\n      params: params,\n      numberOfResults: 0,\n      loading: true,\n      synclist: undefined,\n    };\n  }\n\n  componentDidMount() {\n    this.queryCollections();\n\n    if (DEPLOYMENT_MODE === Constants.INSIGHTS_DEPLOYMENT_MODE) {\n      this.getSynclist();\n    }\n  }\n\n  render() {\n    const { loading, collections, params, numberOfResults } = this.state;\n    const noData =\n      collections.length === 0 &&\n      !filterIsSet(params, ['keywords', 'tags', 'sign_state']);\n\n    const updateParams = (p) =>\n      this.updateParams(p, () => this.queryCollections());\n\n    return (\n      <div className='search-page'>\n        <BaseHeader\n          className='header'\n          title={t`Collections`}\n          contextSelector={\n            <RepoSelector\n              selectedRepo={this.context.selectedRepo}\n              path={Paths.searchByRepo}\n            />\n          }\n        >\n          {!noData && (\n            <div className='hub-toolbar-wrapper'>\n              <div className='toolbar'>\n                <CollectionFilter\n                  ignoredParams={['page', 'page_size', 'sort', 'view_type']}\n                  params={params}\n                  updateParams={updateParams}\n                />\n\n                <div className='hub-pagination-container'>\n                  <div className='card-list-switcher'>\n                    <CardListSwitcher\n                      size='sm'\n                      params={params}\n                      updateParams={(p) =>\n                        this.updateParams(p, () =>\n                          // Note, we have to use this.state.params instead\n                          // of params in the callback because the callback\n                          // executes before the page can re-run render\n                          // which means params doesn't contain the most\n                          // up to date state\n                          localStorage.setItem(\n                            Constants.SEARCH_VIEW_TYPE_LOCAL_KEY,\n                            this.state.params.view_type,\n                          ),\n                        )\n                      }\n                    />\n                  </div>\n\n                  <Pagination\n                    params={params}\n                    updateParams={updateParams}\n                    count={numberOfResults}\n                    perPageOptions={Constants.CARD_DEFAULT_PAGINATION_OPTIONS}\n                    isTop\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </BaseHeader>\n        {loading ? (\n          <LoadingPageSpinner />\n        ) : noData ? (\n          <EmptyStateNoData\n            title={t`No collections yet`}\n            description={t`Collections will appear once uploaded`}\n          />\n        ) : (\n          <React.Fragment>\n            <section className='collection-container'>\n              {this.renderCollections(collections, params, updateParams)}\n            </section>\n            <section className='footer'>\n              <Pagination\n                params={params}\n                updateParams={(p) =>\n                  this.updateParams(p, () => this.queryCollections())\n                }\n                perPageOptions={Constants.CARD_DEFAULT_PAGINATION_OPTIONS}\n                count={numberOfResults}\n              />\n            </section>\n          </React.Fragment>\n        )}\n      </div>\n    );\n  }\n\n  private renderCollections(collections, params, updateParams) {\n    if (collections.length === 0) {\n      return (\n        <EmptyStateFilter\n          clearAllFilters={() => {\n            ParamHelper.clearAllFilters({\n              params,\n              ignoredParams: ['page', 'page_size', 'sort', 'view_type'],\n              updateParams,\n            });\n          }}\n        />\n      );\n    }\n    if (params.view_type === 'list') {\n      return this.renderList(collections);\n    } else {\n      return this.renderCards(collections);\n    }\n  }\n\n  private renderCards(collections) {\n    return (\n      <div className='cards'>\n        {collections.map((c) => {\n          return (\n            <CollectionCard\n              className='card'\n              key={c.id}\n              {...c}\n              footer={this.renderSyncToggle(c.name, c.namespace.name)}\n              repo={this.context.selectedRepo}\n            />\n          );\n        })}\n      </div>\n    );\n  }\n\n  private renderSyncToggle(name: string, namespace: string): React.ReactNode {\n    const { synclist } = this.state;\n    if (!synclist) {\n      return null;\n    }\n    return (\n      <Switch\n        id={namespace + '.' + name}\n        className='sync-toggle'\n        label={t`Sync`}\n        isChecked={this.isCollectionSynced(name, namespace)}\n        onChange={() => this.toggleCollectionSync(name, namespace)}\n      />\n    );\n  }\n\n  private toggleCollectionSync(name: string, namespace: string) {\n    const synclist = { ...this.state.synclist };\n\n    const colIndex = synclist.collections.findIndex(\n      (el) => el.name === name && el.namespace === namespace,\n    );\n\n    if (colIndex < 0) {\n      synclist.collections.push({ name: name, namespace: namespace });\n    } else {\n      synclist.collections.splice(colIndex, 1);\n    }\n\n    MySyncListAPI.update(synclist.id, synclist).then((response) => {\n      this.setState({ synclist: response.data });\n      MySyncListAPI.curate(synclist.id).then(() => null);\n    });\n  }\n\n  private isCollectionSynced(name: string, namespace: string): boolean {\n    const { synclist } = this.state;\n    const found = synclist.collections.find(\n      (el) => el.name === name && el.namespace === namespace,\n    );\n\n    if (synclist.policy === 'include') {\n      return !(found === undefined);\n    } else {\n      return found === undefined;\n    }\n  }\n\n  private renderList(collections) {\n    return (\n      <div className='list-container'>\n        <div className='list'>\n          <DataList className='data-list' aria-label={t`List of Collections`}>\n            {collections.map((c) => (\n              <CollectionListItem\n                showNamespace={true}\n                key={c.id}\n                {...c}\n                controls={this.renderSyncToggle(c.name, c.namespace.name)}\n                repo={this.context.selectedRepo}\n              />\n            ))}\n          </DataList>\n        </div>\n      </div>\n    );\n  }\n\n  private getSynclist() {\n    MySyncListAPI.list().then((result) => {\n      // ignore results if more than 1 is returned\n      // TODO: should we throw an error for this or just ignore it?\n      if (result.data.meta.count === 1) {\n        this.setState({ synclist: result.data.data[0] });\n      } else {\n        console.error(\n          `my-synclist returned ${result.data.meta.count} synclists`,\n        );\n      }\n    });\n  }\n\n  private queryCollections() {\n    this.setState({ loading: true }, () => {\n      CollectionAPI.list(\n        {\n          ...ParamHelper.getReduced(this.state.params, ['view_type']),\n          deprecated: false,\n        },\n        this.context.selectedRepo,\n      ).then((result) => {\n        this.setState({\n          collections: result.data.data,\n          numberOfResults: result.data.meta.count,\n          loading: false,\n        });\n      });\n    });\n  }\n\n  private get updateParams() {\n    return ParamHelper.updateParamsMixin();\n  }\n}\n\nexport default withRouter(Search);\n\nSearch.contextType = AppContext;\n"],"names":["Search","props","params","ParamHelper","location","search","Constants","localStorage","getItem","state","collections","numberOfResults","loading","synclist","undefined","this","queryCollections","DEPLOYMENT_MODE","getSynclist","noData","length","filterIsSet","updateParams","p","className","title","contextSelector","selectedRepo","context","path","Paths","ignoredParams","size","setItem","view_type","count","perPageOptions","isTop","description","renderCollections","clearAllFilters","renderList","renderCards","map","c","key","id","footer","renderSyncToggle","name","namespace","repo","Switch","label","isChecked","isCollectionSynced","onChange","toggleCollectionSync","colIndex","findIndex","el","push","splice","MySyncListAPI","then","response","setState","data","found","find","policy","DataList","showNamespace","controls","result","meta","console","error","CollectionAPI","deprecated","React","withRouter","contextType","AppContext"],"sourceRoot":""}