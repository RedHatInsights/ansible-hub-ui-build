{"version":3,"file":"js/6401.33c24267cd105132e4e0.js","mappings":"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","sources":["webpack:///./src/containers/ansible-remote/edit.tsx","webpack:///./src/permissions.ts"],"sourcesContent":["import { msg, t } from '@lingui/macro';\nimport React from 'react';\nimport { AnsibleRemoteAPI, AnsibleRemoteType } from 'src/api';\nimport { Page, RemoteForm } from 'src/components';\nimport { Paths, formatPath } from 'src/paths';\nimport { canAddAnsibleRemote, canEditAnsibleRemote } from 'src/permissions';\nimport { parsePulpIDFromURL, taskAlert } from 'src/utilities';\n\nconst initialRemote: AnsibleRemoteType = {\n  name: '',\n  url: '',\n  ca_cert: null,\n  client_cert: null,\n  tls_validation: true,\n  proxy_url: null,\n  download_concurrency: null,\n  rate_limit: null,\n  requirements_file: null,\n  auth_url: null,\n  signed_only: false,\n\n  hidden_fields: [\n    'client_key',\n    'proxy_username',\n    'proxy_password',\n    'username',\n    'password',\n    'token',\n  ].map((name) => ({ name, is_set: false })),\n};\n\nconst AnsibleRemoteEdit = Page<AnsibleRemoteType>({\n  breadcrumbs: ({ name }) =>\n    [\n      { url: formatPath(Paths.ansibleRemotes), name: t`Remotes` },\n      name && { url: formatPath(Paths.ansibleRemoteDetail, { name }), name },\n      name ? { name: t`Edit` } : { name: t`Add` },\n    ].filter(Boolean),\n\n  condition: (context, item?) =>\n    canAddAnsibleRemote(context) || canEditAnsibleRemote(context, item),\n  displayName: 'AnsibleRemoteEdit',\n  errorTitle: msg`Remote could not be displayed.`,\n  listUrl: formatPath(Paths.ansibleRemotes),\n  query: ({ name }) => {\n    return AnsibleRemoteAPI.list({ name })\n      .then(({ data: { results } }) => results[0])\n      .then((remote) => {\n        return AnsibleRemoteAPI.myPermissions(\n          parsePulpIDFromURL(remote.pulp_href),\n        )\n          .then(({ data: { permissions } }) => permissions)\n          .catch((e) => {\n            console.error(e);\n            return [];\n          })\n          .then((my_permissions) => ({ ...remote, my_permissions }));\n      });\n  },\n\n  title: ({ name }) => name || t`Add new remote`,\n  transformParams: ({ name, ...rest }) => ({\n    ...rest,\n    name: name !== '_' ? name : null,\n  }),\n\n  render: (item, { navigate, queueAlert, state, setState }) => {\n    if (!state.remoteToEdit) {\n      const remoteToEdit = {\n        ...initialRemote,\n        ...item,\n      };\n      setState({ remoteToEdit, errorMessages: {} });\n    }\n\n    const { remoteToEdit, errorMessages } = state;\n    if (!remoteToEdit) {\n      return null;\n    }\n\n    const saveRemote = () => {\n      const { remoteToEdit } = state;\n\n      const data = { ...remoteToEdit };\n\n      if (!item) {\n        // prevent \"This field may not be blank.\" when writing in and then deleting username/password/etc\n        // only when creating, edit diffs with item\n        Object.keys(data).forEach((k) => {\n          if (data[k] === '' || data[k] == null) {\n            delete data[k];\n          }\n        });\n\n        delete data.hidden_fields;\n      }\n\n      delete data.my_permissions;\n\n      // api requires traling slash, fix the trivial case\n      if (data.url && !data.url.includes('?') && !data.url.endsWith('/')) {\n        data.url += '/';\n      }\n\n      const promise = !item\n        ? AnsibleRemoteAPI.create(data)\n        : AnsibleRemoteAPI.smartUpdate(\n            parsePulpIDFromURL(item.pulp_href),\n            data,\n            item,\n          );\n\n      promise\n        .then(({ data: task }) => {\n          setState({\n            errorMessages: {},\n            remoteToEdit: undefined,\n          });\n\n          queueAlert(\n            item\n              ? taskAlert(task, t`Update started for remote ${data.name}`)\n              : {\n                  variant: 'success',\n                  title: t`Successfully created remote ${data.name}`,\n                },\n          );\n\n          navigate(\n            formatPath(Paths.ansibleRemoteDetail, {\n              name: data.name,\n            }),\n          );\n        })\n        .catch(({ response: { data } }) =>\n          setState({\n            errorMessages: {\n              __nofield: data.non_field_errors || data.detail,\n              ...data,\n            },\n          }),\n        );\n    };\n\n    const closeModal = () => {\n      setState({ errorMessages: {}, remoteToEdit: undefined });\n      navigate(\n        item\n          ? formatPath(Paths.ansibleRemoteDetail, {\n              name: item.name,\n            })\n          : formatPath(Paths.ansibleRemotes),\n      );\n    };\n\n    return (\n      <RemoteForm\n        allowEditName={!item}\n        remote={remoteToEdit}\n        updateRemote={(r) => setState({ remoteToEdit: r })}\n        remoteType='ansible-remote'\n        showMain={true}\n        saveRemote={saveRemote}\n        errorMessages={errorMessages}\n        closeModal={closeModal}\n      />\n    );\n  },\n});\n\nexport default AnsibleRemoteEdit;\n","import { FeatureFlagsType, SettingsType, UserType } from 'src/api';\n\nexport type PermissionContextType = (\n  o: {\n    featureFlags: FeatureFlagsType;\n    settings?: SettingsType;\n    user: UserType;\n    hasPermission: (string) => boolean;\n    hasObjectPermission?: (string, item?) => boolean;\n  },\n  item?,\n) => boolean;\n\nexport const isLoggedIn: PermissionContextType = ({ user }) =>\n  user && !user.is_anonymous;\n\nconst has_model_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, user }) =>\n    hasPermission(permission) || user?.is_superuser;\n\nconst has_model_or_obj_perms =\n  (permission: string): PermissionContextType =>\n  ({ hasPermission, hasObjectPermission, user }, item?) =>\n    hasPermission(permission) ||\n    hasObjectPermission?.(permission, item) ||\n    user?.is_superuser;\n\n// Ansible Remotes\nexport const canAddAnsibleRemote = has_model_perms(\n  'ansible.add_collectionremote',\n);\nexport const canDeleteAnsibleRemote = has_model_or_obj_perms(\n  'ansible.delete_collectionremote',\n);\nexport const canEditAnsibleRemote = has_model_or_obj_perms(\n  'ansible.change_collectionremote',\n);\nexport const canViewAnsibleRemotes = has_model_or_obj_perms(\n  'ansible.view_collectionremote',\n);\nexport const canEditAnsibleRemoteAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_collectionremote',\n);\n\n// Ansible Repositories\nexport const canAddAnsibleRepository = has_model_perms(\n  'ansible.add_ansiblerepository',\n);\nexport const canDeleteAnsibleRepository = has_model_or_obj_perms(\n  'ansible.delete_ansiblerepository',\n);\nexport const canEditAnsibleRepository = has_model_or_obj_perms(\n  'ansible.change_ansiblerepository',\n);\nexport const canSyncAnsibleRepository = canEditAnsibleRepository;\n// everybody can list/view, not has_model_or_obj_perms('ansible.view_ansiblerepository'); under feature flag\nexport const canViewAnsibleRepositories = ({ user, featureFlags }) =>\n  user && featureFlags?.display_repositories;\nexport const canEditAnsibleRepositoryAccess = has_model_or_obj_perms(\n  'ansible.manage_roles_ansiblerepository',\n);\n\n// Ansible Repository Versions\n// simulating has_repository_model_or_obj_perms by passing in repository as item\nexport const canRevertAnsibleRepositoryVersion = canEditAnsibleRepository;\n"],"names":["initialRemote","name","url","ca_cert","client_cert","tls_validation","proxy_url","download_concurrency","rate_limit","requirements_file","auth_url","signed_only","hidden_fields","map","is_set","Page","breadcrumbs","_ref","formatPath","Paths","ansibleRemotes","i18n","_","id","ansibleRemoteDetail","filter","Boolean","condition","context","item","canAddAnsibleRemote","canEditAnsibleRemote","displayName","errorTitle","listUrl","query","_ref2","AnsibleRemoteAPI","list","then","_ref3","data","results","remote","myPermissions","parsePulpIDFromURL","pulp_href","_ref4","permissions","e","console","error","my_permissions","_objectSpread","title","_ref5","transformParams","_ref6","_objectWithoutProperties","_excluded","render","_ref7","navigate","queueAlert","state","setState","remoteToEdit","errorMessages","React","RemoteForm","allowEditName","updateRemote","r","remoteType","showMain","saveRemote","Object","keys","forEach","k","includes","endsWith","smartUpdate","create","_ref8","task","undefined","taskAlert","values","variant","_ref9","response","__nofield","non_field_errors","detail","closeModal","has_model_perms","permission","hasPermission","user","is_superuser","has_model_or_obj_perms","hasObjectPermission","canDeleteAnsibleRemote","canViewAnsibleRemotes","canEditAnsibleRemoteAccess","canAddAnsibleRepository","canDeleteAnsibleRepository","canEditAnsibleRepository","canSyncAnsibleRepository","canViewAnsibleRepositories","featureFlags","display_repositories","canEditAnsibleRepositoryAccess","canRevertAnsibleRepositoryVersion"],"sourceRoot":""}